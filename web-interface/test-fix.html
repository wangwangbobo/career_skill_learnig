<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试修复后的课程显示功能</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-btn:hover {
            background: #3730a3;
        }
        .results {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #4f46e5;
        }
        .skills-container {
            margin-top: 20px;
        }
        .skill-category {
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .skill-header {
            background: #f3f4f6;
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        .skill-title {
            margin: 0;
            color: #374151;
            font-size: 16px;
        }
        .skill-content {
            padding: 16px;
        }
        .content-type-body {
            margin-top: 12px;
        }
        .course-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 测试修复后的课程显示功能</h1>
        <p>测试处理完成事件的新逻辑</p>
        
        <button class="test-btn" onclick="testCompleteEvent()">测试完成事件处理</button>
        <button class="test-btn" onclick="testCoursesDisplay()">测试课程显示</button>
        
        <div id="results" class="results" style="display: none;">
            <h3>测试结果：</h3>
            <div id="output"></div>
        </div>
        
        <!-- 模拟skillsContainer -->
        <div class="skills-container" id="skillsContainer">
            <!-- 课程内容将在这里显示 -->
        </div>
    </div>

    <script>
        // 模拟displayStreamCourses方法
        function displayStreamCourses(courses) {
            if (!courses || !Array.isArray(courses) || courses.length === 0) {
                console.warn('⚠️ 课程数据为空或无效');
                return;
            }
            
            console.log('🎓 显示真实搜索的课程:', courses);
            
            const addCourseLink = (course) => {
                const baseUrls = {
                    'Coursera': 'https://www.coursera.org/search?query=',
                    'Udemy': 'https://www.udemy.com/courses/search/?q=',
                    'B站': 'https://search.bilibili.com/all?keyword=',
                    '慕课网': 'https://study.163.com/courses-search/search.htm?keyword=',
                    '腾讯课堂': 'https://ke.qq.com/course/list?mt=1001&st=2001&tt=-1&tk='
                };
                
                const baseUrl = baseUrls[course.platform] || '#';
                const searchQuery = encodeURIComponent(course.title || '未命名课程');
                return baseUrl === '#' ? '#' : baseUrl + searchQuery;
            };
            
            const translateDifficulty = (difficulty) => {
                const difficultyMap = {
                    'beginner': '初级',
                    'intermediate': '中级', 
                    'advanced': '高级',
                    'expert': '专家级',
                    'unknown': '未知'
                };
                return difficultyMap[difficulty] || '未知';
            };
            
            const skillsContainer = document.getElementById('skillsContainer');
            if (!skillsContainer) {
                console.error('⚠️ skillsContainer不存在');
                return;
            }
            
            // 直接创建课程分类显示
            const skillDiv = document.createElement('div');
            skillDiv.className = 'skill-category';
            skillDiv.innerHTML = `
                <div class="skill-header" onclick="this.parentElement.classList.toggle('collapsed')">
                    <h3 class="skill-title">
                        <i class="fas fa-graduation-cap"></i>
                        🎓 推荐课程 (共${courses.length}门)
                    </h3>
                </div>
                <div class="skill-content">
                    <div class="content-types">
                        <div class="content-type">
                            <div class="content-type-header">
                                <i class="fas fa-graduation-cap"></i>
                                真实搜索的优质课程
                            </div>
                            <div class="content-type-body">
                                ${courses.map(course => {
                                    const link = addCourseLink(course);
                                    const rating = course.rating ? parseFloat(course.rating).toFixed(1) : 'N/A';
                                    const students = course.students ? course.students.toLocaleString() : '0';
                                    const difficulty = translateDifficulty(course.difficulty || 'unknown');
                                    const highlights = course.highlights ? course.highlights.join('、') : '';
                                    return `
                                        <div class="content-item course-item">
                                            <h4 style="margin: 0 0 0.5rem 0;">
                                                <a href="${link}" target="_blank" style="color: #4f46e5; text-decoration: none; font-weight: bold;">
                                                    ${course.title || '未命名课程'} 🔗
                                                </a>
                                            </h4>
                                            <div style="margin-bottom: 0.5rem; color: #666;">
                                                <span style="display: inline-block; margin-right: 1rem;">🏢 ${course.platform || '未知平台'}</span>
                                                <span style="display: inline-block; margin-right: 1rem;">⭐ ${rating}/5</span>
                                                <span style="display: inline-block; margin-right: 1rem;">👥 ${students}人</span>
                                                <span style="display: inline-block; margin-right: 1rem;">⏱️ ${course.duration || '未知'}</span>
                                            </div>
                                            <div style="margin-bottom: 0.5rem; color: #666;">
                                                <span style="display: inline-block; margin-right: 1rem;">💰 ${course.price === 0 ? '免费' : '￥' + (course.price || '未知')}</span>
                                                <span style="display: inline-block; margin-right: 1rem;">📊 ${difficulty}</span>
                                                <span style="display: inline-block;">🌍 ${course.language || '未知'}</span>
                                            </div>
                                            ${highlights ? `<div style="margin-bottom: 0.5rem;"><span style="color: #059669; font-weight: bold;">🎆 亮点：</span> ${highlights}</div>` : ''}
                                            ${course.description ? `<p style="margin: 0.5rem 0 0 0; color: #444; font-size: 0.9rem;">${course.description}</p>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            skillsContainer.appendChild(skillDiv);
            console.log(`✅ 成功显示 ${courses.length} 门真实搜索的课程！`);
        }
        
        function testCompleteEvent() {
            const resultsDiv = document.getElementById('results');
            const outputDiv = document.getElementById('output');
            
            resultsDiv.style.display = 'block';
            outputDiv.innerHTML = '<p>🔄 模拟完成事件处理...</p>';
            
            // 模拟complete事件的数据（基于你提供的日志）
            const mockCompleteData = {
                result: {
                    courses: [
                        {
                            platform: "B站",
                            title: "2024最新Python工程师全套教程",
                            rating: 4.7,
                            students: 82753,
                            duration: "49小时",
                            difficulty: "beginner",
                            price: 0,
                            highlights: ["完全免费", "中文讲解", "弹幕互动"],
                            description: "免费优质的Python工程师中文教程，适合中文学习者入门和进阶。",
                            lastUpdated: "2024年",
                            language: "中文"
                        },
                        {
                            platform: "Coursera",
                            title: "Python工程师 完整学习路径",
                            rating: 4.5,
                            students: 48149,
                            duration: "22小时",
                            difficulty: "intermediate",
                            price: 373,
                            highlights: ["大学认证", "专业证书"],
                            description: "由知名大学和行业专家提供的Python工程师专业课程，包含理论基础和实践项目。",
                            lastUpdated: "2024年",
                            language: "英文(中文字幕)"
                        },
                        {
                            platform: "慕课网",
                            title: "Python工程师架构师课程",
                            rating: 4.7,
                            students: 15148,
                            duration: "38小时",
                            difficulty: "intermediate",
                            price: 217,
                            highlights: ["就业指导", "企业项目", "导师答疑"],
                            description: "面向就业的Python工程师实战课程，包含企业级项目和就业指导。",
                            lastUpdated: "2024年",
                            language: "中文"
                        }
                    ]
                }
            };
            
            // 测试新的处理逻辑
            if (mockCompleteData.result && mockCompleteData.result.courses) {
                console.log('🎓 显示最终课程结果:', mockCompleteData.result.courses);
                displayStreamCourses(mockCompleteData.result.courses);
                outputDiv.innerHTML = `<p>✅ 成功处理完成事件，显示了 ${mockCompleteData.result.courses.length} 门课程</p>`;
            }
        }
        
        function testCoursesDisplay() {
            const resultsDiv = document.getElementById('results');
            const outputDiv = document.getElementById('output');
            
            resultsDiv.style.display = 'block';
            outputDiv.innerHTML = '<p>🔄 测试课程显示功能...</p>';
            
            // 清空容器
            const skillsContainer = document.getElementById('skillsContainer');
            skillsContainer.innerHTML = '';
            
            // 直接测试课程显示
            const testCourses = [
                {
                    platform: "Udemy",
                    title: "实战Python工程师项目开发",
                    rating: 4.4,
                    students: 13801,
                    duration: "15小时",
                    difficulty: "beginner",
                    price: 210,
                    highlights: ["终身访问", "实战项目", "代码下载"],
                    description: "实战导向的Python工程师课程，通过项目实践快速掌握核心技能。",
                    language: "英文(中文字幕)"
                }
            ];
            
            displayStreamCourses(testCourses);
            outputDiv.innerHTML = '<p>✅ 课程显示功能测试完成</p>';
        }
    </script>
</body>
</html>