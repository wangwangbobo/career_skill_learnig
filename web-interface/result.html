<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>学习资料生成结果 - 职途助手AI求职大师</title>
    
    <!-- 加载样式文件 -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- 加载 Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- API配置相关全局函数 - 在页面解析时立即可用 -->
    <script>
        // 全局API配置函数 - 确保立即可用
        function openApiConfigModal() {
            console.log('🚀 全局函数: 打开API配置模态框');
            const apiConfigModal = document.getElementById('apiConfigModal');
            const apiKeyInput = document.getElementById('apiKey');
            const apiProviderSelect = document.getElementById('apiProvider');
            
            if (!apiConfigModal) {
                console.error('找不到API配置模态框');
                alert('API配置模态框未找到，请刷新页面重试');
                return;
            }
            
            // 从localStorage加载已保存的配置
            if (apiKeyInput) {
                const savedApiKey = localStorage.getItem('ai_learning_companion_api_key');
                apiKeyInput.value = savedApiKey || '';
            }
            
            if (apiProviderSelect) {
                const savedApiProvider = localStorage.getItem('apiProvider');
                apiProviderSelect.value = savedApiProvider || 'alibaba';
            }
            
            // 显示模态框
            apiConfigModal.style.display = 'flex';
            apiConfigModal.classList.add('show');
            
            console.log('✅ API配置模态框已显示');
        }
        
        // 全局关闭模态框函数
        function closeApiConfigModal() {
            console.log('关闭API配置模态框');
            const apiConfigModal = document.getElementById('apiConfigModal');
            if (apiConfigModal) {
                apiConfigModal.classList.remove('show');
                setTimeout(() => {
                    apiConfigModal.style.display = 'none';
                }, 300);
            }
        }
        
        // 确保函数也在window对象上
        window.openApiConfigModal = openApiConfigModal;
        window.closeApiConfigModal = closeApiConfigModal;
        
        // 返回到job-input页面的函数
        function goBackToJobInput() {
            console.log('🔙 返回到job-input页面');
            window.location.href = 'job-input.html';
        }
        
        // 确保返回函数也在window对象上
        window.goBackToJobInput = goBackToJobInput;
    </script>
    <!-- 页面专用样式 -->
    <style>
        /* 全局重置样式 */
        * {
            box-sizing: border-box;
        }
        
        html {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        
        /* 结果页面专用样式 */
        body {
            margin: 0 !important;
            padding: 0 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #f3f4f6 !important;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .results-container {
            display: flex;
            flex: 1;
            padding: 0.8rem 1rem 1rem 1rem; /* 增大上边距，让标题栏下面有更多间距 */
            gap: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        /* 顶部标题栏 */
        .results-header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.4rem 1rem !important; /* 适当增大内边距 */
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            min-height: 2.5rem !important; /* 适当增大最小高度 */
            position: relative;
            margin-bottom: 0 !important; /* 强制去除外部CSS的margin-bottom */
            border-radius: 0 !important; /* 强制去除外部CSS的border-radius */
        }
        
        /* 返回箭头按钮 */
        .back-arrow-btn {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 28px; /* 减小按钮大小 */
            height: 28px;
            border: none;
            background: #f3f4f6;
            border-radius: 6px;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 0.8rem; /* 减小字体大小 */
            z-index: 100;
        }
        
        .back-arrow-btn:hover {
            background: #6366f1;
            color: white;
            transform: translateY(-50%) translateX(-2px);
        }
        
        /* 调整标题位置，给返回按钮让出空间 */
        
        .results-title {
            display: flex;
            align-items: center;
            font-size: 1.2rem; /* 增大标题字体大小 */
            font-weight: 600;
            color: #111827;
            margin: 0;
            margin-left: 48px; /* 给返回按钮留出空间 */
        }
        
        .results-title i {
            margin-right: 0.5rem; /* 增大图标间距 */
            color: #6366f1;
            font-size: 1.1rem; /* 增大图标大小 */
        }
        
        .results-meta {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .generation-time {
            display: flex;
            align-items: center;
        }
        
        .generation-time i {
            margin-right: 0.5rem;
        }
        
        .results-actions {
            display: flex;
            gap: 0.5rem; /* 减小按钮间距 */
        }
        
        .result-action-btn {
            padding: 0.4rem 0.8rem; /* 增大按钮内边距 */
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            font-size: 0.8rem; /* 增大字体大小 */
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            z-index: 100; /* 添加z-index确保按钮在最上层 */
            position: relative; /* 添加相对定位 */
        }
        
        .result-action-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .result-action-btn i {
            margin-right: 0.5rem;
        }
        
        /* 主要内容区域 - 三列布局 */
        .content-layout {
            display: flex;
            flex: 1;
            gap: 1rem;
            width: 100%;
            position: relative;
            overflow: visible;
            pointer-events: auto; /* 确保可以响应点击 */
        }
        
        /* 左侧目录面板 */
        .content-sidebar {
            width: 260px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: visible; /* 修改为visible确保内容不被剪裁 */
            position: relative;
            z-index: 5; /* 增加z-index确保在上层 */
        }
        
        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #111827;
        }
        
        /* 折叠按钮样式 */
        .sidebar-toggle-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #f3f4f6;
            color: #6b7280;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .sidebar-toggle-btn:hover {
            background: #e5e7eb;
            color: #374151;
        }
        
        /* 折叠状态下的样式 */
        .content-sidebar.collapsed {
            width: 60px;
            overflow: hidden;
            transition: width 0.3s ease;
        }
        
        .content-sidebar.collapsed .sidebar-header h3 {
            opacity: 0;
            width: 0;
            overflow: hidden;
            white-space: nowrap;
            transition: opacity 0.2s ease, width 0.3s ease;
        }
        
        .content-sidebar.collapsed .sidebar-section {
            opacity: 0;
            height: 0;
            overflow: hidden;
            padding: 0;
            margin: 0;
            transition: opacity 0.2s ease, height 0.3s ease;
        }
        
        .content-sidebar.collapsed .sidebar-toggle-btn {
            transform: rotate(180deg);
        }
        
        /* 添加过渡动画 */
        .content-sidebar {
            transition: width 0.3s ease;
        }
        
        .sidebar-header h3 {
            transition: opacity 0.2s ease, width 0.3s ease;
        }
        
        .sidebar-section {
            transition: opacity 0.2s ease, height 0.3s ease;
        }
        

        .sidebar-section {
            margin-bottom: 1rem;
        }
        
        .sidebar-section-title {
            padding: 0.75rem 1rem;
            margin: 0;
            font-size: 0.875rem;
            font-weight: 600;
            color: #111827;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .content-nav-list, .skill-nav-list {
            margin: 0;
            padding: 0;
            list-style: none;
            position: relative;
            z-index: 20; /* 增加z-index确保在上层 */
            pointer-events: auto; /* 确保可以响应点击 */
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            pointer-events: auto; /* 确保可以响应点击 */
            z-index: 20; /* 增加z-index确保在上层 */
        }
        
        .nav-item:hover {
            background: #f9fafb;
            color: #6366f1;
        }
        
        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #6366f1;
            font-weight: 500;
        }
        
        .nav-item i {
            margin-right: 0.75rem;
            width: 16px;
            text-align: center;
        }
        
        .item-count {
            margin-left: 0.5rem;
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .nav-arrow {
            margin-left: auto;
            font-size: 0.75rem;
            transition: transform 0.3s ease;
        }
        
        .nav-item.expanded .nav-arrow {
            transform: rotate(90deg);
        }
        
        /* 中间内容区域 */
        .content-main {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            z-index: 1;
            min-width: 0; /* 防止flex元素溢出 */
            width: 100%;
        }
        
        .content-section {
            display: none;
            flex: 1;
            flex-direction: column;
            position: relative;
            background: white;
            border-radius: 8px;
            width: 100%;
            min-width: 0; /* 防止flex元素溢出 */
            overflow: hidden;
        }
        
        .content-section.active {
            display: flex;
            z-index: 10;
        }
        
        .section-header {
            padding: 0.5rem 1rem; /* 进一步减少上下内边距 */
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-header > div {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            display: flex;
            align-items: center;
        }
        
        .section-header h2 i {
            margin-right: 0.75rem;
            color: #6366f1;
        }
        
        /* 专门针对思维导图页面的按钮布局 - 标题在最左边，按钮在标题右边 */
        #mindmapSection .section-header {
            justify-content: flex-start !important;
        }
        
        #mindmapSection .section-header h2 {
            order: 1 !important;
            margin-right: 1rem !important;
        }
        
        #mindmapSection .section-header > div {
            order: 2 !important;
        }
        
        .section-count {
            margin-left: 0.5rem;
            font-size: 0.875rem;
            font-weight: 400;
            color: #6b7280;
        }
        
        .expand-all-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            font-size: 0.75rem;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .expand-all-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .expand-all-btn i {
            margin-right: 0.5rem;
        }
        
        .section-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            width: 100%;
        }
        
        /* 思维导图相关样式优化 */
        .mindmap-card {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            height: calc(100vh - 280px); /* 自适应高度 */
            min-height: 70vh; /* 最小70%视口高度 */
            max-height: 85vh; /* 最大85%视口高度 */
            display: flex;
            flex-direction: column;
        }
        
        /* 思维导图内容区域（SVG或降级显示） */
        #mindmapContent {
            width: 100%;
            height: 100%;
            overflow: hidden; /* 防止滚动条 */
        }
        
        /* SVG样式优化 */
        #mindmapContent svg {
            width: 100%;
            height: 100%;
            display: block; /* 移除默认的inline间隙 */
        }
        
        /* 降级方案样式优化 */
        .mindmap-fallback {
            width: 100%;
            height: 100%;
            padding: 2rem;
            box-sizing: border-box;
            overflow-y: auto; /* 允许垂直滚动 */
        }
        
        .mindmap-controls {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 10;
            display: flex;
            gap: 0.5rem;
        }
        
        .mindmap-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mindmap-btn:hover {
            background: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mindmap-content {
            flex: 1;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            min-height: 70vh; /* 使用视口高度，自适应屏幕大小 */
            max-height: 85vh; /* 限制最大高度 */
            height: calc(100vh - 300px); /* 动态计算高度，减去顶部导航和底部空间 */
            width: 100%;
            box-sizing: border-box;
        }
        
        /* 右侧AI助手 */
        .ai-assistant {
            width: 380px;
            min-width: 300px; /* 最小宽度 */
            max-width: 600px; /* 最大宽度 */
            height: calc(100vh - 120px); /* 减少顶部留白，更好适应屏幕 */
            max-height: 900px; /* 增加最大高度 */
            min-height: 400px; /* 设置最小高度 */
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            transition: box-shadow 0.3s ease; /* 只保留必要的过渡动画 */
            z-index: 2; /* 确保AI助手始终在最上层 */
            position: relative; /* 为拖拽边框定位 */
        }
        
        /* 左侧拖拽边框 */
        .ai-assistant-resize-handle {
            position: absolute;
            left: -3px;
            top: 0;
            width: 6px;
            height: 100%;
            cursor: col-resize;
            background: transparent;
            z-index: 10;
            transition: background-color 0.2s ease;
        }
        
        .ai-assistant-resize-handle:hover {
            background: linear-gradient(to right, transparent, rgba(99, 102, 241, 0.3), transparent);
        }
        
        .ai-assistant-resize-handle.resizing {
            background: linear-gradient(to right, transparent, rgba(99, 102, 241, 0.5), transparent);
        }
        
        /* 拖拽中的状态 */
        .ai-assistant.resizing {
            user-select: none;
            pointer-events: none;
        }
        
        .ai-assistant.resizing .ai-assistant-resize-handle {
            pointer-events: auto;
        }
        
        /* AI助手缩小状态 */
        .ai-assistant.minimized {
            position: fixed !important;
            top: 80px !important;
            right: 20px !important;
            width: 60px !important;
            height: 60px !important;
            min-width: 60px !important;
            min-height: 60px !important;
            max-width: 60px !important;
            max-height: 60px !important;
            border-radius: 50% !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            z-index: 1000 !important;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            overflow: hidden !important;
            flex-direction: row !important;
        }
        
        .ai-assistant.minimized:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        
        .ai-assistant.minimized .assistant-header {
            display: none !important;
        }
        
        .ai-assistant.minimized .assistant-title {
            display: none !important;
        }
        
        .ai-assistant.minimized .assistant-actions {
            display: none !important;
        }
        
        .ai-assistant.minimized .assistant-content {
            display: none !important;
        }
        
        .ai-assistant.minimized .chat-messages {
            display: none !important;
        }
        
        .ai-assistant.minimized .chat-input-container {
            display: none !important;
        }
        
        .ai-assistant.minimized .ai-assistant-resize-handle {
            display: none !important;
        }
        
        /* 缩小后的机器人图标 */
        .ai-assistant.minimized::before {
            content: "\f544";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            font-size: 28px;
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            pointer-events: none;
        }
        
        /* 缩小状态下的点击区域 */
        .ai-assistant.minimized::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            z-index: 1002;
            cursor: pointer;
        }
        
        .assistant-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #6366f1;
            color: white;
        }
        
        .assistant-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .assistant-title i {
            margin-right: 0.75rem;
        }
        
        .assistant-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .assistant-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .assistant-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .assistant-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            overflow-x: hidden; /* 防止水平滚动 */
            background: #f9fafb;
            min-height: 300px; /* 最小高度 */
            max-height: calc(100vh - 250px); /* 调整最大高度，更好适应屏幕 */
            /* 美化滚动条 */
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }
        
        /* Webkit 浏览器滚动条样式 */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
            transition: background 0.3s ease;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        .welcome-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 200px; /* 改为min-height，不再占用整个高度 */
            padding: 2rem;
            margin-bottom: 1rem; /* 添加下边距 */
        }
        
        .assistant-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .welcome-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.5rem 0;
        }
        
        .welcome-text {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
            margin: 0;
        }
        
        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.75rem;
            align-items: center; /* 改为垂直居中对齐 */
        }
        
        .chat-input {
            flex: 1;
            padding: 0.6rem 1rem; /* 调整内边距以更好对齐 */
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
            resize: none;
            transition: border-color 0.3s ease;
            min-height: 40px; /* 设置最小高度与按钮保持一致 */
            height: 40px; /* 固定高度，防止高度变化影响对齐 */
            line-height: 1.3; /* 调整行高使文本垂直居中 */
            display: flex; /* 使用flex布局 */
            align-items: center; /* 文本垂直居中 */
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
            flex-shrink: 0; /* 防止按钮被压缩 */
            margin: 0; /* 清除默认边距 */
        }
        
        .send-btn:hover {
            background: #4f46e5;
        }
        
        .send-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }
        
        /* 聊天消息样式 */
        .message {
            display: flex;
            margin-bottom: 0.75rem; /* 减小消息间距 */
            max-width: 100%; /* 允许消息使用全部宽度 */
        }
        
        .user-message {
            margin-left: auto;
            flex-direction: row-reverse;
            max-width: calc(100% - 20px); /* 与AI消息保持一致的最大宽度 */
            margin-right: 10px; /* 与AI消息保持一致的右边距 */
        }
        
        .assistant-message {
            margin: 0 10px; /* 左右边距保持一致 */
            max-width: calc(100% - 20px); /* 减去左右边距后的最大宽度 */
            flex-direction: column; /* 改为垂直排列 */
            align-items: flex-start; /* 左对齐 */
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin: 0 0 0.5rem 0; /* 调整为底部边距，适配垂直布局 */
        }
        
        /* 用户消息中的头像依然保持水平布局 */
        .user-message .message-avatar {
            margin: 0 0.75rem; /* 用户消息保持原样式 */
        }
        
        .message-content {
            background: #f3f4f6;
            padding: 0.5rem 0.75rem; /* 减小内边距 */
            border-radius: 12px;
            font-size: 0.875rem;
            line-height: 1.4; /* 减小行高 */
            color: #4b5563;
            max-width: 100%; /* AI消息最大宽度 - 调整为全宽度 */
            width: 100%; /* 在垂直布局下占满容器宽度 */
            display: block; /* 改为block布局 */
            word-wrap: break-word; /* 强制换行 */
            word-break: break-word; /* 兼容性设置 */
            overflow-wrap: break-word; /* 现代浏览器支持 */
            white-space: pre-wrap; /* 保持换行和空格 */
        }
        
        /* Markdown内容样式 */
        .message-content h1,
        .message-content h2,
        .message-content h3 {
            margin: 0.5rem 0 0.25rem 0;
            font-weight: 600;
            color: #1f2937;
        }
        
        .message-content h1 {
            font-size: 1rem;
            border-bottom: 1px solid #6366f1;
            padding-bottom: 0.25rem;
        }
        
        .message-content h2 {
            font-size: 0.95rem;
            border-left: 3px solid #6366f1;
            padding-left: 0.5rem;
        }
        
        .message-content h3 {
            font-size: 0.9rem;
            color: #4338ca;
        }
        
        .message-content ul,
        .message-content ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .message-content li {
            margin: 0.25rem 0;
            color: #4b5563;
        }
        
        .message-content strong {
            font-weight: 600;
            color: #1f2937;
        }
        
        .message-content em {
            font-style: italic;
            color: #6b7280;
        }
        
        .message-content code {
            background: #e5e7eb;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.8rem;
            color: #dc2626;
        }
        
        .message-content pre {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        
        .message-content pre code {
            background: none;
            padding: 0;
            color: #374151;
            font-size: 0.8rem;
        }
        
        .message-content a {
            color: #6366f1;
            text-decoration: underline;
        }
        
        .message-content a:hover {
            color: #4338ca;
        }
        
        .message-content table {
            border-collapse: collapse;
            margin: 0.5rem 0;
            width: 100%;
        }
        
        .message-content td {
            border: 1px solid #d1d5db;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        .message-content hr {
            border: none;
            height: 1px;
            background: #d1d5db;
            margin: 0.75rem 0;
        }
        
        /* 流式消息内容的样式 */
        .message-content.streaming {
            animation: none;
            transition: none;
            opacity: 0.8;
            background: rgba(99, 102, 241, 0.05);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }
        
        /* 流式容器样式 */
        .stream-container {
            transition: all 0.1s ease; /* 添加平滑过渡 */
        }
        
        /* 流式容器中的Markdown元素样式 */
        .stream-container p {
            margin: 0 0 0.5rem 0;
            line-height: 1.6;
        }
        
        .stream-container p:last-child {
            margin-bottom: 0;
        }
        
        .stream-container h1,
        .stream-container h2,
        .stream-container h3 {
            margin: 0.5rem 0 0.25rem 0;
            font-weight: 600;
            color: #1f2937;
        }
        
        .stream-container h1 {
            font-size: 1rem;
            border-bottom: 1px solid #6366f1;
            padding-bottom: 0.25rem;
        }
        
        .stream-container h2 {
            font-size: 0.95rem;
            border-left: 3px solid #6366f1;
            padding-left: 0.5rem;
        }
        
        .stream-container h3 {
            font-size: 0.9rem;
            color: #4338ca;
        }
        
        .stream-container ul,
        .stream-container ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .stream-container li {
            margin: 0.25rem 0;
            color: #4b5563;
        }
        
        .stream-container strong {
            font-weight: 600;
            color: #1f2937;
        }
        
        .stream-container em {
            font-style: italic;
            color: #6b7280;
        }
        
        .stream-container code {
            background: #e5e7eb;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.8rem;
            color: #dc2626;
        }
        
        .stream-container pre {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        
        .stream-container pre code {
            background: none;
            padding: 0;
            color: #374151;
            font-size: 0.8rem;
        }
        
        .user-message .message-content {
            background: #6366f1 !important;
            color: white !important;
            padding: 0.5rem 0.75rem !important; /* 与AI消息保持一致的内边距 */
            border-radius: 12px !important;
            font-size: 0.875rem !important;
            line-height: 1.4 !important; /* 与AI消息保持一致的行高 */
            display: inline-block !important; /* 改为inline-block，既能控制宽度又不会产生多余空行 */
            width: 100% !important; /* 与AI消息一样宽 */
            max-width: 100% !important; /* 移除宽度限制 */
            min-width: auto !important;
            word-wrap: break-word !important;
            word-break: break-word !important;
            overflow-wrap: break-word !important;
            box-sizing: border-box !important;
            margin: 0 !important; /* 移除任何默认边距 */
            vertical-align: top !important; /* 防止基线对齐造成的空间 */
            white-space: normal !important; /* 正常处理空格和换行 */
        }
        
        /* 增加一个更具体的选择器以确保优先级 */
        .ai-assistant .chat-messages .message.user-message .message-content {
            max-width: 100% !important;
            width: 100% !important;
            min-width: auto !important;
        }
        
        .message-content p {
            margin: 0 !important;
            padding: 0 !important; /* 确保段落没有额外的内边距 */
            line-height: inherit !important; /* 继承父元素的行高 */
        }
        
        /* 针对用户消息的段落特别处理 */
        .user-message .message-content p {
            margin: 0 !important;
            padding: 0 !important;
            line-height: inherit !important;
            display: inline !important; /* 确保段落内联显示，不产生换行 */
        }
        
        /* 用户消息中的所有文本元素都不产生额外间距 */
        .user-message .message-content * {
            margin: 0 !important;
            padding: 0 !important;
            vertical-align: baseline !important;
        }
        
        /* 用户消息的直接文本节点处理 */
        .user-message .message-content:before,
        .user-message .message-content:after {
            content: none !important;
        }
        

        
        /* 面试题新样式 */
        .interview-card {
            background: white;
            border-radius: 16px; /* 增加圆角 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1); /* 增强阴影 */
            padding: 2rem; /* 增加内边距 */
            margin-bottom: 2rem; /* 增加下边距 */
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid #f1f5f9;
        }
        
        .interview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .interview-progress {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .interview-progress i {
            color: #4f46e5;
            margin-right: 0.5rem;
        }

        .interview-question {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            margin: -2rem -2rem 0 -2rem; /* 负边距抵消父容器的padding */
            line-height: 1.3;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            padding: 1.2rem 1.5rem;
            border-radius: 12px 12px 0 0; /* 只保留上方圆角 */
            text-align: center;
        }

        .interview-tags {
            display: flex;
            gap: 0.75rem; /* 增加间距 */
            margin-bottom: 2rem; /* 增加下边距 */
            flex-wrap: wrap;
        }

        .interview-tag {
            padding: 0.375rem 1rem; /* 增加内边距 */
            border-radius: 9999px;
            font-size: 0.8rem; /* 稍微增大字体 */
            font-weight: 600; /* 增加字体重量 */
            letter-spacing: 0.025em;
            transition: all 0.2s ease;
        }

        .interview-tag.primary {
            background-color: #e9d5ff;
            color: #7e22ce;
        }

        .interview-tag.secondary {
            background-color: #dbeafe;
            color: #1d4ed8;
        }

        .interview-tag.tech {
            background-color: #e0f2fe;
            color: #0369a1;
        }

        /* 知识点新样式 */
        .knowledge-item {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 0;
            margin-bottom: 1.5rem;
            display: block;
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .knowledge-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-color: #6366f1;
        }

        .knowledge-header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 1.2rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .knowledge-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            margin: 0;
            line-height: 1.3;
            text-align: center;
        }

        .knowledge-content {
            padding: 1.5rem;
            background: white;
        }

        .knowledge-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4b5563;
            margin: 0;
        }

        .knowledge-text strong {
            color: #1f2937;
            font-weight: 600;
        }

        .knowledge-text br {
            margin-bottom: 0.5rem;
        }

        /* 知识点按钮样式 */
        .knowledge-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #f3f4f6;
        }

        .knowledge-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 100px;
        }

        .knowledge-btn i {
            margin-right: 0.5rem;
        }

        .knowledge-btn.primary {
            background-color: #4f46e5;
            color: white;
            border: none;
        }

        .knowledge-btn.primary:hover {
            background-color: #4338ca;
            transform: translateY(-1px);
        }

        .knowledge-btn.secondary {
            background-color: white;
            color: #6b7280;
            border: 1px solid #d1d5db;
        }

        .knowledge-btn.secondary:hover {
            background-color: #f9fafb;
            color: #374151;
            transform: translateY(-1px);
        }

        .knowledge-btn.outline {
            background-color: white;
            color: #4f46e5;
            border: 1px solid #4f46e5;
        }

        .knowledge-btn.outline:hover {
            background-color: #f5f3ff;
            transform: translateY(-1px);
        }

        .interview-actions {
            display: flex;
            gap: 1rem; /* 增加间距 */
            justify-content: flex-end; /* 改为右对齐，与知识点界面一致 */
            margin-top: 1.5rem; /* 增加上边距 */
            padding-top: 1rem; /* 添加上内边距 */
            border-top: 1px solid #f3f4f6; /* 添加上边框，与知识点界面一致 */
        }
        
        /* 隐藏原来在按钮组中的AI评分按钮 */
        .interview-actions .interview-btn.ai-score {
            display: none;
        }

        .interview-btn {
            padding: 0.6rem 1.2rem; /* 与知识点按钮一致的内边距 */
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 100px; /* 与知识点按钮一致的最小宽度 */
            /* 移除 flex: 1 属性，让按钮不再拉伸 */
        }

        .interview-btn i {
            margin-right: 0.5rem;
        }

        .interview-btn.primary {
            background-color: #4f46e5;
            color: white;
            border: none;
        }

        .interview-btn.primary:hover {
            background-color: #4338ca;
            transform: translateY(-1px); /* 添加与知识点按钮一致的悬停效果 */
        }

        .interview-btn.secondary {
            background-color: white;
            color: #4b5563;
            border: 1px solid #e5e7eb;
        }

        .interview-btn.secondary:hover {
            background-color: #f9fafb;
            color: #111827;
            transform: translateY(-1px); /* 添加与知识点按钮一致的悬停效果 */
        }

        .interview-btn.outline {
            background-color: white;
            color: #4f46e5;
            border: 1px solid #4f46e5;
        }

        .interview-btn.outline:hover {
            background-color: #f5f3ff;
            transform: translateY(-1px); /* 添加与知识点按钮一致的悬停效果 */
        }

        .interview-btn.ai-score {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            position: relative;
        }

        .interview-btn.ai-score:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
                                
        .interview-btn.solution {
            background-color: white; /* 与查看答案按钮一致的背景色 */
            color: #4b5563; /* 与查看答案按钮一致的文本颜色 */
            border: 1px solid #e5e7eb; /* 与查看答案按钮一致的边框 */
            position: relative;
        }
                                
        .interview-btn.solution:hover {
            background-color: #f9fafb; /* 与查看答案按钮一致的悬停背景色 */
            color: #111827; /* 与查看答案按钮一致的悬停文本颜色 */
            transform: translateY(-1px);
        }
        
        /* 面试题答案输入框容器样式 */
        .interview-answer-container {
            position: relative;
            width: 100%;
            margin: 0 0 1.5rem 0;
        }
        
        /* 面试题答案输入框样式优化 */
        .interview-answer-input {
            width: 100%;
            min-height: 150px; /* 增加最小高度 */
            height: auto;
            padding: 1rem 120px 1rem 1rem; /* 右侧留出空间给AI评分按钮 */
            border: 2px solid #e5e7eb;
            border-radius: 12px; /* 增加圆角 */
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical; /* 允许垂直调整大小 */
            transition: all 0.3s ease;
            font-family: inherit;
            background: #fafafa;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            margin: 0;
        }
        
        /* AI评分按钮在输入框内的样式 */
        .interview-answer-ai-btn {
            position: absolute;
            bottom: 12px;
            right: 12px;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            z-index: 10;
        }
        
        .interview-answer-ai-btn:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .interview-answer-ai-btn i {
            margin-right: 0.4rem;
            font-size: 0.75rem;
        }
        
        /* 移动端适配 */
        @media (max-width: 640px) {
            .interview-answer-input {
                padding: 1rem 100px 1rem 1rem; /* 缩小右侧留空 */
            }
            
            .interview-answer-ai-btn {
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
                bottom: 10px;
                right: 10px;
            }
            
            .interview-answer-ai-btn i {
                margin-right: 0.3rem;
                font-size: 0.7rem;
            }
        }
        
        .interview-answer-input:focus {
            outline: none;
            border-color: #6366f1;
            background: white;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }
        
        .interview-answer-input:hover {
            border-color: #d1d5db;
            background: white;
        }
        
        .interview-answer-input::placeholder {
            color: #9ca3af;
            font-style: italic;
            font-size: 0.9rem;
        }
        
        /* 知识点笔记编辑框样式 */
        .knowledge-notes {
            margin-top: 1rem;
            margin-bottom: 1rem;
            border-top: 1px dashed #e5e7eb;
            padding-top: 1rem;
        }
        
        .knowledge-notes-input {
            width: 100%;
            min-height: 100px;
            padding: 0.875rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
            resize: vertical;
            transition: all 0.3s ease;
            font-family: inherit;
            background-color: #f9fafb;
        }
        
        .knowledge-notes-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background-color: white;
        }
        
        .knowledge-notes-input:hover {
            border-color: #d1d5db;
            background-color: white;
        }
        
        .knowledge-notes-input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }
        
        /* 知识点通俗讲解样式 */
        .knowledge-simple-explanation {
            margin-top: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #fef3c7;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }
        
        .knowledge-simple-explanation-title {
            font-weight: 600;
            font-size: 1rem;
            color: #92400e;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        
        .knowledge-simple-explanation-title i {
            margin-right: 0.5rem;
        }
        
        .knowledge-simple-explanation-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4b5563;
        }
        
        /* 解题思路和答案按钮区域样式 */
        .interview-helper-actions {
            display: flex;
            gap: 0.75rem;
            margin: 1.5rem 0;
        }
        
        .interview-helper-actions .interview-btn {
            flex: 1;
            justify-content: center;
            padding: 0.75rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        /* 解题思路显示区域样式 */
        .solution-area {
            margin: 0 0 1.5rem 0; /* 调整上下边距，与新布局协调 */
            padding: 1.5rem;
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4); /* 恢复绿色渐变背景 */
            border-radius: 12px;
            border-left: 4px solid #10b981; /* 恢复绿色边框 */
            display: none;
            transition: all 0.3s ease;
        }
                                
        .solution-area.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
                                
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
                                
        .solution-title {
            font-weight: 600;
            font-size: 1rem;
            color: #065f46; /* 恢复绿色标题 */
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
                                
        .solution-title i {
            margin-right: 0.5rem;
            color: #10b981; /* 恢复绿色图标 */
        }
                                
        .solution-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #374151;
        }
                                
        .solution-content h4 {
            font-weight: 600;
            color: #1f2937;
            margin: 1rem 0 0.5rem 0;
        }
                                
        .solution-content ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
                                
        .solution-content li {
            margin-bottom: 0.25rem;
        }
                                
        .solution-content code {
            background: #f3f4f6;
            color: #1f2937;
            padding: 0.125rem 0.25rem;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        
        /* 答案显示区域样式 */
        .answer-area {
            margin: 0 0 1.5rem 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            display: none;
            transition: all 0.3s ease;
        }
        
        .answer-area.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        .answer-title {
            font-weight: 600;
            font-size: 1rem;
            color: #1e40af;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        
        .answer-title i {
            margin-right: 0.5rem;
            color: #3b82f6;
        }
        
        .answer-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #374151;
        }
        
        .answer-content h4 {
            font-weight: 600;
            color: #1f2937;
            margin: 1rem 0 0.5rem 0;
        }
        
        .answer-content ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .answer-content li {
            margin-bottom: 0.25rem;
        }
        
        .answer-content code {
            background: #f3f4f6;
            color: #1f2937;
            padding: 0.125rem 0.25rem;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        
        /* AI聊天按钮样式 */
        .ai-chat-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            background: white !important;
            color: #6366f1 !important;
        }
                                
        /* 面试题笔记编辑框样式 */
        .interview-notes {
            margin-top: 1rem;
            margin-bottom: 1rem;
            border-top: 1px dashed #e5e7eb;
            padding-top: 1rem;
        }
        
        .interview-notes-input {
            width: 100%;
            min-height: 100px;
            padding: 0.875rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
            resize: vertical;
            transition: all 0.3s ease;
            font-family: inherit;
            background-color: #f9fafb;
        }
        
        .interview-notes-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background-color: white;
        }
        
        .interview-notes-input:hover {
            border-color: #d1d5db;
            background-color: white;
        }
        
        .interview-notes-input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }
        
        /* 书籍样式 */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 0;
            width: 100%;
        }
        
        .book-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #d1d5db;
        }
        
        .book-cover {
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            flex-shrink: 0;
        }
        
        .book-cover i {
            font-size: 1.5rem;
            color: white;
        }
        
        .book-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .book-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.5rem 0;
            line-height: 1.4;
        }
        
        .book-author {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0 0 0.75rem 0;
        }
        
        .book-description {
            font-size: 0.875rem;
            color: #4b5563;
            line-height: 1.5;
            margin: 0 0 1rem 0;
            flex: 1;
        }
        
        .book-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .stars {
            display: flex;
            gap: 0.125rem;
        }
        
        .stars i {
            font-size: 0.875rem;
            color: #fbbf24;
        }
        
        .stars .far {
            color: #d1d5db;
        }
        
        .rating-text {
            font-size: 0.875rem;
            font-weight: 500;
            color: #4b5563;
        }
        
        .book-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .book-btn {
            flex: 1;
            padding: 0.625rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        
        .book-btn i {
            margin-right: 0.5rem;
            font-size: 0.75rem;
        }
        
        .book-btn.primary {
            background: #6366f1;
            color: white;
        }
        
        .book-btn.primary:hover {
            background: #4f46e5;
            transform: translateY(-1px);
        }
        
        .book-btn.secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .book-btn.secondary:hover {
            background: #f1f5f9;
            color: #475569;
        }
        

        
        /* 证书样式 */
        .certificates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            padding: 0;
            width: 100%;
        }
        
        .certificate-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .certificate-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #d1d5db;
        }
        
        .certificate-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .certificate-icon i {
            font-size: 1.5rem;
            color: white;
        }
        
        .certificate-info {
            flex: 1;
        }
        
        .certificate-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.5rem 0;
            line-height: 1.4;
        }
        
        .certificate-issuer {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0 0 0.75rem 0;
        }
        
        .certificate-description {
            font-size: 0.875rem;
            color: #4b5563;
            line-height: 1.5;
            margin: 0 0 1rem 0;
        }
        
        .certificate-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .difficulty-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .difficulty-badge.beginner {
            background: #dcfce7;
            color: #166534;
        }
        
        .difficulty-badge.intermediate {
            background: #fef3c7;
            color: #92400e;
        }
        
        .difficulty-badge.advanced {
            background: #fecaca;
            color: #991b1b;
        }
        
        .validity {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .certificate-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .cert-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        
        .cert-btn i {
            margin-right: 0.5rem;
            font-size: 0.75rem;
        }
        
        .cert-btn.primary {
            background: #f59e0b;
            color: white;
        }
        
        .cert-btn.primary:hover {
            background: #d97706;
            transform: translateY(-1px);
        }
        
        .cert-btn.secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .cert-btn.secondary:hover {
            background: #f1f5f9;
            color: #475569;
        }
        
        /* 课程样式 */
        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            padding: 0;
            width: 100%;
        }
        
        .course-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 0;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .course-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #d1d5db;
        }
        
        .course-thumbnail {
            height: 120px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .course-thumbnail i {
            font-size: 3rem;
            color: white;
            opacity: 0.9;
        }
        
        .course-duration {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .course-info {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .course-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.5rem 0;
            line-height: 1.4;
        }
        
        .course-instructor {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0 0 0.75rem 0;
        }
        
        .course-description {
            font-size: 0.875rem;
            color: #4b5563;
            line-height: 1.5;
            margin: 0 0 1rem 0;
            flex: 1;
        }
        
        .course-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .course-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .level-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .level-badge.beginner {
            background: #dcfce7;
            color: #166534;
        }
        
        .level-badge.intermediate {
            background: #fef3c7;
            color: #92400e;
        }
        
        .level-badge.advanced {
            background: #fecaca;
            color: #991b1b;
        }
        
        .course-price {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .current-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: #dc2626;
        }
        
        .original-price {
            font-size: 0.875rem;
            color: #9ca3af;
            text-decoration: line-through;
        }
        
        .discount {
            background: #dc2626;
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .course-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .course-btn {
            flex: 1;
            padding: 0.625rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        
        .course-btn i {
            margin-right: 0.5rem;
            font-size: 0.75rem;
        }
        
        .course-btn.primary {
            background: #6366f1;
            color: white;
        }
        
        .course-btn.primary:hover {
            background: #4f46e5;
            transform: translateY(-1px);
        }
        
        .course-btn.secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
            flex: 0 0 auto;
            padding: 0.625rem;
        }
        
        .course-btn.secondary:hover {
            background: #f1f5f9;
            color: #dc2626;
        }
        
        /* 笔记样式 */
        .notes-container {
            width: 100%;
        }
        
        .empty-notes-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
            color: #9ca3af;
        }
        
        .empty-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        
        .empty-icon i {
            font-size: 2rem;
            color: #d1d5db;
        }
        
        .empty-notes-state h3 {
            margin: 0 0 0.75rem 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #6b7280;
        }
        
        .empty-notes-state p {
            margin: 0 0 2rem 0;
            font-size: 0.9375rem;
            line-height: 1.5;
            max-width: 400px;
        }
        
        .add-first-note-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            background: #6366f1;
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .add-first-note-btn:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        
        .note-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            position: relative;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #d1d5db;
        }
        
        .note-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .note-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin: 0;
            line-height: 1.4;
            flex: 1;
        }
        
        .note-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: 1rem;
        }
        
        .note-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }
        
        .note-action-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .note-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.8125rem;
            color: #6b7280;
        }
        
        .note-date {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .note-category {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .note-content {
            font-size: 0.9375rem;
            line-height: 1.6;
            color: #4b5563;
            margin: 0;
            white-space: pre-wrap;
        }
        
        .note-tags {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .note-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            background: #f3f4f6;
            color: #6b7280;
        }

        .interview-refresh {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .interview-refresh:hover {
            background-color: #f3f4f6;
            color: #4f46e5;
        }

        .interview-ai-badge {
            display: flex;
            align-items: center;
            color: #4f46e5;
            font-weight: 500;
            font-size: 0.875rem;
            margin-left: auto;
        }

        .interview-ai-badge i {
            margin-right: 0.5rem;
        }

        /* 面试题列表样式 */
        .content-subtitle {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin: 2rem 0 1rem 0;
        }

        .interview-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .interview-list-item {
            display: flex;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
        }

        .interview-list-item:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transform: translateX(5px);
            border-color: #d1d5db;
        }

        .interview-list-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #f3f4f6;
            color: #4b5563;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .interview-list-content {
            flex: 1;
        }

        .interview-list-title {
            font-size: 0.9375rem;
            font-weight: 500;
            color: #1f2937;
            margin: 0 0 0.5rem 0;
            line-height: 1.4;
        }

        .interview-list-tags {
            display: flex;
            gap: 0.5rem;
        }

        /* 大屏幕思维导图优化 */
        @media (min-height: 900px) and (min-width: 1400px) {
            .mindmap-card {
                height: calc(100vh - 300px);
                max-height: 90vh;
            }
            
            .mindmap-content {
                min-height: 75vh;
            }
        }
        
        /* 超大屏幕优化 */
        @media (min-height: 1080px) {
            .mindmap-card {
                height: calc(100vh - 320px);
                max-height: 95vh;
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 1400px) {
            .ai-assistant {
                width: 380px; /* 调整AI助手面板宽度 */
                height: calc(100vh - 120px); /* 保持高度限制 */
            }
            
            .assistant-message .message-content {
                width: 100%; /* AI消息在垂直布局下占满宽度 */
            }
            
            .user-message .message-content {
                max-width: 100%; /* 用户消息与AI消息保持一致的宽度 */
            }
        }
        
        @media (max-width: 1200px) {
            .results-container {
                flex-direction: column;
            }
            
            .content-layout {
                flex-direction: column;
            }
            
            .content-sidebar, .ai-assistant {
                width: 100%;
            }
            
            .ai-assistant {
                height: 450px; /* 增加移动端高度 */
                max-height: 450px;
                min-height: 400px;
            }
            
            .chat-messages {
                max-height: calc(450px - 130px); /* 适应新的高度 */
            }
            
            .assistant-message .message-content {
                width: 100%; /* AI消息移动端占满容器宽度 */
            }
            
            .user-message .message-content {
                max-width: 100%; /* 用户消息与AI消息保持一致的宽度 */
            }
            
            .mindmap-content {
                min-height: 400px;
            }
            
            /* 移动设备思维导图高度优化 */
            .mindmap-card {
                height: calc(100vh - 200px);
                min-height: 50vh;
                max-height: 80vh;
            }
        }
        
        @media (max-width: 768px) {
            .books-grid,
            .certificates-grid,
            .courses-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
                width: 100%;
            }
            
            .book-card,
            .certificate-card,
            .course-card {
                padding: 1rem;
            }
            
            .book-actions,
            .certificate-actions,
            .course-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem; /* 减小间距 */
                padding: 0.25rem 1rem; /* 保持与主样式一致的小内边距 */
                min-height: auto; /* 移动端取消最小高度限制 */
            }
            
            .results-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .content-layout {
                flex-direction: column;
            }
            
            .content-sidebar {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            /* 移动端折叠状态下的特殊处理 */
            .content-sidebar.collapsed {
                width: 100%;
                height: 60px;
                min-height: 60px;
                overflow: hidden;
            }
            
            .content-main {
                width: 100%;
            }
            
            .ai-assistant {
                width: 100%;
                height: 400px; /* 小屏幕适中的高度 */
                max-height: 400px;
                min-height: 350px;
                margin-top: 1rem; /* 添加上边距，与内容区域分开 */
            }
            
            /* 移动端隐藏拖拽控件 */
            .ai-assistant-resize-handle {
                display: none !important;
            }
            
            .chat-messages {
                max-height: calc(400px - 130px);
                padding: 0.75rem; /* 减小内边距 */
            }
            
            .message-content {
                max-width: 85%; /* AI消息小屏幕进一步增加消息宽度 */
                padding: 0.4rem 0.6rem; /* 进一步减小内边距 */
            }
            
            .user-message .message-content {
                max-width: 100%; /* 用户消息与AI消息保持一致的宽度 */
            }
        }
        
        @media (max-width: 640px) {
            .interview-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .interview-btn {
                width: 100%;
            }
        }
        
        /* API配置模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex !important;
        }
        
        .modal-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 10001;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f9fafb;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            display: flex;
            align-items: center;
        }
        
        .modal-header h3 i {
            margin-right: 0.75rem;
            color: #6366f1;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: #f3f4f6;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-description {
            margin: 0 0 1.5rem 0;
            color: #6b7280;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #111827;
        }
        
        .key-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .modal-input {
            width: 100%;
            padding: 0.75rem 1rem;
            padding-right: 3rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            box-sizing: border-box;
        }
        
        .toggle-btn {
            position: absolute;
            right: 0.75rem;
            width: 28px;
            height: 28px;
            border: none;
            background: none;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .provider-select {
            margin-bottom: 1.5rem;
        }
        
        .modal-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            background: white;
            box-sizing: border-box;
        }
        
        .provider-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        
        .provider-details h4 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
            font-weight: 600;
            color: #111827;
        }
        
        .provider-details p {
            margin: 0 0 0.5rem 0;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .provider-link {
            font-size: 0.875rem;
            color: #6366f1;
            text-decoration: none;
            font-weight: 500;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            background: #f9fafb;
        }
        
        .modal-btn {
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        
        .modal-btn-cancel {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-btn-confirm {
            background: #6366f1;
            color: white;
        }
    </style>
    

    
    <!-- 直接在head中加载Markmap库和样式 -->
    <!-- D3库 -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <!-- Markmap View -->
    <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.14.4"></script>
    <!-- Markmap Lib -->
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.14.4"></script>
    <!-- Markmap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.14.4/dist/style.css">
    
    <script>
        // 等待所有库加载完成
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🧠 DOM加载完成，开始初始化思维导图...');
            
            // 检查必要的库是否加载
            function checkLibrariesLoaded() {
                return typeof window.d3 !== 'undefined' && 
                       typeof window.markmap !== 'undefined' &&
                       window.markmap.Markmap &&
                       window.markmap.Transformer;
            }
            
            // 延迟初始化，确保所有库都已加载
            function waitForLibraries(maxAttempts = 10, attempt = 1) {
                console.log(`🔍 检查库加载状态 (尝试 ${attempt}/${maxAttempts})...`);
                
                if (checkLibrariesLoaded()) {
                    console.log('✅ 所有Markmap库已加载完成');
                    initializeMarkmap();
                } else if (attempt < maxAttempts) {
                    console.log('⏳ 等待库加载...');
                    setTimeout(() => waitForLibraries(maxAttempts, attempt + 1), 1000);
                } else {
                    console.error('❌ Markmap库加载失败，使用降级方案');
                    showMarkmapFallback();
                }
            }
            
            // 开始检查库加载状态
            waitForLibraries();
        });
        
        function initializeMarkmap() {
            console.log('🚀 开始初始化思维导图...');
            
            // 检查必要的库是否已加载
            if (typeof window.d3 === 'undefined') {
                console.error('❌ d3库未加载');
                showMarkmapFallback();
                return;
            }
            
            if (typeof window.markmap === 'undefined' || !window.markmap.Markmap || !window.markmap.Transformer) {
                console.error('❌ markmap库未加载或不完整');
                showMarkmapFallback();
                return;
            }
            
            try {
                // 明确的思维导图内容（使用标准Markdown格式）
                const markdown = `# 后端工程师学习路线

## 🔥 编程语言
### Java
- 基础语法和面向对象
- 集合框架和数据结构
- 多线程和并发编程
- JVM原理和调优

### Python
- 基础语法和数据类型
- 网络编程和Web框架
- 数据分析和机器学习

### Go
- 并发模型和Goroutine
- 内存管理和性能优化
- 微服务和云原生开发

## 🏗️ 框架技术
### Spring生态
- Spring Framework 核心
- Spring Boot 微服务
- Spring Cloud 分布式
- Spring Security 安全框架

### 数据库框架
- MyBatis ORM框架
- Hibernate JPA规范
- 数据库连接池优化

## 📊 数据库技术
### 关系型数据库
- MySQL 设计和优化
- PostgreSQL 高级特性
- 索引优化和查询优化

### NoSQL数据库
- Redis 缓存和数据结构
- MongoDB 文档数据库
- Elasticsearch 搜索引擎

## 📝 中间件技术
### 消息队列
- Kafka 大数据流处理
- RabbitMQ 可靠消息传递
- 消息队列选型和优化

### 分布式协调
- Zookeeper 配置管理
- etcd 分布式键值存储
- 服务发现和注册

## 🏢 架构设计
### 微服务架构
- 服务拆分和设计原则
- API网关和负载均衡
- 服务治理和监控

### 分布式系统
- CAP理论和一致性
- 分布式事务处理
- 高可用和容灾设计

## 🚀 DevOps和部署
### 容器化技术
- Docker 容器部署
- Kubernetes 容器编排
- 容器监控和日志

### CI/CD 流水线
- Jenkins 自动化构建
- GitLab CI 持续集成
- 代码质量和测试策略

## 🔒 安全和性能
### 安全防护
- 身份认证和授权
- 数据加密和传输安全
- 常见攻击防护

### 性能优化
- 系统性能监控
- 数据库查询优化
- 缓存策略和并发优化`;
                
                // 初始化思维导图
                const mindmapElement = document.getElementById('mindmapContent');
                if (!mindmapElement) {
                    console.error('❌ 找不到思维导图容器元素');
                    return;
                }
                
                // 清空元素内容
                mindmapElement.innerHTML = '';
                
                // 创建SVG元素
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '100%');
                svg.setAttribute('height', '600');
                // 添加缩放效果的初始样式，使用小一点的比例，然后过渡到正常大小
                svg.style.transform = 'scale(0.95)';
                svg.style.opacity = '0.9';
                svg.style.background = '#fff';
                svg.style.border = '1px solid #e5e7eb';
                svg.style.borderRadius = '8px';
                mindmapElement.appendChild(svg);
                
                console.log('🎨 SVG元素创建完成');
                
                // 创建转换器
                const transformer = new window.markmap.Transformer();
                console.log('🔄 Transformer创建完成');
                
                // 验证并修复数据
                const validateData = (data) => {
                    if (!data) return data;
                    
                    // 递归验证每个节点
                    const validateNode = (node) => {
                        if (!node) return;
                        
                        // 修复可能的NaN值
                        if (!node.x || isNaN(node.x)) node.x = 0;
                        if (!node.y || isNaN(node.y)) node.y = 0;
                        
                        // 确保其他关键属性存在
                        if (typeof node.depth === 'undefined') node.depth = 0;
                        if (!node.parent) node.parent = null;
                        if (!node.data) node.data = {};
                        if (!node.children) node.children = [];
                        
                        // 验证所有坐标和变换相关的属性
                        ['x0', 'y0', 'x1', 'y1', 'height', 'width'].forEach(prop => {
                            if (node[prop] && isNaN(node[prop])) node[prop] = 0;
                        });
                        
                        // 处理子节点
                        if (node.children && Array.isArray(node.children)) {
                            node.children.forEach(validateNode);
                        }
                    };
                    
                    validateNode(data);
                    return data;
                };
                
                // 转换markdown
                const { root } = transformer.transform(markdown);
                console.log('🌳 Markdown转换完成');
                
                // 验证并修复数据
                const validatedRoot = validateData(root);
                
                // 创建Markmap实例
                const markmapInstance = window.markmap.Markmap.create(svg, {
                    duration: 500,
                    zoom: true,
                    pan: true,
                    autoFit: true, // 启用自动适配，与折叠全部按钮保持一致
                    initialExpandLevel: -1, // 显示所有节点，但通过其他参数控制大小
                    color: (d) => {
                        // 根据层级设置不同颜色
                        const colors = ['#6366f1', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#ef4444'];
                        return colors[(d.depth || 0) % colors.length]; // 添加默认值0防止undefined
                    }
                    // 移除自定义间距和尺寸参数，让autoFit自动处理最佳显示效果
                }, validatedRoot);
                
                // 🔧 关键修复：监听Markmap的节点点击事件，在节点展开/折叠后重新绑定事件
                if (markmapInstance && markmapInstance.svg) {
                    markmapInstance.svg.on('click', function() {
                        console.log('🔄 检测到Markmap节点被点击，延迟重新绑定事件...');
                        // 延迟重新绑定事件，等待DOM更新完成
                        setTimeout(() => {
                            addMindmapNodeClickEvents();
                        }, 300);
                    });
                }
                
                // 添加额外处理，防止初始化过程中的错误
                if (markmapInstance && typeof markmapInstance.setData === 'function') {
                    // 尝试为MarkmapInstance添加错误处理函数
                    markmapInstance._handleTransformError = function(node) {
                        if (!node) return;
                        if (isNaN(node.x) || isNaN(node.y)) {
                            node.x = 0;
                            node.y = 0;
                        }
                    };
                }
                
                console.log('✅ Markmap实例创建完成');
                
                // 保存实例到全局变量，供后续访问
                window.currentMarkmapInstance = markmapInstance;
                
                // 添加专门的CSS样式来优化文字显示
                const mindmapStyles = document.createElement('style');
                mindmapStyles.innerHTML = `
                    /* 温和的初始化过渡效果 */
                    #mindmapContent svg {
                        transition: all 0.5s ease-in-out;
                    }
                    
                    /* 优化思维导图文字显示效果 */
                    #mindmapContent svg text {
                        font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif !important;
                        font-size: 14px !important;
                        font-weight: 500 !important;
                        fill: #1f2937 !important;
                        stroke: none !important;
                        text-rendering: optimizeLegibility !important;
                        -webkit-font-smoothing: antialiased !important;
                        -moz-osx-font-smoothing: grayscale !important;
                    }
                    
                    /* 根据层级调整字体大小 - autoFit会自动处理缩放 */
                    #mindmapContent svg g[data-depth="0"] text {
                        font-size: 18px !important;
                        font-weight: 700 !important;
                        fill: #111827 !important;
                    }
                    
                    #mindmapContent svg g[data-depth="1"] text {
                        font-size: 16px !important;
                        font-weight: 600 !important;
                        fill: #374151 !important;
                    }
                    
                    #mindmapContent svg g[data-depth="2"] text {
                        font-size: 14px !important;
                        font-weight: 500 !important;
                        fill: #4b5563 !important;
                    }
                    
                    #mindmapContent svg g[data-depth="3"] text {
                        font-size: 13px !important;
                        font-weight: 500 !important;
                        fill: #6b7280 !important;
                    }
                    
                    #mindmapContent svg g[data-depth="4"] text {
                        font-size: 12px !important;
                        font-weight: 400 !important;
                        fill: #9ca3af !important;
                    }
                    
                    /* 优化节点圆圈和连接线 */
                    #mindmapContent svg circle {
                        stroke-width: 2 !important;
                        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)) !important;
                    }
                    
                    #mindmapContent svg path {
                        stroke-width: 3 !important;
                        opacity: 0.7 !important;
                    }
                    
                    /* 优化整体SVG显示 */
                    #mindmapContent svg {
                        background: #fafbfc !important;
                        border-radius: 8px !important;
                    }
                    
                    /* 防止文字被截断 */
                    #mindmapContent svg foreignObject {
                        overflow: visible !important;
                    }
                    
                    /* 确保文本包装正确 */
                    #mindmapContent svg .mm-t {
                        white-space: nowrap !important;
                        overflow: visible !important;
                    }
                `;
                document.head.appendChild(mindmapStyles);
                
                // 不立即进行适配，等待完全初始化后再显示
                console.log('✅ Markmap实例创建完成，等待初始化...');
                
                // 强化的多次重试适配机制
                const autoFitWithRetry = () => {
                    const maxRetries = 3; // 减少重试次数
                    const delays = [200, 500, 800]; // 调整延迟时间
                    
                    const attemptFit = (attempt) => {
                        setTimeout(() => {
                            try {
                                console.log(`🔄 第${attempt + 1}次适配尝试...`);
                                
                                // 验证SVG内容是否正确渲染
                                const hasValidContent = () => {
                                    const gElements = svg.querySelectorAll('g');
                                    const circles = svg.querySelectorAll('circle');
                                    const texts = svg.querySelectorAll('text');
                                    const paths = svg.querySelectorAll('path');
                                    
                                    return gElements.length > 0 && (circles.length > 0 || texts.length > 0 || paths.length > 0);
                                };
                                
                                if (!hasValidContent()) {
                                    console.log('🔍 SVG内容未正确渲染，等待下次尝试');
                                    if (attempt < maxRetries - 1) {
                                        attemptFit(attempt + 1);
                                    }
                                    return;
                                }
                                
                                // 先检查根节点是否有效
                                if (root && typeof root === 'object') {
                                    // 确保每个节点都有有效的坐标
                                    const validateNode = (node) => {
                                        if (node) {
                                            if (!node.x) node.x = 0;
                                            if (!node.y) node.y = 0;
                                            if (node.children && Array.isArray(node.children)) {
                                                node.children.forEach(validateNode);
                                            }
                                        }
                                    };
                                    
                                    validateNode(root);
                                    
                                    // 修复现有的SVG元素
                                    const gElements = svg.querySelectorAll('g');
                                    gElements.forEach(g => {
                                        const transform = g.getAttribute('transform');
                                        if (transform && transform.includes('NaN')) {
                                            console.log('🚨 修复无效transform:', transform);
                                            g.setAttribute('transform', 'translate(400, 300) scale(0.6)');
                                        }
                                    });
                                    
                                    // 尝试适配
                                    if (markmapInstance && typeof markmapInstance.fit === 'function') {
                                        markmapInstance.fit();
                                        console.log(`✅ 第${attempt + 1}次适配成功`);
                                        
                                        // 适配成功后，温和地过渡到正常大小
                                        setTimeout(() => {
                                            svg.style.transform = 'scale(1)';
                                            svg.style.opacity = '1';
                                        }, 100);
                                        
                                        
                                    } else {
                                        console.warn('⚠️ markmapInstance或fit方法不可用');
                                        // 备用方案：直接设置主群组的transform
                                        const mainGroup = svg.querySelector('g');
                                        if (mainGroup) {
                                            mainGroup.setAttribute('transform', 'translate(400, 300) scale(0.55)');
                                            console.log('✅ 使用备用方案设置Transform');
                                            
                                            // 应用平滑过渡
                                            setTimeout(() => {
                                                svg.style.transform = 'scale(1)';
                                                svg.style.opacity = '1';
                                            }, 100);
                                        }
                                    }
                                    
                                } else {
                                    console.warn('⚠️ 根节点无效，跳过自动适配');
                                    if (attempt < maxRetries - 1) {
                                        attemptFit(attempt + 1);
                                    }
                                }
                                
                            } catch (error) {
                                console.error(`❌ 第${attempt + 1}次适配失败:`, error);
                                if (attempt < maxRetries - 1) {
                                    attemptFit(attempt + 1);
                                }
                            }
                        }, delays[attempt]);
                    };
                    
                    // 开始重试
                    attemptFit(0);
                };
                
                // 执行强化的适配
                autoFitWithRetry();
                
                // 为控制按钮添加事件
                
                // 缩放控制变量
                let currentScale = 1.0; // 使用标准缩放，autoFit会自动处理最佳显示
                const scaleStep = 0.2;
                const maxScale = 3.0;
                const minScale = 0.3;
                
                // 放大按钮
                const zoomInBtn = document.getElementById('zoomIn');
                if (zoomInBtn) {
                    zoomInBtn.addEventListener('click', () => {
                        currentScale = Math.min(currentScale + scaleStep, maxScale);
                        applyCustomScale(currentScale);
                        console.log('🔍 放大到:', currentScale);
                    });
                }
                
                // 缩小按钮
                const zoomOutBtn = document.getElementById('zoomOut');
                if (zoomOutBtn) {
                    zoomOutBtn.addEventListener('click', () => {
                        currentScale = Math.max(currentScale - scaleStep, minScale);
                        applyCustomScale(currentScale);
                        console.log('🔍 缩小到:', currentScale);
                    });
                }
                
                // 重置缩放按钮
                const resetZoomBtn = document.getElementById('resetZoom');
                if (resetZoomBtn) {
                    resetZoomBtn.addEventListener('click', () => {
                        currentScale = 1.0;
                        applyCustomScale(currentScale);
                        console.log('🔄 重置缩放到:', currentScale);
                    });
                }
                
                // 应用缩放的函数
                const applyCustomScale = (scale) => {
                    try {
                        const mainGroup = svg.querySelector('g');
                        if (mainGroup) {
                            // 计算中心位置
                            const svgRect = svg.getBoundingClientRect();
                            const centerX = svgRect.width / 2;
                            const centerY = svgRect.height / 2;
                            
                            // 应用变换：先居中再缩放
                            const transform = `translate(${centerX}, ${centerY}) scale(${scale})`;
                            mainGroup.setAttribute('transform', transform);
                            
                            console.log(`✅ 应用缩放: ${scale}, Transform: ${transform}`);
                        } else {
                            console.warn('⚠️ 未找到主群组元素');
                        }
                    } catch (error) {
                        console.error('❌ 应用缩放失败:', error);
                    }
                };
                
                const expandAllBtn = document.getElementById('expandAll');
                if (expandAllBtn) {
                    expandAllBtn.addEventListener('click', () => {
                        console.log('🔍 展开所有节点');
                        try {
                            if (markmapInstance && markmapInstance.state && markmapInstance.state.data) {
                                // 使用现有实例的展开功能
                                const expandNodeRecursively = (node) => {
                                    if (node) {
                                        // 清除折叠状态
                                        if (node.payload) {
                                            delete node.payload.fold;
                                        }
                                        if (node.children && Array.isArray(node.children)) {
                                            node.children.forEach(expandNodeRecursively);
                                        }
                                    }
                                };
                                
                                const rootData = markmapInstance.state.data;
                                expandNodeRecursively(rootData);
                                
                                // 重新渲染现有实例
                                markmapInstance.setData(rootData);
                                
                                // 🔧 关键修复：重新绑定事件
                                setTimeout(() => {
                                    addMindmapNodeClickEvents();
                                }, 500);
                                
                                console.log('✅ 展开所有节点成功');
                            } else if (markmapInstance && typeof markmapInstance.fit === 'function') {
                                // 备用方案：重新适配视图
                                console.log('⚠️ 使用备用方案：重新适配视图');
                                markmapInstance.fit();
                                
                                // 🔧 关键修复：重新绑定事件
                                setTimeout(() => {
                                    addMindmapNodeClickEvents();
                                }, 500);
                            } else {
                                console.warn('⚠️ Markmap实例或相关方法不可用');
                            }
                        } catch (error) {
                            console.error('❌ 展开节点时出错:', error);
                        }
                    });
                }
                
                const collapseAllBtn = document.getElementById('collapseAll');
                if (collapseAllBtn) {
                    collapseAllBtn.addEventListener('click', () => {
                        console.log('📋 折叠所有节点');
                        try {
                            if (markmapInstance && markmapInstance.state && markmapInstance.state.data) {
                                // 使用现有实例的折叠功能
                                const collapseNodeRecursively = (node, level = 0) => {
                                    if (node && level > 0) {
                                        // 折叠除了根节点以外的所有节点
                                        node.payload = node.payload || {};
                                        node.payload.fold = 1; // 1表示折叠
                                    }
                                    if (node.children && Array.isArray(node.children)) {
                                        node.children.forEach(child => collapseNodeRecursively(child, level + 1));
                                    }
                                };
                                
                                const rootData = markmapInstance.state.data;
                                collapseNodeRecursively(rootData);
                                
                                // 重新渲染现有实例
                                markmapInstance.setData(rootData);
                                
                                // 🔧 关键修复：重新绑定事件
                                setTimeout(() => {
                                    addMindmapNodeClickEvents();
                                }, 500);
                                
                                console.log('✅ 折叠所有节点成功');
                            } else if (markmapInstance && typeof markmapInstance.fit === 'function') {
                                // 备用方案：如果没有state数据，就简单重新适配
                                console.log('⚠️ 使用备用方案：重新适配视图');
                                markmapInstance.fit();
                                
                                // 🔧 关键修复：重新绑定事件
                                setTimeout(() => {
                                    addMindmapNodeClickEvents();
                                }, 500);
                            } else {
                                console.warn('⚠️ Markmap实例或相关方法不可用');
                            }
                        } catch (error) {
                            console.error('❌ 折叠节点时出错:', error);
                        }
                    });
                }
                
                const downloadMindmapBtn = document.getElementById('downloadMindmap');
                if (downloadMindmapBtn) {
                    downloadMindmapBtn.addEventListener('click', () => {
                        console.log('💾 下载思维导图');
                        // 获取SVG内容并下载
                        const svgData = svg.outerHTML;
                        const blob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = '后端工程师学习路线图.svg';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                        alert('思维导图已下载！');
                    });
                }
                
                console.log('🎉 思维导图初始化完成！已自动适配显示全部内容');
                
                // 为思维导图节点添加点击事件，可以发送到AI助手
                addMindmapNodeClickEvents();
                
                // 修复最常见的SVG transform错误
                const fixSvgTransformErrors = () => {
                    console.log('🔧 尝试修复SVG transform错误...');
                    try {
                        // 获取所有g元素
                        const gElements = svg.querySelectorAll('g');
                        let fixedCount = 0;
                        
                        // 检查每个g元素的transform属性
                        gElements.forEach(g => {
                            const transform = g.getAttribute('transform');
                            if (transform && transform.includes('NaN')) {
                                // 发现无效的变换，将其设置为有效值
                                console.log('🚨 发现无效的transform:', transform);
                                g.setAttribute('transform', 'translate(0,0) scale(1)');
                                fixedCount++;
                            }
                        });
                        
                        console.log(`✅ SVG错误修复完成: 共修复${fixedCount}个节点`);
                    } catch (error) {
                        console.error('❌ 修复SVG错误时出错:', error);
                    }
                };
                
                // 在初始化后延迟执行修复
                setTimeout(() => {
                    fixSvgTransformErrors();
                }, 500);
                
            } catch (error) {
                console.error('❌ 初始化思维导图时出错:', error);
                showMarkmapFallback();
            }
        }
        
        function showMarkmapFallback() {
            console.log('🚑 显示思维导图降级方案');
            const mindmapElement = document.getElementById('mindmapContent');
            if (mindmapElement) {
                mindmapElement.innerHTML = `
                    <div class="mindmap-fallback" style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        height: 100%;
                        min-height: 400px;
                        text-align: center;
                        padding: 2rem;
                        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                        border: 1px solid #e5e7eb;
                        border-radius: 8px;
                    ">
                        <div style="
                            width: 80px;
                            height: 80px;
                            border-radius: 50%;
                            background: #fbbf24;
                            color: white;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 2rem;
                            margin-bottom: 1.5rem;
                            animation: pulse 2s infinite;
                        ">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h3 style="
                            font-size: 1.25rem;
                            font-weight: 600;
                            color: #111827;
                            margin: 0 0 1rem 0;
                        ">正在加载思维导图...</h3>
                        <p style="
                            font-size: 0.875rem;
                            color: #6b7280;
                            line-height: 1.6;
                            margin: 0 0 1.5rem 0;
                            max-width: 400px;
                        ">如果长时间未加载，可能是网络连接问题或浏览器兼容性问题。请尝试以下操作：</p>
                        
                        <!-- 操作建议 -->
                        <div style="
                            display: flex;
                            flex-direction: column;
                            gap: 0.75rem;
                            margin-bottom: 1.5rem;
                            text-align: left;
                        ">
                            <div style="display: flex; align-items: center; color: #4b5563;">
                                <i class="fas fa-redo" style="margin-right: 0.5rem; color: #6366f1;"></i>
                                <span>刷新页面重试</span>
                            </div>
                            <div style="display: flex; align-items: center; color: #4b5563;">
                                <i class="fas fa-wifi" style="margin-right: 0.5rem; color: #6366f1;"></i>
                                <span>检查网络连接</span>
                            </div>
                            <div style="display: flex; align-items: center; color: #4b5563;">
                                <i class="fas fa-browser" style="margin-right: 0.5rem; color: #6366f1;"></i>
                                <span>更新浏览器版本</span>
                            </div>
                        </div>
                        
                        <!-- 重试按钮 -->
                        <button onclick="location.reload()" style="
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            border: none;
                            background: #6366f1;
                            color: white;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " 
                        onmouseover="this.style.background='#4f46e5'" 
                        onmouseout="this.style.background='#6366f1'">
                            <i class="fas fa-redo" style="margin-right: 0.5rem;"></i>
                            重新加载页面
                        </button>
                        
                        <!-- 简化版本提示 -->
                        <div style="
                            margin-top: 2rem;
                            padding: 1rem;
                            background: rgba(99, 102, 241, 0.1);
                            border-radius: 6px;
                            border-left: 4px solid #6366f1;
                        ">
                            <p style="
                                margin: 0;
                                font-size: 0.75rem;
                                color: #4b5563;
                                line-height: 1.5;
                            ">
                                <strong>💡 提示：</strong>
                                您也可以通过左侧导航查看其他学习资料，
                                包括知识点、面试题、课程推荐等内容。
                            </p>
                        </div>
                    </div>
                    
                    <style>
                        @keyframes pulse {
                            0% { opacity: 1; transform: scale(1); }
                            50% { opacity: 0.7; transform: scale(1.05); }
                            100% { opacity: 1; transform: scale(1); }
                        }
                    </style>
                `;
            }
        }
        
        // 为思维导图节点添加点击事件的函数
        function addMindmapNodeClickEvents() {
            console.log('🖱️ 为思维导图节点添加点击事件...');
            
            // 获取思维导图容器
            const mindmapContent = document.getElementById('mindmapContent');
            if (!mindmapContent) {
                console.warn('⚠️ 未找到思维导图容器');
                return;
            }
            
            // 🔧 改进：移除旧的事件监听器，避免重复绑定
            if (mindmapContent._mindmapClickHandlerAdded) {
                console.log('🔄 清理旧的事件监听器...');
                // 标记已存在，需要重新绑定
            }
            
            // 🔧 新增：使用事件委托模式处理动态生成的节点
            const handleNodeClick = (e) => {
                // 检查点击的元素是否是文本节点或foreignObject中的div
                const target = e.target;
                const isTextNode = target.tagName === 'text' || 
                                 (target.tagName === 'DIV' && target.closest('foreignObject'));
                
                if (!isTextNode) return;
                
                e.stopPropagation(); // 阻止事件冒泡
                
                // 获取节点文本内容
                const nodeText = target.textContent || target.innerText || '';
                
                if (nodeText.trim()) {
                    console.log('💬 点击了思维导图节点:', nodeText);
                    
                    // 构建发送到AI助手的消息
                    const aiMessage = `请帮我详细介绍一下「${nodeText}」这个技术领域的学习路线和关键知识点。

请包括以下内容：
1. 核心概念和原理
2. 学习顺序和前置知识
3. 实际应用场景和项目实践
4. 学习资源和参考资料
5. 常见问题和注意事项

请给出详细和实用的学习指导。`;
                    
                    // 发送消息到AI助手
                    sendMessageToAI(aiMessage);
                    
                    // 给用户视觉反馈
                    target.style.backgroundColor = 'rgba(99, 102, 241, 0.1)';
                    target.style.border = '2px solid #6366f1';
                    
                    // 1.5秒后恢复样式
                    setTimeout(() => {
                        target.style.backgroundColor = '';
                        target.style.border = '';
                    }, 1500);
                    
                    console.log('✅ 已将节点内容发送到AI助手');
                }
            };
            
            // 🔧 改进：使用事件委托，一次性为整个SVG容器添加点击监听
            mindmapContent.addEventListener('click', handleNodeClick);
            mindmapContent._mindmapClickHandlerAdded = true;
            
            console.log('🎯 已使用事件委托模式为思维导图容器添加点击事件');
            
            // 等待SVG元素完全加载，为所有节点添加样式
            const waitForSvgElements = () => {
                const svg = mindmapContent.querySelector('svg');
                if (!svg) {
                    console.warn('⚠️ SVG元素尚未生成，等待中...');
                    setTimeout(waitForSvgElements, 500);
                    return;
                }
                
                // 查找所有文本节点（包括 foreignObject 中的文本）
                const textElements = svg.querySelectorAll('text, foreignObject div');
                console.log(`🔍 找到 ${textElements.length} 个可点击的节点`);
                
                textElements.forEach((element, index) => {
                    // 🔧 改进：检查是否已经添加过样式，避免重复设置
                    if (element._mindmapStylesAdded) {
                        return; // 跳过已经处理过的元素
                    }
                    
                    // 为每个文本节点添加样式
                    element.style.cursor = 'pointer';
                    element.style.userSelect = 'none';
                    element.style.transition = 'all 0.2s ease'; // 添加过渡效果
                    
                    // 添加悬停效果
                    element.addEventListener('mouseenter', function() {
                        this.style.opacity = '0.7';
                        this.style.transform = 'scale(1.05)';
                    });
                    
                    element.addEventListener('mouseleave', function() {
                        this.style.opacity = '1';
                        this.style.transform = 'scale(1)';
                    });
                    
                    // 标记已处理
                    element._mindmapStylesAdded = true;
                });
                
                console.log(`✅ 成功为 ${textElements.length} 个节点添加了样式和事件委托`);
            };
            
            // 开始等待SVG元素
            waitForSvgElements();
        }
    </script>
</head>
<body>
    <!-- 顶部标题栏 -->
    <header class="results-header">
        <!-- 返回箭头 -->
        <button class="back-arrow-btn" onclick="goBackToJobInput()" title="返回职位输入页面">
            <i class="fas fa-arrow-left"></i>
        </button>
        
        <h1 class="results-title">
            <i class="fas fa-graduation-cap"></i>
            <span id="jobTitleDisplay">后端工程师</span>
        </h1>
        
        <div class="results-actions">
<button class="result-action-btn" id="configApiBtn" onclick="openApiConfigModal(); console.log('🛠️ 内联事件被触发');">
    <i class="fas fa-cog"></i>
    配置API密钥
</button>
            <button class="result-action-btn" id="saveBtn">
                <i class="fas fa-save"></i>
                保存
            </button>
            <button class="result-action-btn" id="exportPdfBtn">
                <i class="fas fa-file-pdf"></i>
                导出PDF
            </button>
            <button class="result-action-btn" id="exportFeishuBtn">
                <i class="fas fa-file-alt"></i>
                导出飞书文档
            </button>
        </div>
    </header>
    
    <!-- 主要内容容器 -->
    <div class="results-container">
        <!-- 三列布局 -->
        <div class="content-layout">
            <!-- 左侧目录 -->
            <aside class="content-sidebar">
                <div class="sidebar-header">
                    <h3>目录</h3>
                    <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="折叠/展开目录">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                
                <!-- 主内容目录 -->
                <div class="sidebar-section">
                    
                    <ul class="content-nav-list">
                        <li class="nav-item active" data-target="mindmap">
                            <i class="fas fa-project-diagram"></i>
                            <span>思维导图</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="knowledge">
                            <i class="fas fa-lightbulb"></i>
                            <span>知识点</span>
                            <span class="item-count" id="knowledgeCount">(20)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="interview">
                            <i class="fas fa-question-circle"></i>
                            <span>高频面试题</span>
                            <span class="item-count" id="interviewCount">(15)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="books">
                            <i class="fas fa-book"></i>
                            <span>推荐书籍</span>
                            <span class="item-count" id="booksCount">(8)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="certificates">
                            <i class="fas fa-certificate"></i>
                            <span>证书</span>
                            <span class="item-count" id="certificatesCount">(5)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="courses">
                            <i class="fas fa-graduation-cap"></i>
                            <span>推荐课程</span>
                            <span class="item-count" id="coursesCount">(12)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="notes">
                            <i class="fas fa-sticky-note"></i>
                            <span>我的笔记</span>
                            <span class="item-count" id="notesCount">(0)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                    </ul>
                </div>
            </aside>

            <!-- 中间内容区域 -->
            <main class="content-main">
                <!-- 思维导图区域默认显示 -->
                <div class="content-section active" id="mindmapSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-project-diagram"></i>
                            思维导图
                        </h2>
                        <div>
                            <button class="expand-all-btn" id="zoomIn">
                                <i class="fas fa-search-plus"></i>
                                放大
                            </button>
                            <button class="expand-all-btn" id="zoomOut">
                                <i class="fas fa-search-minus"></i>
                                缩小
                            </button>
                            <button class="expand-all-btn" id="resetZoom">
                                <i class="fas fa-expand-arrows-alt"></i>
                                重置
                            </button>
                            <button class="expand-all-btn" id="expandAll">
                                <i class="fas fa-expand-arrows-alt"></i>
                                展开全部
                            </button>
                            <button class="expand-all-btn" id="collapseAll">
                                <i class="fas fa-compress-arrows-alt"></i>
                                折叠全部
                            </button>
                            <button class="expand-all-btn" id="downloadMindmap">
                                <i class="fas fa-download"></i>
                                下载
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="mindmap-card">
                            <div class="mindmap-content" id="mindmapContent">
                                <!-- 思维导图内容将动态加载 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 面试题内容 -->
                <div class="content-section" id="interviewSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-question-circle"></i>
                            高频面试题
                        </h2>
                    </div>
                    <div class="section-content">
                        <!-- 面试题卡片 -->
                        <div class="interview-card">
                            <div class="interview-question-container" style="position: relative; margin-bottom: 1rem;">
                                <h3 class="interview-question">什么是Spring Boot的自动配置机制？请说明其工作原理和优势</h3>
                                <button class="ai-chat-btn" onclick="startAIChat('spring-boot-auto-config')" title="与AI助手讨论此题目" style="
                                    position: absolute;
                                    top: 50%;
                                    right: -1.5rem;
                                    transform: translateY(-50%);
                                    width: 36px;
                                    height: 36px;
                                    border: none;
                                    background: rgba(255, 255, 255, 0.9);
                                    color: #6366f1;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                                    backdrop-filter: blur(4px);
                                    z-index: 10;
                                ">
                                    <i class="fas fa-robot" style="font-size: 16px;"></i>
                                </button>
                            </div>
                            <div class="interview-tags">
                                <span class="interview-tag primary">中等</span>
                                <span class="interview-tag tech">Spring Boot</span>
                                <span class="interview-tag secondary">后端开发</span>
                            </div>
                                                    
                            <!-- 解题思路和答案按钮区域 -->
                            <div class="interview-helper-actions" style="display: flex; gap: 0.75rem; margin: 1.5rem 0;">
                                <button class="interview-btn solution" onclick="showSolution('spring-boot-auto-config')" style="flex: 1;">
                                    <i class="fas fa-lightbulb"></i>
                                    解题思路
                                </button>
                                <button class="interview-btn secondary" onclick="showAnswer('spring-boot-auto-config')" style="flex: 1;">
                                    <i class="fas fa-eye"></i>
                                    查看答案
                                </button>
                            </div>
                            
                            <!-- 解题思路区域 -->
                            <div class="solution-area" id="solution-spring-boot-auto-config">
                                <div class="solution-title">
                                    <i class="fas fa-lightbulb"></i>
                                    Spring Boot自动配置解题思路
                                </div>
                                <div class="solution-content">
                                    <h4>1. 理解题目要求</h4>
                                    <p>面试官想了解你对Spring Boot自动配置机制的理解程度，包括：</p>
                                    <ul>
                                        <li>自动配置的核心原理和实现方式</li>
                                        <li>@EnableAutoConfiguration注解的作用</li>
                                        <li>条件注解（@Conditional）的使用</li>
                                        <li>自定义自动配置类的方法</li>
                                    </ul>
                                    
                                    <h4>2. 回答要点</h4>
                                    <ul>
                                        <li><strong>核心机制：</strong>基于@EnableAutoConfiguration注解和spring.factories文件</li>
                                        <li><strong>工作原理：</strong>通过条件注解判断类路径和配置来决定是否启用某个配置</li>
                                        <li><strong>优势：</strong>零配置启动、约定大于配置、提高开发效率</li>
                                    </ul>
                                    
                                    <h4>3. 示例代码</h4>
                                    <p>准备一个自动配置的示例：</p>
                                    <pre style="background: #f8f9fa; padding: 1rem; border-radius: 6px; overflow-x: auto;"><code>@Configuration
@ConditionalOnClass(DataSource.class)
@EnableConfigurationProperties(DataSourceProperties.class)
public class DataSourceAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean
    public DataSource dataSource(DataSourceProperties properties) {
        return properties.initializeDataSourceBuilder().build();
    }
}</code></pre>
                                    
                                    <h4>4. 注意事项</h4>
                                    <ul>
                                        <li>说明@ConditionalOnClass等条件注解的作用</li>
                                        <li>解释spring.factories文件的配置方式</li>
                                        <li>强调自动配置与手动配置的优先级</li>
                                    </ul>
                                </div>
                            </div>
                            

                            <!-- 答案显示区域 -->
                            <div class="answer-area" id="answer-spring-boot-auto-config">
                                <div class="answer-title">
                                    <i class="fas fa-check-circle"></i>
                                    参考答案
                                </div>
                                <div class="answer-content">
                                    <h4>Spring Boot自动配置的定义和原理</h4>
                                    <p><strong>定义：</strong>Spring Boot自动配置是一种基于条件的配置机制，能够根据类路径、属性文件和已有的Bean来自动配置Spring应用程序。</p>
                                    
                                    <p><strong>工作原理：</strong>通过@EnableAutoConfiguration注解启动自动配置，Spring Boot会扫描META-INF/spring.factories文件中的配置类，并根据@Conditional系列注解的条件来决定是否加载对应的配置类。</p>
                                    
                                    <h4>核心组件和应用场景</h4>
                                    <ul>
                                        <li><strong>数据源配置：</strong>自动配置DataSource、JPA、MyBatis等数据层组件</li>
                                        <li><strong>Web配置：</strong>自动配置SpringMVC、嵌入式容器、静态资源处理</li>
                                        <li><strong>安全配置：</strong>自动配置Spring Security的基本安全策略</li>
                                        <li><strong>缓存配置：</strong>自动配置Redis、Ehcache等缓存方案</li>
                                        <li><strong>消息队列：</strong>自动配置RabbitMQ、Kafka等消息中间件</li>
                                    </ul>
                                    
                                    <h4>代码示例</h4>
                                    <pre style="background: #f8f9fa; padding: 1rem; border-radius: 6px; overflow-x: auto;"><code>// 示例1：自定义自动配置类
@Configuration
@ConditionalOnClass(RedisTemplate.class)
@EnableConfigurationProperties(RedisProperties.class)
public class MyRedisAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean(name = "redisTemplate")
    public RedisTemplate<String, Object> redisTemplate(
            RedisConnectionFactory connectionFactory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory);
        return template;
    }
}

// 示例2：条件注解的使用
@Configuration
@ConditionalOnProperty(name = "app.feature.enabled", havingValue = "true")
public class FeatureConfiguration {
    // 只有当配置项app.feature.enabled=true时才会加载此配置
}</code></pre>
                                    
                                    <h4>优势和注意事项</h4>
                                    <ul>
                                        <li><strong>优势：</strong>零配置启动、约定大于配置、快速搭建项目原型</li>
                                        <li><strong>自定义配置：</strong>可以通过application.properties覆盖默认配置</li>
                                        <li><strong>排除自动配置：</strong>使用@EnableAutoConfiguration(exclude={...})排除不需要的配置</li>
                                        <li><strong>优先级：</strong>用户自定义的Bean会覆盖自动配置的Bean</li>
                                    </ul>
                                </div>
                            </div>
                                                    
                            <div class="interview-answer-container">
                                <textarea class="interview-answer-input" placeholder="请输入您的答案..."></textarea>
                                <button class="interview-answer-ai-btn">
                                    <i class="fas fa-star"></i>
                                    AI评分
                                </button>
                            </div>
                            <div class="interview-notes">
                                <textarea class="interview-notes-input" placeholder="在此添加您的笔记..."></textarea>
                            </div>
                            <div class="interview-actions">
                                <button class="interview-btn ai-score">
                                    <i class="fas fa-star"></i>
                                    AI评分
                                </button>
                                <button class="interview-btn secondary">
                                    <i class="fas fa-forward"></i>
                                    下一题
                                </button>
                                <button class="interview-btn primary">
                                    <i class="fas fa-check"></i>
                                    我会了
                                </button>
                                <button class="interview-btn outline">
                                    <i class="fas fa-arrow-right"></i>
                                    记一下
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 知识点内容 -->
                <div class="content-section" id="knowledgeSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-lightbulb"></i>
                            知识点
                        </h2>
                    </div>
                    <div class="section-content">
                        <div class="knowledge-list">
                            <div class="knowledge-item">
                                <div class="knowledge-header" style="position: relative;">
                                    <div class="knowledge-title">Java基础语法和面向对象编程</div>
                                    <button class="ai-chat-btn" onclick="startAIKnowledgeChat('java-basics')" title="与AI助手讨论此知识点" style="
                                        position: absolute;
                                        top: 50%;
                                        right: 12px;
                                        transform: translateY(-50%);
                                        width: 36px;
                                        height: 36px;
                                        border: none;
                                        background: rgba(255, 255, 255, 0.9);
                                        color: #6366f1;
                                        border-radius: 50%;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        transition: all 0.3s ease;
                                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                                        backdrop-filter: blur(4px);
                                        z-index: 10;
                                    ">
                                        <i class="fas fa-robot" style="font-size: 16px;"></i>
                                    </button>
                                </div>
                                <div class="knowledge-content">
                                    <div class="knowledge-text">
                                        <strong>核心概念：</strong>Java是一种面向对象的编程语言，具有跨平台、安全、健壮等特点。<br><br>
                                        <strong>重要特性：</strong><br>
                                        • <strong>封装（Encapsulation）：</strong>将数据和操作数据的方法绑定在一起，隐藏内部实现细节<br>
                                        • <strong>继承（Inheritance）：</strong>子类可以继承父类的属性和方法，实现代码复用<br>
                                        • <strong>多态（Polymorphism）：</strong>同一个接口可以有多种不同的实现方式<br><br>
                                        <strong>实际应用：</strong>企业级应用开发、Android开发、大数据处理等领域
                                    </div>
                                    <div class="knowledge-simple-explanation">
                                        <div class="knowledge-simple-explanation-title">
                                            <i class="fas fa-lightbulb"></i>通俗讲解
                                        </div>
                                        <div class="knowledge-simple-explanation-content">
                                            想象Java就像一套万能工具箱，它可以在各种“工地”（平台）上使用。封装就像将工具和操作手册放在一起，不需要知道工具内部如何运作；继承就像新工具能够自动拥有旧工具的功能；多态就像一把瑞士军刀，可以根据需要变成不同的工具。Java应用广泛，从手机应用到大型银行系统都在使用它。
                                        </div>
                                    </div>
                                    <div class="knowledge-notes">
                                        <textarea class="knowledge-notes-input" placeholder="在此添加您的笔记..."></textarea>
                                    </div>
                                    <div class="knowledge-actions">
                                        <button class="knowledge-btn secondary">
                                            <i class="fas fa-forward"></i>
                                            下一个
                                        </button>
                                        <button class="knowledge-btn primary">
                                            <i class="fas fa-check"></i>
                                            我会了
                                        </button>
                                        <button class="knowledge-btn outline">
                                            <i class="fas fa-arrow-right"></i>
                                            记一下
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 书籍内容 -->
                <div class="content-section" id="booksSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-book"></i>
                            推荐书籍
                        </h2>
                    </div>
                    <div class="section-content">
                        <div class="books-grid">
                            <!-- 书籍卡片 -->
                            <div class="book-card">
                                <div class="book-cover">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="book-info">
                                    <h3 class="book-title">Java核心技术卷I</h3>
                                    <p class="book-author">作者：Cay S. Horstmann</p>
                                    <p class="book-description">Java领域经典之作，深入讲解Java核心技术和最佳实践。</p>
                                    <div class="book-rating">
                                        <div class="stars">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span class="rating-text">9.2/10</span>
                                    </div>
                                    <div class="book-actions">
                                        <button class="book-btn primary">
                                            <i class="fas fa-shopping-cart"></i>
                                            购买
                                        </button>
                                        <button class="book-btn secondary">
                                            <i class="fas fa-eye"></i>
                                            查看
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="book-card">
                                <div class="book-cover">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="book-info">
                                    <h3 class="book-title">深入理解Java虚拟机</h3>
                                    <p class="book-author">作者：周志明</p>
                                    <p class="book-description">深入分析JVM的工作原理和性能优化技巧。</p>
                                    <div class="book-rating">
                                        <div class="stars">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span class="rating-text">9.0/10</span>
                                    </div>
                                    <div class="book-actions">
                                        <button class="book-btn primary">
                                            <i class="fas fa-shopping-cart"></i>
                                            购买
                                        </button>
                                        <button class="book-btn secondary">
                                            <i class="fas fa-eye"></i>
                                            查看
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="book-card">
                                <div class="book-cover">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="book-info">
                                    <h3 class="book-title">Spring实战</h3>
                                    <p class="book-author">作者：Craig Walls</p>
                                    <p class="book-description">Spring框架全面指南，从基础到高级的实战教程。</p>
                                    <div class="book-rating">
                                        <div class="stars">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="far fa-star"></i>
                                        </div>
                                        <span class="rating-text">8.8/10</span>
                                    </div>
                                    <div class="book-actions">
                                        <button class="book-btn primary">
                                            <i class="fas fa-shopping-cart"></i>
                                            购买
                                        </button>
                                        <button class="book-btn secondary">
                                            <i class="fas fa-eye"></i>
                                            查看
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="book-card">
                                <div class="book-cover">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="book-info">
                                    <h3 class="book-title">MySQL必知必会</h3>
                                    <p class="book-author">作者：Ben Forta</p>
                                    <p class="book-description">MySQL数据库的经典入门教程，适合初学者。</p>
                                    <div class="book-rating">
                                        <div class="stars">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="far fa-star"></i>
                                        </div>
                                        <span class="rating-text">8.5/10</span>
                                    </div>
                                    <div class="book-actions">
                                        <button class="book-btn primary">
                                            <i class="fas fa-shopping-cart"></i>
                                            购买
                                        </button>
                                        <button class="book-btn secondary">
                                            <i class="fas fa-eye"></i>
                                            查看
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 证书内容 -->
                <div class="content-section" id="certificatesSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-certificate"></i>
                            证书
                        </h2>
                    </div>
                    <div class="section-content">
                        <div class="certificates-grid">
                            <!-- 证书卡片 -->
                            <div class="certificate-card">
                                <div class="certificate-icon">
                                    <i class="fas fa-award"></i>
                                </div>
                                <div class="certificate-info">
                                    <h3 class="certificate-title">Oracle Certified Professional Java SE</h3>
                                    <p class="certificate-issuer">颁发机构：Oracle</p>
                                    <p class="certificate-description">Java SE开发者专业认证，证明具备Java核心技能。</p>
                                    <div class="certificate-meta">
                                        <span class="difficulty-badge advanced">高级</span>
                                        <span class="validity">有效期：3年</span>
                                    </div>
                                    <div class="certificate-actions">
                                        <button class="cert-btn primary">
                                            <i class="fas fa-external-link-alt"></i>
                                            查看详情
                                        </button>
                                        <button class="cert-btn secondary">
                                            <i class="fas fa-bookmark"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="certificate-card">
                                <div class="certificate-icon">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <div class="certificate-info">
                                    <h3 class="certificate-title">AWS Certified Solutions Architect</h3>
                                    <p class="certificate-issuer">颁发机构：Amazon Web Services</p>
                                    <p class="certificate-description">云架构师专业认证，证明具备AWS云服务设计能力。</p>
                                    <div class="certificate-meta">
                                        <span class="difficulty-badge intermediate">中级</span>
                                        <span class="validity">有效期：3年</span>
                                    </div>
                                    <div class="certificate-actions">
                                        <button class="cert-btn primary">
                                            <i class="fas fa-external-link-alt"></i>
                                            查看详情
                                        </button>
                                        <button class="cert-btn secondary">
                                            <i class="fas fa-bookmark"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="certificate-card">
                                <div class="certificate-icon">
                                    <i class="fas fa-medal"></i>
                                </div>
                                <div class="certificate-info">
                                    <h3 class="certificate-title">Spring Professional Certification</h3>
                                    <p class="certificate-issuer">颁发机构：Pivotal (VMware)</p>
                                    <p class="certificate-description">Spring框架专业认证，证明掌握Spring核心技术。</p>
                                    <div class="certificate-meta">
                                        <span class="difficulty-badge intermediate">中级</span>
                                        <span class="validity">有效期：2年</span>
                                    </div>
                                    <div class="certificate-actions">
                                        <button class="cert-btn primary">
                                            <i class="fas fa-external-link-alt"></i>
                                            查看详情
                                        </button>
                                        <button class="cert-btn secondary">
                                            <i class="fas fa-bookmark"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="certificate-card">
                                <div class="certificate-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="certificate-info">
                                    <h3 class="certificate-title">MongoDB Certified Developer</h3>
                                    <p class="certificate-issuer">颁发机构：MongoDB Inc.</p>
                                    <p class="certificate-description">MongoDB数据库开发者认证，证明具备NoSQL数据库技能。</p>
                                    <div class="certificate-meta">
                                        <span class="difficulty-badge beginner">初级</span>
                                        <span class="validity">有效期：2年</span>
                                    </div>
                                    <div class="certificate-actions">
                                        <button class="cert-btn primary">
                                            <i class="fas fa-external-link-alt"></i>
                                            查看详情
                                        </button>
                                        <button class="cert-btn secondary">
                                            <i class="fas fa-bookmark"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 课程内容 -->
                <div class="content-section" id="coursesSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-graduation-cap"></i>
                            推荐课程
                        </h2>
                    </div>
                    <div class="section-content">
                        <div class="courses-grid">
                            <!-- 课程卡片 -->
                            <div class="course-card">
                                <div class="course-thumbnail">
                                    <i class="fas fa-play-circle"></i>
                                    <span class="course-duration">24小时</span>
                                </div>
                                <div class="course-info">
                                    <h3 class="course-title">Java全栈开发实战课程</h3>
                                    <p class="course-instructor">讲师：张三 | 高级Java架构师</p>
                                    <p class="course-description">从零基础到项目实战，全面掌握Java全栈开发技能。</p>
                                    <div class="course-meta">
                                        <div class="course-rating">
                                            <div class="stars">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <span class="rating-text">4.9 (2,345人)</span>
                                        </div>
                                        <div class="course-level">
                                            <span class="level-badge intermediate">中级</span>
                                        </div>
                                    </div>
                                    <div class="course-price">
                                        <span class="current-price">￥299</span>
                                        <span class="original-price">￥599</span>
                                        <span class="discount">5折</span>
                                    </div>
                                    <div class="course-actions">
                                        <button class="course-btn primary">
                                            <i class="fas fa-play"></i>
                                            立即学习
                                        </button>
                                        <button class="course-btn secondary">
                                            <i class="fas fa-heart"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="course-card">
                                <div class="course-thumbnail">
                                    <i class="fas fa-play-circle"></i>
                                    <span class="course-duration">18小时</span>
                                </div>
                                <div class="course-info">
                                    <h3 class="course-title">Spring Boot微服务架构实战</h3>
                                    <p class="course-instructor">讲师：李四 | Spring核心开发者</p>
                                    <p class="course-description">深入学习Spring Boot，构建企业级微服务架构。</p>
                                    <div class="course-meta">
                                        <div class="course-rating">
                                            <div class="stars">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>
                                            </div>
                                            <span class="rating-text">4.7 (1,678人)</span>
                                        </div>
                                        <div class="course-level">
                                            <span class="level-badge advanced">高级</span>
                                        </div>
                                    </div>
                                    <div class="course-price">
                                        <span class="current-price">￥399</span>
                                        <span class="original-price">￥699</span>
                                        <span class="discount">5.7折</span>
                                    </div>
                                    <div class="course-actions">
                                        <button class="course-btn primary">
                                            <i class="fas fa-play"></i>
                                            立即学习
                                        </button>
                                        <button class="course-btn secondary">
                                            <i class="fas fa-heart"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="course-card">
                                <div class="course-thumbnail">
                                    <i class="fas fa-play-circle"></i>
                                    <span class="course-duration">32小时</span>
                                </div>
                                <div class="course-info">
                                    <h3 class="course-title">MySQL数据库优化与调优</h3>
                                    <p class="course-instructor">讲师：王五 | 数据库专家</p>
                                    <p class="course-description">系统学习MySQL性能优化，提升数据库应用性能。</p>
                                    <div class="course-meta">
                                        <div class="course-rating">
                                            <div class="stars">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <span class="rating-text">4.8 (3,124人)</span>
                                        </div>
                                        <div class="course-level">
                                            <span class="level-badge intermediate">中级</span>
                                        </div>
                                    </div>
                                    <div class="course-price">
                                        <span class="current-price">￥199</span>
                                        <span class="original-price">￥399</span>
                                        <span class="discount">5折</span>
                                    </div>
                                    <div class="course-actions">
                                        <button class="course-btn primary">
                                            <i class="fas fa-play"></i>
                                            立即学习
                                        </button>
                                        <button class="course-btn secondary">
                                            <i class="fas fa-heart"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="course-card">
                                <div class="course-thumbnail">
                                    <i class="fas fa-play-circle"></i>
                                    <span class="course-duration">20小时</span>
                                </div>
                                <div class="course-info">
                                    <h3 class="course-title">Redis缓存与分布式实战</h3>
                                    <p class="course-instructor">讲师：赵六 | Redis核心贡献者</p>
                                    <p class="course-description">深入Redis内核，掌握高性能缓存在分布式系统中的应用。</p>
                                    <div class="course-meta">
                                        <div class="course-rating">
                                            <div class="stars">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>
                                            </div>
                                            <span class="rating-text">4.6 (892人)</span>
                                        </div>
                                        <div class="course-level">
                                            <span class="level-badge advanced">高级</span>
                                        </div>
                                    </div>
                                    <div class="course-price">
                                        <span class="current-price">￥259</span>
                                        <span class="original-price">￥499</span>
                                        <span class="discount">5.2折</span>
                                    </div>
                                    <div class="course-actions">
                                        <button class="course-btn primary">
                                            <i class="fas fa-play"></i>
                                            立即学习
                                        </button>
                                        <button class="course-btn secondary">
                                            <i class="fas fa-heart"></i>
                                            收藏
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 我的笔记内容 -->
                <div class="content-section" id="notesSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-sticky-note"></i>
                            我的笔记
                            <span class="section-count" id="notesSectionCount">(0)</span>
                        </h2>
                        <div>
                            <button class="expand-all-btn" id="addNoteBtn">
                                <i class="fas fa-plus"></i>
                                新增笔记
                            </button>
                            <button class="expand-all-btn" id="exportNotesBtn">
                                <i class="fas fa-download"></i>
                                导出笔记
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="notes-container" id="notesContainer">
                            <!-- 笔记内容将动态生成 -->
                            <div class="empty-notes-state">
                                <div class="empty-icon">
                                    <i class="fas fa-sticky-note"></i>
                                </div>
                                <h3>还没有笔记</h3>
                                <p>您可以在学习过程中记录重要的知识点和心得体会</p>
                                <button class="add-first-note-btn" onclick="showAddNoteModal()">
                                    <i class="fas fa-plus"></i>
                                    创建第一个笔记
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- 右侧AI助手 -->
            <aside class="ai-assistant minimized">
                <!-- 左侧拖拽边框 -->
                <div class="ai-assistant-resize-handle" id="aiResizeHandle"></div>
                
                <div class="assistant-header">
                    <h3 class="assistant-title">
                        <i class="fas fa-robot"></i>
                        AI 智能助手
                    </h3>
                    <div class="assistant-actions">
                        <button class="assistant-btn" id="clearChatBtn" title="清空聊天">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="assistant-btn" id="downloadChatBtn" title="下载聊天记录">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="assistant-btn" id="minimizeAssistantBtn" title="扩大面板">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                
                <div class="assistant-content">
                    <div class="chat-messages" id="chatMessages">
                        <!-- 聊天消息将动态生成 -->
                        <div class="welcome-message">
                            <div class="assistant-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3 class="welcome-title">您好！我是AI学习助手</h3>
                            <p class="welcome-text">我可以回答您关于职业发展、技能提升的问题。请在下方输入您的问题！</p>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="chatInput" placeholder="请输入您的问题..."></textarea>
                        <button class="send-btn" id="sendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 页面脚本 -->
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            // 强制修复布局问题
            console.log('\ud83d\udee0 正在修复布局问题...');
            
            // 确保内容区域在正确的位置
            const contentMain = document.querySelector('.content-main');
            const contentSections = document.querySelectorAll('.content-section');
            
            if (contentMain && contentSections) {
                // 确保所有内容区域都有正确的父元素
                contentSections.forEach(section => {
                    // 仅当父元素不是内容区域时才移动
                    if (section.parentElement !== contentMain) {
                        console.log(`\ud83d\udd04 移动内容区域到正确位置: ${section.id}`);
                        contentMain.appendChild(section);
                    }
                });
                
                console.log('\u2705 布局问题修复完成');
            }
            
            const jobTitleDisplay = document.getElementById('jobTitleDisplay');
            const sidebarJobTitle = document.getElementById('sidebarJobTitle');
            const generationTimeDisplay = document.getElementById('generationTimeDisplay');
            const navItems = document.querySelectorAll('.nav-item');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            
            // 初始化内容区域
            console.log('🔔 初始化页面内容');
            const urlSection = new URLSearchParams(window.location.search).get('section');
            let activeSection = urlSection || 'mindmap';
            
            // 激活导航项
            navItems.forEach(nav => {
                nav.classList.remove('active');
                if (nav.getAttribute('data-target') === activeSection) {
                    nav.classList.add('active');
                }
            });
            
            // 激活内容区域
            contentSections.forEach(section => {
                section.classList.remove('active');
                if (section.id === `${activeSection}Section`) {
                    section.classList.add('active');
                    console.log('✅ 激活区域:', section.id);
                }
            });
            
            // 初始化AI助手状态
            initializeAIAssistantState(activeSection);
            
            // 初始化变量
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // 更新配置API按钮状态
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> 已配置API';
                configApiBtn.style.color = '#10b981';
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // 绑定模态框事件
            setTimeout(function() {
                // 绑定关闭按钮事件
                const apiConfigClose = document.getElementById('apiConfigClose');
                const apiConfigCancel = document.getElementById('apiConfigCancel');
                const apiConfigModal = document.getElementById('apiConfigModal');
                const modalOverlay = apiConfigModal ? apiConfigModal.querySelector('.modal-overlay') : null;
                
                if (apiConfigClose) {
                    apiConfigClose.addEventListener('click', closeApiConfigModal);
                }
                
                if (apiConfigCancel) {
                    apiConfigCancel.addEventListener('click', closeApiConfigModal);
                }
                
                if (modalOverlay) {
                    modalOverlay.addEventListener('click', closeApiConfigModal);
                }
                
                // 切换API Key显示/隐藏
                const toggleApiKey = document.getElementById('toggleApiKey');
                const apiKeyInput = document.getElementById('apiKey');
                
                if (toggleApiKey && apiKeyInput) {
                    toggleApiKey.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('👁️ 切换密钥显示/隐藏');
                        
                        if (apiKeyInput.type === 'password') {
                            apiKeyInput.type = 'text';
                            toggleApiKey.innerHTML = '<i class="fas fa-eye-slash"></i>';
                            console.log('✅ 密钥已显示');
                        } else {
                            apiKeyInput.type = 'password';
                            toggleApiKey.innerHTML = '<i class="fas fa-eye"></i>';
                            console.log('✅ 密钥已隐藏');
                        }
                    });
                }
                
                // 处理厂商切换
                const apiProviderSelect = document.getElementById('apiProvider');
                if (apiProviderSelect) {
                    // 初始化显示当前选中的厂商信息
                    updateProviderInfo(apiProviderSelect.value);
                    
                    apiProviderSelect.addEventListener('change', function() {
                        console.log('🔄 厂商切换为:', this.value);
                        updateProviderInfo(this.value);
                    });
                }
                
                // 更新厂商信息显示
                function updateProviderInfo(provider) {
                    const providerInfo = document.querySelector('.provider-info');
                    if (!providerInfo) return;
                    
                    const logo = providerInfo.querySelector('.provider-logo i');
                    const title = providerInfo.querySelector('.provider-details h4');
                    const description = providerInfo.querySelector('.provider-details p');
                    const link = providerInfo.querySelector('.provider-link');
                    
                    switch(provider) {
                        case 'alibaba':
                            if (logo) {
                                logo.className = 'fas fa-cloud';
                                logo.style.color = '#ff6a00';
                            }
                            if (title) title.textContent = '阿里云 DashScope';
                            if (description) description.textContent = '使用通义大模型系列，包括模型通义千问2.0等';
                            if (link) {
                                link.href = 'https://dashscope.aliyun.com/';
                                link.textContent = '获取密钥';
                            }
                            break;
                        case 'openai':
                            if (logo) {
                                logo.className = 'fas fa-brain';
                                logo.style.color = '#10a37f';
                            }
                            if (title) title.textContent = 'OpenAI';
                            if (description) description.textContent = '使用GPT-4、GPT-3.5等先进的语言模型';
                            if (link) {
                                link.href = 'https://platform.openai.com/api-keys';
                                link.textContent = '获取密钥';
                            }
                            break;
                        case 'anthropic':
                            if (logo) {
                                logo.className = 'fas fa-robot';
                                logo.style.color = '#d97700';
                            }
                            if (title) title.textContent = 'Anthropic Claude';
                            if (description) description.textContent = '使用Claude 3.5 Sonnet等先进的AI模型';
                            if (link) {
                                link.href = 'https://console.anthropic.com/';
                                link.textContent = '获取密钥';
                            }
                            break;
                    }
                }
                
                // 保存API配置
                const apiConfigConfirm = document.getElementById('apiConfigConfirm');
                // 复用之前声明的 apiProviderSelect
                
                if (apiConfigConfirm) {
                    apiConfigConfirm.addEventListener('click', function() {
                        const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                        const apiProvider = apiProviderSelect ? apiProviderSelect.value : 'alibaba';
                        
                        if (!apiKey) {
                            alert('请输入API密钥');
                            return;
                        }
                        
                        // 保存到localStorage
                        localStorage.setItem('ai_learning_companion_api_key', apiKey);
                        localStorage.setItem('apiProvider', apiProvider);
                        
                        // 更新按钮状态
                        const configApiBtn = document.getElementById('configApiBtn');
                        if (configApiBtn) {
                            configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> 已配置API';
                            configApiBtn.style.color = '#10b981';
                            configApiBtn.style.borderColor = '#10b981';
                        }
                        
                        // 关闭模态框
                        closeApiConfigModal();
                        
                        alert('API配置已保存');
                    });
                }
            }, 100);
            
            // 获取URL参数
            const urlParams = new URLSearchParams(window.location.search);
            const jobTitle = urlParams.get('job') || localStorage.getItem('currentJob') || '后端工程师';
            
            // 更新页面标题
            document.title = `${jobTitle} 学习资料 - 职途助手AI求职大师`;
            
            // 更新职位标题
            if (jobTitleDisplay) jobTitleDisplay.textContent = jobTitle;
            if (sidebarJobTitle) sidebarJobTitle.textContent = jobTitle;
            
            // 更新生成时间
            if (generationTimeDisplay) {
                const now = new Date();
                generationTimeDisplay.textContent = `${now.getFullYear()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            }
            
            // 处理导航项点击
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault(); // 阻止默认行为
                    e.stopPropagation(); // 阻止事件冒泡
                    
                    const targetId = this.getAttribute('data-target');
                    console.log('📊 点击导航项:', targetId);
                    
                    if (!targetId) {
                        console.error('⚠️ 导航项缺少data-target属性');
                        return;
                    }
                    
                    // 更新导航项状态
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新内容区域显示
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        const expectedId = `${targetId}Section`;
                        console.log('🔍 检查区域:', section.id, '期望:', expectedId);
                        if (section.id === expectedId) {
                            section.classList.add('active');
                            console.log('✅ 激活区域:', section.id);
                        }
                    });
                    
                    // 智能控制AI助手状态
                    controlAIAssistantForSection(targetId);
                });
            });
            
            // 处理导出PDF按钮
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', function() {
                    alert('导出PDF功能将在完整版中提供');
                });
            }
            
            // 处理导出飞书按钮
            const exportFeishuBtn = document.getElementById('exportFeishuBtn');
            if (exportFeishuBtn) {
                exportFeishuBtn.addEventListener('click', function() {
                    alert('导出飞书文档功能将在完整版中提供');
                });
            }
            
            // 处理保存按钮
            const saveBtn = document.getElementById('saveBtn');
            if (saveBtn) {
                saveBtn.addEventListener('click', function() {
                    alert('已保存到本地存储');
                });
            }
            
            // 笔记功能相关代码
            initializeNotesFeature();
            
            // 初始化目录折叠功能
            initializeSidebarToggle();
            
            // 初始化AI助手拖拽调整大小功能
            initializeAIAssistantResize();
            
            // 初始化笔记功能
            function initializeNotesFeature() {
                console.log('📝 初始化笔记功能...');
                
                // 加载笔记数据
                loadNotes();
                
                // 绑定新增笔记按钮事件
                const addNoteBtn = document.getElementById('addNoteBtn');
                if (addNoteBtn) {
                    addNoteBtn.addEventListener('click', showAddNoteModal);
                }
                
                // 绑定导出笔记按钮事件
                const exportNotesBtn = document.getElementById('exportNotesBtn');
                if (exportNotesBtn) {
                    exportNotesBtn.addEventListener('click', exportNotes);
                }
            }
            
            // 加载笔记数据
            function loadNotes() {
                const notes = getNotesFromStorage();
                const notesContainer = document.getElementById('notesContainer');
                const notesCount = document.getElementById('notesCount');
                const notesSectionCount = document.getElementById('notesSectionCount');
                
                if (!notesContainer) return;
                
                // 更新计数
                if (notesCount) notesCount.textContent = `(${notes.length})`;
                if (notesSectionCount) notesSectionCount.textContent = `(${notes.length})`;
                
                if (notes.length === 0) {
                    // 显示空状态
                    notesContainer.innerHTML = `
                        <div class="empty-notes-state">
                            <div class="empty-icon">
                                <i class="fas fa-sticky-note"></i>
                            </div>
                            <h3>还没有笔记</h3>
                            <p>您可以在学习过程中记录重要的知识点和心得体会</p>
                            <button class="add-first-note-btn" onclick="showAddNoteModal()">
                                <i class="fas fa-plus"></i>
                                创建第一个笔记
                            </button>
                        </div>
                    `;
                } else {
                    // 显示笔记列表
                    const notesHtml = notes.map(note => createNoteCardHtml(note)).join('');
                    notesContainer.innerHTML = notesHtml;
                }
            }
            
            // 从本地存储获取笔记
            function getNotesFromStorage() {
                try {
                    const notes = localStorage.getItem('learning_notes');
                    return notes ? JSON.parse(notes) : [];
                } catch (error) {
                    console.error('加载笔记数据失败:', error);
                    return [];
                }
            }
            
            // 保存笔记到本地存储
            function saveNotesToStorage(notes) {
                try {
                    localStorage.setItem('learning_notes', JSON.stringify(notes));
                    return true;
                } catch (error) {
                    console.error('保存笔记数据失败:', error);
                    return false;
                }
            }
            
            // 创建笔记卡片HTML
            function createNoteCardHtml(note) {
                const formattedDate = new Date(note.createdAt).toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const tagsHtml = note.tags && note.tags.length > 0 
                    ? `<div class="note-tags">${note.tags.map(tag => `<span class="note-tag">${tag}</span>`).join('')}</div>`
                    : '';
                
                return `
                    <div class="note-card" data-note-id="${note.id}">
                        <div class="note-header">
                            <h3 class="note-title">${note.title}</h3>
                            <div class="note-actions">
                                <button class="note-action-btn" onclick="editNote('${note.id}')" title="编辑">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="note-action-btn" onclick="deleteNote('${note.id}')" title="删除">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="note-meta">
                            <div class="note-date">
                                <i class="fas fa-calendar"></i>
                                ${formattedDate}
                            </div>
                            ${note.category ? `<div class="note-category"><i class="fas fa-tag"></i>${note.category}</div>` : ''}
                        </div>
                        <div class="note-content">${note.content}</div>
                        ${tagsHtml}
                    </div>
                `;
            }
            
            // 显示新增笔记模态框
            function showAddNoteModal() {
                const title = prompt('请输入笔记标题:');
                if (!title || !title.trim()) return;
                
                const content = prompt('请输入笔记内容:');
                if (!content || !content.trim()) return;
                
                const category = prompt('请输入分类(可选):') || '其他';
                
                const note = {
                    id: generateNoteId(),
                    title: title.trim(),
                    content: content.trim(),
                    category: category.trim(),
                    tags: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                addNote(note);
            }
            
            // 生成笔记ID
            function generateNoteId() {
                return 'note_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // 添加笔记
            function addNote(note) {
                const notes = getNotesFromStorage();
                notes.unshift(note); // 添加到列表首位
                
                if (saveNotesToStorage(notes)) {
                    loadNotes(); // 重新加载显示
                    console.log('✅ 笔记添加成功');
                } else {
                    alert('保存笔记失败，请重试');
                }
            }
            
            // 编辑笔记
            function editNote(noteId) {
                const notes = getNotesFromStorage();
                const note = notes.find(n => n.id === noteId);
                
                if (!note) {
                    alert('找不到指定的笔记');
                    return;
                }
                
                const newTitle = prompt('请修改标题:', note.title);
                if (newTitle === null) return; // 用户取消
                
                const newContent = prompt('请修改内容:', note.content);
                if (newContent === null) return; // 用户取消
                
                const newCategory = prompt('请修改分类:', note.category);
                if (newCategory === null) return; // 用户取消
                
                // 更新笔记
                note.title = newTitle.trim() || note.title;
                note.content = newContent.trim() || note.content;
                note.category = newCategory.trim() || note.category;
                note.updatedAt = new Date().toISOString();
                
                if (saveNotesToStorage(notes)) {
                    loadNotes(); // 重新加载显示
                    console.log('✅ 笔记更新成功');
                } else {
                    alert('保存笔记失败，请重试');
                }
            }
            
            // 删除笔记
            function deleteNote(noteId) {
                if (!confirm('确定要删除这个笔记吗？')) return;
                
                const notes = getNotesFromStorage();
                const filteredNotes = notes.filter(n => n.id !== noteId);
                
                if (saveNotesToStorage(filteredNotes)) {
                    loadNotes(); // 重新加载显示
                    console.log('✅ 笔记删除成功');
                } else {
                    alert('删除笔记失败，请重试');
                }
            }
            
            // 导出笔记
            function exportNotes() {
                const notes = getNotesFromStorage();
                
                if (notes.length === 0) {
                    alert('没有笔记可导出');
                    return;
                }
                
                const exportData = {
                    exportTime: new Date().toISOString(),
                    notes: notes
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `学习笔记_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                console.log('✅ 笔记导出成功');
            }
            
            // 将函数暴露到全局作用域，以便在HTML中调用
            window.showAddNoteModal = showAddNoteModal;
            window.editNote = editNote;
            window.deleteNote = deleteNote;
            window.exportNotes = exportNotes;
            
            // 初始化目录折叠功能
            function initializeSidebarToggle() {
                console.log('📜 初始化目录折叠功能...');
                
                const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
                const contentSidebar = document.querySelector('.content-sidebar');
                
                if (!sidebarToggleBtn || !contentSidebar) {
                    console.warn('⚠️ 未找到目录折叠相关元素');
                    return;
                }
                
                // 绑定折叠按钮事件
                sidebarToggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isCollapsed = contentSidebar.classList.contains('collapsed');
                    
                    if (isCollapsed) {
                        // 展开目录
                        contentSidebar.classList.remove('collapsed');
                        sidebarToggleBtn.title = '折叠目录';
                        console.log('✅ 目录已展开');
                    } else {
                        // 折叠目录
                        contentSidebar.classList.add('collapsed');
                        sidebarToggleBtn.title = '展开目录';
                        console.log('✅ 目录已折叠');
                    }
                });
                
                // 键盘快捷键支持（Ctrl+B）
                document.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'b') {
                        e.preventDefault();
                        sidebarToggleBtn.click();
                    }
                });
                
                console.log('✅ 目录折叠功能初始化完成');
            }
            
            // 初始化AI助手拖拽调整大小功能
            function initializeAIAssistantResize() {
                console.log('🎯 初始化AI助手拖拽调整大小功能...');
                
                const aiAssistant = document.querySelector('.ai-assistant');
                const resizeHandle = document.getElementById('aiResizeHandle');
                
                if (!aiAssistant || !resizeHandle) {
                    console.warn('⚠️ 未找到AI助手或拖拽控件元素');
                    return;
                }
                
                let isResizing = false;
                let startX = 0;
                let startWidth = 0;
                
                // 获取AI助手当前宽度
                function getCurrentWidth() {
                    return parseInt(window.getComputedStyle(aiAssistant).width, 10);
                }
                
                // 开始拖拽
                function startResize(e) {
                    // 检查AI助手是否处于缩小状态
                    if (aiAssistant.classList.contains('minimized')) {
                        return; // 缩小状态下不允许拖拽
                    }
                    
                    isResizing = true;
                    startX = e.clientX;
                    startWidth = getCurrentWidth();
                    
                    // 添加拖拽状态样式
                    document.body.style.cursor = 'col-resize';
                    document.body.style.userSelect = 'none';
                    aiAssistant.classList.add('resizing');
                    resizeHandle.classList.add('resizing');
                    
                    console.log('🎯 开始拖拽调整AI助手大小', { startX, startWidth });
                    
                    // 阻止默认行为
                    e.preventDefault();
                }
                
                // 拖拽中
                function doResize(e) {
                    if (!isResizing) return;
                    
                    const deltaX = startX - e.clientX; // 向左拖拽为正值
                    const newWidth = startWidth + deltaX;
                    
                    // 限制最小和最大宽度
                    const minWidth = 300;
                    const maxWidth = 600;
                    const constrainedWidth = Math.min(Math.max(newWidth, minWidth), maxWidth);
                    
                    // 应用新宽度
                    aiAssistant.style.width = constrainedWidth + 'px';
                    
                    console.log('🎯 拖拽中:', { deltaX, newWidth, constrainedWidth });
                    
                    e.preventDefault();
                }
                
                // 结束拖拽
                function stopResize() {
                    if (!isResizing) return;
                    
                    isResizing = false;
                    
                    // 移除拖拽状态样式
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    aiAssistant.classList.remove('resizing');
                    resizeHandle.classList.remove('resizing');
                    
                    // 保存当前宽度到本地存储
                    const currentWidth = getCurrentWidth();
                    localStorage.setItem('ai_assistant_width', currentWidth.toString());
                    
                    console.log('✅ 拖拽结束，AI助手宽度已调整为:', currentWidth + 'px');
                }
                
                // 从本地存储恢复宽度
                function restoreWidth() {
                    const savedWidth = localStorage.getItem('ai_assistant_width');
                    if (savedWidth) {
                        const width = parseInt(savedWidth, 10);
                        if (width >= 300 && width <= 600) {
                            aiAssistant.style.width = width + 'px';
                            console.log('✅ 已恢复AI助手宽度:', width + 'px');
                        }
                    }
                }
                
                // 绑定事件监听器（鼠标事件）
                resizeHandle.addEventListener('mousedown', startResize);
                document.addEventListener('mousemove', doResize);
                document.addEventListener('mouseup', stopResize);
                
                // 绑定触摸事件（移动设备支持）
                resizeHandle.addEventListener('touchstart', function(e) {
                    if (e.touches.length === 1) {
                        const touch = e.touches[0];
                        const mouseEvent = new MouseEvent('mousedown', {
                            clientX: touch.clientX,
                            clientY: touch.clientY
                        });
                        startResize(mouseEvent);
                    }
                    e.preventDefault();
                });
                
                document.addEventListener('touchmove', function(e) {
                    if (e.touches.length === 1 && isResizing) {
                        const touch = e.touches[0];
                        const mouseEvent = new MouseEvent('mousemove', {
                            clientX: touch.clientX,
                            clientY: touch.clientY
                        });
                        doResize(mouseEvent);
                    }
                    e.preventDefault();
                });
                
                document.addEventListener('touchend', function(e) {
                    if (isResizing) {
                        stopResize();
                    }
                });
                
                // 恢复保存的宽度
                restoreWidth();
                
                console.log('✅ AI助手拖拽调整大小功能初始化完成');
            }
            
            // 处理思维导图切换
            const mindmapToggleBtn = document.getElementById('mindmapToggleBtn');
            if (mindmapToggleBtn) {
                mindmapToggleBtn.addEventListener('click', function(e) {
                    e.preventDefault(); // 阻止默认行为
                    e.stopPropagation(); // 阻止事件冒泡
                    
                    console.log('📊 点击思维导图切换按钮');
                    
                    navItems.forEach(nav => nav.classList.remove('active'));
                    document.querySelector('.nav-item[data-target="mindmap"]').classList.add('active');
                    
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === 'mindmapSection') {
                            section.classList.add('active');
                            console.log('✅ 激活思维导图区域');
                        }
                    });
                    
                    // 智能控制AI助手状态
                    controlAIAssistantForSection('mindmap');
                });
            }
            
            // 处理面试题展开
            const expandAllInterviewBtn = document.getElementById('expandAllInterview');
            if (expandAllInterviewBtn) {
                expandAllInterviewBtn.addEventListener('click', function() {
                    alert('展开所有面试题功能将在完整版中提供');
                });
            }
            
            // 自动滚动到底部的函数
            function scrollChatToBottom() {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    // 使用requestAnimationFrame确保在DOM更新后执行
                    requestAnimationFrame(() => {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    });
                }
            }
            
            // 添加用户消息
            function addUserMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;
                
                // 移除欢迎消息
                const welcomeMessage = chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message';
                messageElement.innerHTML = `
                    <div class="message-content">${message}</div>
                `;
                
                chatMessages.appendChild(messageElement);
                scrollChatToBottom(); // 使用新的滚动函数
            }
            
            // 添加助手消息
            function addAssistantMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message assistant-message';
                // 使用Markdown渲染助手消息
                const renderedContent = renderMarkdown(message);
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        ${renderedContent}
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
                scrollChatToBottom(); // 使用新的滚动函数
            }
            
            // 添加流式助手消息容器
            function addAssistantMessageStreaming() {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return null;
                
                // 移除欢迎消息
                const welcomeMessage = chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message assistant-message';
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content streaming">
                        <p>🤔 正在思考中...</p>
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
                scrollChatToBottom(); // 使用新的滚动函数
                
                return messageElement.querySelector('.message-content');
            }
            
            // Markdown到HTML转换函数
            function renderMarkdown(text) {
                if (!text) return '';
                
                // 基本的Markdown转换
                let html = text
                    // 水平分隔线
                    .replace(/^---+$/gm, '<hr>')
                    .replace(/^\*\*\*+$/gm, '<hr>')
                    // 标题转换
                    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                    // 粗体和斜体
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    // 行内代码
                    .replace(/`(.*?)`/g, '<code>$1</code>')
                    // 代码块
                    .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                    // 链接
                    .replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                    // 有序列表
                    .replace(/^\s*(\d+)\. (.*)$/gm, '<li data-type="ordered">$2</li>')
                    // 无序列表
                    .replace(/^\s*[-\*] (.*)$/gm, '<li data-type="unordered">$1</li>')
                    // 换行处理
                    .replace(/\n/g, '<br>');
                
                // 处理表格（简单的竖线分隔）
                html = html.replace(/\|(.+?)\|/g, (match, content) => {
                    const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
                    if (cells.length > 1) {
                        const cellsHtml = cells.map(cell => `<td>${cell}</td>`).join('');
                        return `<tr>${cellsHtml}</tr>`;
                    }
                    return match;
                });
                
                // 包装表格行
                html = html.replace(/(<tr>.*?<\/tr>)+/gs, '<table>$&</table>');
                
                // 处理列表项
                // 有序列表
                const orderedItems = html.match(/<li data-type="ordered">.*?<\/li>/g);
                if (orderedItems) {
                    const orderedList = orderedItems.join('').replace(/data-type="ordered"/g, '');
                    html = html.replace(/<li data-type="ordered">.*?<\/li>/g, '').replace(/(<br>)*$/, '') + '<ol>' + orderedList + '</ol>';
                }
                
                // 无序列表
                const unorderedItems = html.match(/<li data-type="unordered">.*?<\/li>/g);
                if (unorderedItems) {
                    const unorderedList = unorderedItems.join('').replace(/data-type="unordered"/g, '');
                    html = html.replace(/<li data-type="unordered">.*?<\/li>/g, '').replace(/(<br>)*$/, '') + '<ul>' + unorderedList + '</ul>';
                }
                
                // 清理多余的<br>标签
                html = html.replace(/<br>\s*<\/(h[1-6]|ul|ol|li|table|tr|td|hr|pre)>/g, '</$1>');
                html = html.replace(/<(h[1-6]|ul|ol|table|hr|pre)>\s*<br>/g, '<$1>');
                html = html.replace(/<br>\s*<br>/g, '<br>');
                
                return html;
            }

            // 更新流式消息内容 - 最简单版本
            function updateStreamingMessage(contentElement, content) {
                if (contentElement && content) {
                    // 直接替换内容，不做任何复杂处理
                    contentElement.innerHTML = content.replace(/\n/g, '<br>');
                    scrollChatToBottom();
                }
            }
            
            // 获取存储的API密钥
            function getStoredApiKey() {
                return localStorage.getItem('ai_learning_companion_api_key') || '';
            }
            
            // 调用流式DashScope API
            async function callDashScopeAPIStream(message, onContent) {
                console.log('🚀 调用流式百炼 API...');
                
                // 获取API密钥
                const apiKey = getStoredApiKey();
                if (!apiKey) {
                    throw new Error('请先配置API密钥');
                }
                
                // 构建对话历史（简化版，实际应用中可以从localStorage获取历史记录）
                const messages = [
                    {
                        role: 'system',
                        content: '你是一个专业的职业发展顾问，擅长提供技能学习、职业规划、面试指导等建议。请用中文回答，语言友好、专业。'
                    },
                    {
                        role: 'user',
                        content: message
                    }
                ];
                
                // 使用流式聊天接口
                return new Promise((resolve, reject) => {
                    // 发送POST请求数据
                    fetch('/api/chat-stream-init', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            messages: messages,
                            apiKey: apiKey
                        })
                    }).then(response => {
                        if (!response.ok) {
                            throw new Error(`初始化流式API失败: ${response.status}`);
                        }
                        return response.json();
                    }).then(data => {
                        const sessionId = data.sessionId;
                        
                        // 使用EventSource处理SSE
                        const eventSource = new EventSource(`/api/chat-stream/${sessionId}`);
                        
                        console.log('🌊 建立SSE连接:', sessionId);
                        
                        let hasReceivedFirstMessage = false;
                        let connectionStartTime = Date.now();
                        let streamContent = '';
                        
                        // 设置连接超时检查
                        const connectionTimeout = setTimeout(() => {
                            if (!hasReceivedFirstMessage) {
                                onContent('⏳ AI正在思考中，请稍等...');
                            }
                        }, 2000); // 2秒后显示思考中
                        
                        eventSource.onopen = () => {
                            console.log('✅ EventSource连接已建立');
                        };
                        
                        eventSource.addEventListener('message', (event) => {
                            try {
                                console.log('📨 收到message事件:', event.data);
                                const data = JSON.parse(event.data);
                                
                                if (data.content) {
                                    if (!hasReceivedFirstMessage) {
                                        hasReceivedFirstMessage = true;
                                        clearTimeout(connectionTimeout);
                                        streamContent = '';
                                        console.log('🎆 开始接收流式内容');
                                    }
                                    
                                    console.log('💬 流式消息:', data.content);
                                    streamContent += data.content;
                                    onContent(streamContent);
                                }
                            } catch (parseError) {
                                console.warn('⚠️ 解析message事件失败:', parseError.message);
                            }
                        });
                        
                        eventSource.addEventListener('done', (event) => {
                            console.log('✅ 流式对话完成:', event.data);
                            clearTimeout(connectionTimeout);
                            eventSource.close();
                            resolve();
                        });
                        
                        eventSource.addEventListener('error', (event) => {
                            try {
                                const data = JSON.parse(event.data);
                                console.error('❌ 流式错误:', data.error);
                                clearTimeout(connectionTimeout);
                                eventSource.close();
                                reject(new Error(data.error));
                            } catch (e) {
                                console.error('❌ 流式错误事件:', event);
                                clearTimeout(connectionTimeout);
                                eventSource.close();
                                reject(new Error('流式连接错误'));
                            }
                        });
                        
                        eventSource.onerror = (error) => {
                            console.error('❌ EventSource连接错误:', error);
                            clearTimeout(connectionTimeout);
                            eventSource.close();
                            reject(new Error('EventSource连接失败'));
                        };
                        
                    }).catch(error => {
                        console.error('❌ 初始化流式API失败:', error);
                        reject(error);
                    });
                });
            }
            
            // 处理AI助手发送按钮
            if (sendBtn && chatInput) {
                sendBtn.addEventListener('click', async function() {
                    const message = chatInput.value.trim();
                    if (message) {
                        console.log('📝 发送消息:', message);
                        
                        // 立即清空输入框并禁用
                        chatInput.value = '';
                        // 移除blur()，保持焦点在输入框以便连续输入
                        sendBtn.disabled = true; // 禁用发送按钮防止重复点击
                        console.log('✅ 输入框已清空');
                        
                        // 添加用户消息
                        addUserMessage(message);
                        
                        // 创建流式消息容器
                        const aiMessageContent = addAssistantMessageStreaming();
                        
                        try {
                            // 调用流式API
                            await callDashScopeAPIStream(message, (content) => {
                                updateStreamingMessage(aiMessageContent, content);
                            });
                            
                            // 移除streaming类
                            if (aiMessageContent) {
                                aiMessageContent.classList.remove('streaming');
                            }
                        } catch (error) {
                            console.error('❌ 聊天API调用失败:', error);
                            if (aiMessageContent) {
                                aiMessageContent.innerHTML = '<p>⚠️ 抱歉，我遇到了一些问题。请检查API配置或稍后再试。</p>';
                                aiMessageContent.classList.remove('streaming');
                            }
                        } finally {
                            // 恢复发送按钮状态
                            sendBtn.disabled = false;
                            // 保持焦点在输入框
                            chatInput.focus();
                        }
                    }
                });
                
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        // 确保输入框有内容才触发发送
                        if (chatInput.value.trim() && !sendBtn.disabled) {
                            sendBtn.click();
                        }
                    }
                });
            }
            
            // AI助手头部按钮功能
            const clearChatBtn = document.getElementById('clearChatBtn');
            const downloadChatBtn = document.getElementById('downloadChatBtn');
            const minimizeAssistantBtn = document.getElementById('minimizeAssistantBtn');
            
            // 清空聊天功能
            if (clearChatBtn) {
                clearChatBtn.addEventListener('click', function() {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        // 重置为欢迎消息
                        chatMessages.innerHTML = `
                            <div class="welcome-message">
                                <div class="assistant-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <h3 class="welcome-title">您好！我是AI学习助手</h3>
                                <p class="welcome-text">我可以回答您关于职业发展、技能提升的问题。请在下方输入您的问题！</p>
                            </div>
                        `;
                        console.log('🧽 聊天记录已清空');
                    }
                });
            }
            
            // 下载聊天记录功能
            if (downloadChatBtn) {
                downloadChatBtn.addEventListener('click', function() {
                    const chatMessages = document.getElementById('chatMessages');
                    if (!chatMessages) {
                        alert('没有聊天记录可下载');
                        return;
                    }
                    
                    const messages = chatMessages.querySelectorAll('.user-message, .assistant-message');
                    let chatContent = '聊天记录 - ' + new Date().toLocaleString() + '\n\n';
                    
                    messages.forEach(message => {
                        if (message.classList.contains('user-message')) {
                            const content = message.querySelector('p');
                            if (content) {
                                chatContent += '用户： ' + content.textContent + '\n\n';
                            }
                        } else if (message.classList.contains('assistant-message')) {
                            const content = message.querySelector('.message-content');
                            if (content) {
                                chatContent += 'AI助手： ' + content.textContent + '\n\n';
                            }
                        }
                    });
                    
                    if (messages.length === 0) {
                        alert('没有聊天记录可下载');
                        return;
                    }
                    
                    // 创建下载文件
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const filename = `AI助手聊天记录_${timestamp}.txt`;
                    
                    const blob = new Blob([chatContent], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    console.log('💾 聊天记录已下载:', filename);
                });
            }
            
            // 缩小/扩大AI助手面板功能
            if (minimizeAssistantBtn) {
                minimizeAssistantBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    toggleAssistantSize();
                });
            }
            
            // 缩小后的点击事件
            const aiAssistant = document.querySelector('.ai-assistant');
            if (aiAssistant) {
                aiAssistant.addEventListener('click', function(e) {
                    // 只有在缩小状态下才响应点击
                    if (this.classList.contains('minimized')) {
                        e.stopPropagation();
                        e.preventDefault();
                        toggleAssistantSize();
                    }
                });
            }
            

            
            // 智能控制AI助手状态的函数
            function controlAIAssistantForSection(sectionType) {
                const aiAssistant = document.querySelector('.ai-assistant');
                const minimizeBtn = document.getElementById('minimizeAssistantBtn');
                const icon = minimizeBtn ? minimizeBtn.querySelector('i') : null;
                
                if (!aiAssistant) return;
                
                console.log('🤖 根据页面类型控制AI助手:', sectionType);
                
                // 所有页面：默认自动缩小AI助手
                if (!aiAssistant.classList.contains('minimized')) {
                    aiAssistant.classList.add('minimized');
                    if (icon) {
                        icon.className = 'fas fa-expand';
                    }
                    if (minimizeBtn) {
                        minimizeBtn.title = '扩大面板';
                    }
                    console.log('🔎 AI助手自动缩小（所有界面默认状态）');
                }
                
                // 如果是思维导图页面，触发自动适配
                if (sectionType === 'mindmap') {
                    setTimeout(() => {
                        const mindmapContent = document.getElementById('mindmapContent');
                        const svg = mindmapContent ? mindmapContent.querySelector('svg') : null;
                        if (svg) {
                            console.log('📊 思维导图页面激活，触发自动适配');
                            // 尝试使用全局变量中的markmap实例
                            if (window.currentMarkmapInstance && typeof window.currentMarkmapInstance.fit === 'function') {
                                try {
                                    window.currentMarkmapInstance.fit();
                                    console.log('✅ 通过全局实例适配成功');
                                } catch (e) {
                                    console.warn('⚠️ 全局实例适配失败:', e);
                                }
                            }
                        }
                    }, 300);
                }
            }
            
            // 初始化AI助手状态的函数
            function initializeAIAssistantState(activeSection) {
                console.log('🚀 初始化AI助手状态:', activeSection);
                // 延迟执行，确保DOM完全加载
                setTimeout(() => {
                    controlAIAssistantForSection(activeSection);
                }, 500);
            }
            
            // 切换AI助手大小的函数
            function toggleAssistantSize() {
                const aiAssistant = document.querySelector('.ai-assistant');
                const minimizeBtn = document.getElementById('minimizeAssistantBtn');
                const icon = minimizeBtn ? minimizeBtn.querySelector('i') : null;
                
                if (aiAssistant) {
                    if (aiAssistant.classList.contains('minimized')) {
                        // 扩大
                        aiAssistant.classList.remove('minimized');
                        if (icon) {
                            icon.className = 'fas fa-compress';
                        }
                        if (minimizeBtn) {
                            minimizeBtn.title = '缩小面板';
                        }
                        console.log('🔍 AI助手面板已扩大');
                    } else {
                        // 缩小
                        aiAssistant.classList.add('minimized');
                        if (icon) {
                            icon.className = 'fas fa-expand';
                        }
                        if (minimizeBtn) {
                            minimizeBtn.title = '扩大面板';
                        }
                        console.log('🔎 AI助手面板已缩小');
                    }
                }
            }
            
            // 初始化面试题笔记功能
            function initInterviewNotes() {
                console.log('📓 初始化面试题笔记功能...');
                
                // 获取所有笔记输入框
                const notesInputs = document.querySelectorAll('.interview-notes-input');
                
                // 为每个输入框添加事件处理
                notesInputs.forEach((input, index) => {
                    // 获取面试题标题
                    const interviewCard = input.closest('.interview-card');
                    if (!interviewCard) return;
                    
                    const titleElement = interviewCard.querySelector('.interview-question');
                    if (!titleElement) return;
                    
                    const interviewTitle = titleElement.textContent;
                    const noteKey = `interview_note_${interviewTitle}`;
                    
                    // 设置标识以便区分
                    input.setAttribute('data-note-key', noteKey);
                    
                    // 从localStorage加载已保存的笔记
                    const savedNotes = JSON.parse(localStorage.getItem('interviewNotes') || '{}');
                    if (savedNotes[noteKey]) {
                        input.value = savedNotes[noteKey];
                    }
                    
                    // 监听输入事件，自动保存
                    input.addEventListener('input', function() {
                        const notes = JSON.parse(localStorage.getItem('interviewNotes') || '{}');
                        notes[noteKey] = this.value;
                        localStorage.setItem('interviewNotes', JSON.stringify(notes));
                        console.log(`✅ 已保存面试题笔记: ${noteKey}`);
                        
                        // 自动保存笔记内容，但不改变按钮状态
                        const noteBtn = interviewCard.querySelector('.interview-btn.outline');
                        // 注意：笔记输入和收藏功能是独立的，输入内容不应该自动改变按钮状态
                        
                        // 保存笔记内容到本地存储
                        const savedNotes = JSON.parse(localStorage.getItem('interviewNotes') || '{}');
                        const questionTitle = document.querySelector('.interview-question')?.textContent || '';
                        const noteKey = `interview_note_${questionTitle}`;
                        savedNotes[noteKey] = this.value;
                        localStorage.setItem('interviewNotes', JSON.stringify(savedNotes));
                    });
                });
                
                console.log(`✅ 面试题笔记功能初始化完成，共${notesInputs.length}个面试题`);
            }
            
            // 处理面试题交互
            function initInterviewQuestions() {
                // 获取面试题元素
                const interviewListItems = document.querySelectorAll('.interview-list-item');
                const refreshQuestionBtn = document.getElementById('refreshQuestion');
                const interviewAnswerInput = document.querySelector('.interview-answer-input');
                const nextQuestionBtn = document.querySelector('.interview-actions .interview-btn.secondary'); // 面试题下一题按钮
                const checkAnswerBtn = document.querySelector('.interview-helper-actions .interview-btn.secondary'); // 查看答案按钮
                const learnedBtn = document.querySelector('.interview-btn.primary');
                const noteBtn = document.querySelector('.interview-btn.outline');
                const aiScoreBtn = document.querySelector('.interview-answer-ai-btn'); // 新增AI评分按钮
                
                // 切换面试题
                if (interviewListItems) {
                    interviewListItems.forEach(item => {
                        item.addEventListener('click', function() {
                            // 获取题目标题和标签
                            const title = this.querySelector('.interview-list-title').textContent;
                            const tags = this.querySelectorAll('.interview-tag');
                            const number = this.querySelector('.interview-list-number').textContent;
                            
                            // 更新当前显示的题目
                            const questionTitle = document.querySelector('.interview-question');
                            const questionTags = document.querySelector('.interview-tags');
                            const questionProgress = document.querySelector('.interview-progress');
                            
                            if (questionTitle) questionTitle.textContent = title;
                            if (questionProgress) {
                                questionProgress.innerHTML = `<i class="fas fa-list-ol"></i> 第 ${number} 题 / 共 50 题`;
                            }
                            
                            // 更新标签
                            if (questionTags) {
                                questionTags.innerHTML = '';
                                tags.forEach(tag => {
                                    questionTags.appendChild(tag.cloneNode(true));
                                });
                            }
                            
                            // 清空输入框
                            if (interviewAnswerInput) {
                                interviewAnswerInput.value = '';
                                interviewAnswerInput.focus();
                            }
                            
                            // 滚动到顶部
                            document.querySelector('.interview-card').scrollIntoView({ behavior: 'smooth' });
                        });
                    });
                }
                
                // 刷新题目
                if (refreshQuestionBtn) {
                    refreshQuestionBtn.addEventListener('click', function() {
                        // 随机选择一个题目
                        const randomIndex = Math.floor(Math.random() * interviewListItems.length);
                        interviewListItems[randomIndex].click();
                    });
                }
                
                // 查看答案 - 已在HTML中使用onclick属性，不需要重复绑定
                // 注释掉重复的事件绑定，避免同一个按钮被触发两次
                /*
                if (checkAnswerBtn) {
                    checkAnswerBtn.addEventListener('click', function() {
                        // 直接调用showAnswer函数显示答案内容
                        const questionId = 'js-closure'; // 或者动态获取题目ID
                        showAnswer(questionId);
                    });
                }
                */
                
                // 我会了按钮
                if (learnedBtn) {
                    learnedBtn.addEventListener('click', function() {
                        // 获取已掌握的面试题列表
                        const learnedInterviews = JSON.parse(localStorage.getItem('learnedInterviews') || '[]');
                        
                        // 获取当前题目标题
                        const questionTitleElement = document.querySelector('.interview-question');
                        if (!questionTitleElement) return;
                        
                        const questionTitle = questionTitleElement.textContent;
                        const isLearned = learnedInterviews.includes(questionTitle);
                        
                        const interviewCard = document.querySelector('.interview-card');
                        
                        if (isLearned) {
                            // 取消掌握状态
                            const updatedList = learnedInterviews.filter(title => title !== questionTitle);
                            localStorage.setItem('learnedInterviews', JSON.stringify(updatedList));
                            
                            // 保持原始样式（不需要恢复）
                            
                            // 恢复按钮状态
                            learnedBtn.innerHTML = '<i class="fas fa-check"></i> 我会了';
                            learnedBtn.style.backgroundColor = '#4f46e5';
                            learnedBtn.disabled = false;
                            
                            // 静默取消掌握状态
                        } else {
                            // 添加掌握状态
                            learnedInterviews.push(questionTitle);
                            localStorage.setItem('learnedInterviews', JSON.stringify(learnedInterviews));
                            
                            // 更新按钮状态（不改变页面外观）
                            learnedBtn.innerHTML = '<i class="fas fa-check"></i> 已掌握';
                            learnedBtn.style.backgroundColor = '#22c55e';
                            
                            // 静默设置掌握状态
                        }
                    });
                }
                
                // 记一下按钮
                if (noteBtn) {
                    noteBtn.addEventListener('click', function() {
                        // 获取当前题目标题
                        const questionTitleElement = document.querySelector('.interview-question');
                        if (!questionTitleElement) return;
                        
                        const questionTitle = questionTitleElement.textContent;
                        const bookmarkKey = `interview_bookmark_${questionTitle}`;
                        const isBookmarked = noteBtn.classList.contains('bookmarked');
                        
                        // 获取收藏列表（与笔记列表分开）
                        const savedBookmarks = JSON.parse(localStorage.getItem('interviewBookmarks') || '{}');
                        
                        if (isBookmarked) {
                            // 取消收藏状态
                            noteBtn.innerHTML = '<i class="fas fa-arrow-right"></i> 记一下';
                            noteBtn.style.backgroundColor = '';
                            noteBtn.style.color = '#4f46e5';
                            noteBtn.style.borderColor = '#4f46e5';
                            noteBtn.classList.remove('bookmarked');
                            
                            // 从收藏列表中删除
                            delete savedBookmarks[bookmarkKey];
                            localStorage.setItem('interviewBookmarks', JSON.stringify(savedBookmarks));
                            
                        } else {
                            // 添加收藏状态
                            noteBtn.innerHTML = '<i class="fas fa-bookmark"></i> 已收藏';
                            noteBtn.style.backgroundColor = '#f59e0b';
                            noteBtn.style.color = 'white';
                            noteBtn.style.borderColor = '#f59e0b';
                            noteBtn.classList.add('bookmarked');
                            
                            // 添加到收藏列表
                            savedBookmarks[bookmarkKey] = {
                                title: questionTitle,
                                timestamp: new Date().toISOString()
                            };
                            localStorage.setItem('interviewBookmarks', JSON.stringify(savedBookmarks));
                        }
                    });
                }
                
                // AI评分按钮事件处理
                if (aiScoreBtn) {
                    aiScoreBtn.addEventListener('click', function() {
                        // 获取当前题目标题
                        const questionTitleElement = document.querySelector('.interview-question');
                        const answerInput = document.querySelector('.interview-answer-input');
                        
                        if (!questionTitleElement || !answerInput) {
                            alert('请先选择面试题并输入答案');
                            return;
                        }
                        
                        const questionTitle = questionTitleElement.textContent;
                        const userAnswer = answerInput.value.trim();
                        
                        if (!userAnswer) {
                            alert('请先输入您的答案');
                            answerInput.focus();
                            return;
                        }
                        
                        // 构建评分提示词
                        const aiPrompt = `请帮我评分这道面试题的答案，并给出详细的改进建议：\n\n题目：${questionTitle}\n\n我的答案：\n${userAnswer}\n\n请从以下方面进行评分：\n1. 知识点掌握情况（10分）\n2. 答题逻辑清晰度（10分）\n3. 代码正确性（如有，10分）\n4. 表达能力（10分）\n5. 综合评价和改进建议`;
                        
                        // 将提示词发送给AI助手
                        const chatInput = document.getElementById('chatInput');
                        const sendBtn = document.getElementById('sendBtn');
                        
                        if (chatInput && sendBtn) {
                            chatInput.value = aiPrompt;
                            sendBtn.click();
                            
                            // 添加点击反馈效果
                            aiScoreBtn.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                aiScoreBtn.style.transform = 'scale(1)';
                            }, 150);
                            
                            // 显示成功提示
                            const originalText = aiScoreBtn.innerHTML;
                            aiScoreBtn.innerHTML = '<i class="fas fa-check"></i> 已发送';
                            aiScoreBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                            
                            setTimeout(() => {
                                aiScoreBtn.innerHTML = originalText;
                                aiScoreBtn.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                            }, 2000);
                        } else {
                            alert('AI助手不可用，请稍后再试');
                        }
                    });
                }
                
                // 下一题按钮事件处理
                if (nextQuestionBtn) {
                    nextQuestionBtn.addEventListener('click', function() {
                        // 获取所有面试题列表项
                        const interviewItems = document.querySelectorAll('.interview-list-item');
                        if (interviewItems.length === 0) {
                            alert('暂无更多面试题');
                            return;
                        }
                        
                        // 获取当前激活的题目（如果有）或者随机选择一个
                        let currentIndex = -1;
                        interviewItems.forEach((item, index) => {
                            if (item.classList.contains('active')) {
                                currentIndex = index;
                            }
                        });
                        
                        // 如果没有当前激活的项，从第一个开始；否则切换到下一个
                        const nextIndex = currentIndex === -1 ? 0 : (currentIndex + 1) % interviewItems.length;
                        
                        // 移除所有激活状态
                        interviewItems.forEach(item => item.classList.remove('active'));
                        
                        // 激活下一个项并点击
                        interviewItems[nextIndex].classList.add('active');
                        interviewItems[nextIndex].click();
                        
                        // 添加点击反馈效果
                        nextQuestionBtn.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            nextQuestionBtn.style.transform = 'scale(1)';
                        }, 150);
                        
                        console.log(`🔄 已切换到第${nextIndex + 1}题`);
                    });
                }
            }
            
            // 初始化面试题功能
            initInterviewQuestions();
            
            // 恢复已掌握的面试题状态
            const learnedInterviews = JSON.parse(localStorage.getItem('learnedInterviews') || '[]');
            const currentQuestionTitle = document.querySelector('.interview-question');
            if (currentQuestionTitle && learnedInterviews.includes(currentQuestionTitle.textContent)) {
                const learnedBtn = document.querySelector('.interview-btn.primary');
                
                // 只更新按钮状态，不改变页面外观
                if (learnedBtn) {
                    learnedBtn.innerHTML = '<i class="fas fa-check"></i> 已掌握';
                    learnedBtn.style.backgroundColor = '#22c55e';
                }
            }
            
            // 恢复已收藏的面试题状态和笔记内容
            const savedInterviewBookmarks = JSON.parse(localStorage.getItem('interviewBookmarks') || '{}');
            const savedInterviewNotes = JSON.parse(localStorage.getItem('interviewNotes') || '{}');
            const currentInterviewTitle = document.querySelector('.interview-question');
            if (currentInterviewTitle) {
                const noteBtn = document.querySelector('.interview-btn.outline');
                const bookmarkKey = `interview_bookmark_${currentInterviewTitle.textContent}`;
                const noteKey = `interview_note_${currentInterviewTitle.textContent}`;
                
                // 恢复收藏状态（基于收藏列表，不是笔记内容）
                if (savedInterviewBookmarks[bookmarkKey] && noteBtn) {
                    noteBtn.innerHTML = '<i class="fas fa-bookmark"></i> 已收藏';
                    noteBtn.style.backgroundColor = '#f59e0b';
                    noteBtn.style.color = 'white';
                    noteBtn.style.borderColor = '#f59e0b';
                    noteBtn.classList.add('bookmarked');
                }
                
                // 恢复笔记内容
                if (savedInterviewNotes[noteKey] && savedInterviewNotes[noteKey].trim() !== '') {
                    const notesInput = document.querySelector('.interview-notes-input');
                    if (notesInput) {
                        notesInput.value = savedInterviewNotes[noteKey];
                    }
                }
            }
            
            // 初始化面试题笔记功能
            initInterviewNotes();
            
            // 初始化知识点功能
            initKnowledgeButtons();
            
            // 初始化知识点笔记功能
            initKnowledgeNotes();
            
            // 初始化知识点笔记功能
            function initKnowledgeNotes() {
                console.log('📃 初始化知识点笔记功能...');
                
                // 获取所有笔记输入框
                const notesInputs = document.querySelectorAll('.knowledge-notes-input');
                
                // 为每个输入框添加事件处理
                notesInputs.forEach((input, index) => {
                    // 获取知识点标题
                    const knowledgeItem = input.closest('.knowledge-item');
                    if (!knowledgeItem) return;
                    
                    const titleElement = knowledgeItem.querySelector('.knowledge-title');
                    if (!titleElement) return;
                    
                    const knowledgeTitle = titleElement.textContent;
                    const noteKey = `knowledge_note_${knowledgeTitle}`;
                    
                    // 设置标识以便区分
                    input.setAttribute('data-note-key', noteKey);
                    
                    // 从localStorage加载已保存的笔记
                    const savedNotes = JSON.parse(localStorage.getItem('knowledgeNotes') || '{}');
                    if (savedNotes[noteKey]) {
                        input.value = savedNotes[noteKey];
                    }
                    
                    // 监听输入事件，自动保存
                    input.addEventListener('input', function() {
                        const notes = JSON.parse(localStorage.getItem('knowledgeNotes') || '{}');
                        notes[noteKey] = this.value;
                        localStorage.setItem('knowledgeNotes', JSON.stringify(notes));
                        console.log(`✅ 已保存知识点笔记: ${noteKey}`);
                        
                        // 自动保存笔记内容，但不改变按钮状态
                        const noteBtn = knowledgeItem.querySelector('.knowledge-btn.outline');
                        // 注意：笔记输入和收藏功能是独立的，输入内容不应该自动改变按钮状态
                        
                        // 保存笔记内容到本地存储
                        const savedNotes = JSON.parse(localStorage.getItem('knowledgeNotes') || '{}');
                        const knowledgeTitle = knowledgeItem.querySelector('.knowledge-card h3')?.textContent || '';
                        const noteKey = `knowledge_note_${knowledgeTitle}`;
                        savedNotes[noteKey] = this.value;
                        localStorage.setItem('knowledgeNotes', JSON.stringify(savedNotes));
                    });
                });
                
                console.log(`✅ 知识点笔记功能初始化完成，共${notesInputs.length}个知识点`);
            }
            
            // 初始化知识点按钮功能
            function initKnowledgeButtons() {
                const knowledgeItems = document.querySelectorAll('.knowledge-item');
                
                knowledgeItems.forEach((item, index) => {
                    const nextBtn = item.querySelector('.knowledge-btn.secondary');
                    const learnedBtn = item.querySelector('.knowledge-btn.primary');
                    const noteBtn = item.querySelector('.knowledge-btn.outline');
                    const knowledgeTitle = item.querySelector('.knowledge-title').textContent;
                    
                    // "下一个"按钮功能
                    if (nextBtn) {
                        nextBtn.addEventListener('click', function() {
                            alert(`已切换到下一个知识点！这里可以实现知识点切换逻辑。`);
                        });
                    }
                    
                    // "我会了"按钮功能
                    if (learnedBtn) {
                        learnedBtn.addEventListener('click', function() {
                            // 获取已掌握的知识点列表
                            const learnedKnowledge = JSON.parse(localStorage.getItem('learnedKnowledge') || '[]');
                            const isLearned = learnedKnowledge.includes(knowledgeTitle);
                            
                            if (isLearned) {
                                // 取消掌握状态
                                const updatedList = learnedKnowledge.filter(title => title !== knowledgeTitle);
                                localStorage.setItem('learnedKnowledge', JSON.stringify(updatedList));
                                
                                // 保持原始样式（不需要恢复）
                                
                                // 恢复按钮状态
                                learnedBtn.innerHTML = '<i class="fas fa-check"></i> 我会了';
                                learnedBtn.style.backgroundColor = '#4f46e5';
                                learnedBtn.disabled = false;
                                
                                // 静默取消掌握状态
                            } else {
                                // 添加掌握状态
                                learnedKnowledge.push(knowledgeTitle);
                                localStorage.setItem('learnedKnowledge', JSON.stringify(learnedKnowledge));
                                
                                // 更新按钮状态（不改变页面外观）
                                learnedBtn.innerHTML = '<i class="fas fa-check"></i> 已掌握';
                                learnedBtn.style.backgroundColor = '#22c55e';
                                
                                // 静默设置掌握状态
                            }
                        });
                    }
                    
                    // "记一下"按钮功能
                    if (noteBtn) {
                        noteBtn.addEventListener('click', function() {
                            // 获取当前知识点标题
                            const knowledgeTitle = item.querySelector('.knowledge-card h3')?.textContent || '';
                            const bookmarkKey = `knowledge_bookmark_${knowledgeTitle}`;
                            const isBookmarked = noteBtn.classList.contains('bookmarked');
                            
                            // 获取收藏列表（与笔记列表分开）
                            const savedBookmarks = JSON.parse(localStorage.getItem('knowledgeBookmarks') || '{}');
                            
                            if (isBookmarked) {
                                // 取消收藏状态
                                noteBtn.innerHTML = '<i class="fas fa-arrow-right"></i> 记一下';
                                noteBtn.style.backgroundColor = '';
                                noteBtn.style.color = '#4f46e5';
                                noteBtn.style.borderColor = '#4f46e5';
                                noteBtn.classList.remove('bookmarked');
                                
                                // 从收藏列表中删除
                                delete savedBookmarks[bookmarkKey];
                                localStorage.setItem('knowledgeBookmarks', JSON.stringify(savedBookmarks));
                                
                            } else {
                                // 添加收藏状态
                                noteBtn.innerHTML = '<i class="fas fa-bookmark"></i> 已收藏';
                                noteBtn.style.backgroundColor = '#f59e0b';
                                noteBtn.style.color = 'white';
                                noteBtn.style.borderColor = '#f59e0b';
                                noteBtn.classList.add('bookmarked');
                                
                                // 添加到收藏列表
                                savedBookmarks[bookmarkKey] = {
                                    title: knowledgeTitle,
                                    timestamp: new Date().toISOString()
                                };
                                localStorage.setItem('knowledgeBookmarks', JSON.stringify(savedBookmarks));
                            }
                        });
                    }
                });
                
                // 恢复已掌握的知识点状态
                const learnedKnowledge = JSON.parse(localStorage.getItem('learnedKnowledge') || '[]');
                knowledgeItems.forEach(item => {
                    const title = item.querySelector('.knowledge-title').textContent;
                    const learnedBtn = item.querySelector('.knowledge-btn.primary');
                    
                    if (learnedKnowledge.includes(title) && learnedBtn) {
                        // 只更新按钮状态，不改变页面外观
                        learnedBtn.innerHTML = '<i class="fas fa-check"></i> 已掌握';
                        learnedBtn.style.backgroundColor = '#22c55e';
                    }
                });
                
                // 恢复已收藏的知识点状态
                knowledgeItems.forEach(item => {
                    const noteBtn = item.querySelector('.knowledge-btn.outline');
                    const knowledgeTitle = item.querySelector('.knowledge-card h3')?.textContent || '';
                    const savedBookmarks = JSON.parse(localStorage.getItem('knowledgeBookmarks') || '{}');
                    const savedNotes = JSON.parse(localStorage.getItem('knowledgeNotes') || '{}');
                    const bookmarkKey = `knowledge_bookmark_${knowledgeTitle}`;
                    const noteKey = `knowledge_note_${knowledgeTitle}`;
                    
                    // 恢复收藏状态（基于收藏列表，不是笔记内容）
                    if (savedBookmarks[bookmarkKey] && noteBtn) {
                        noteBtn.innerHTML = '<i class="fas fa-bookmark"></i> 已收藏';
                        noteBtn.style.backgroundColor = '#f59e0b';
                        noteBtn.style.color = 'white';
                        noteBtn.style.borderColor = '#f59e0b';
                        noteBtn.classList.add('bookmarked');
                    }
                    
                    // 恢复笔记内容
                    if (savedNotes[noteKey] && savedNotes[noteKey].trim() !== '') {
                        const notesInput = item.querySelector('.knowledge-notes-input');
                        if (notesInput) {
                            notesInput.value = savedNotes[noteKey];
                        }
                    }
                });
            }
            
            // 解题思路功能
            function showSolution(questionId) {
                console.log('🧠 显示解题思路:', questionId);
                
                // 获取对应的解题思路区域
                const solutionArea = document.getElementById(`solution-${questionId}`);
                const solutionBtn = document.querySelector(`[onclick="showSolution('${questionId}')"]`);
                
                if (!solutionArea) {
                    console.error('未找到解题思路区域');
                    return;
                }
                
                // 切换显示状态
                if (solutionArea.classList.contains('show')) {
                    solutionArea.classList.remove('show');
                    if (solutionBtn) {
                        solutionBtn.innerHTML = '<i class="fas fa-lightbulb"></i>解题思路';
                    }
                } else {
                    solutionArea.classList.add('show');
                    if (solutionBtn) {
                        solutionBtn.innerHTML = '<i class="fas fa-eye-slash"></i>隐藏思路';
                    }
                }
            }
            
            // 查看答案功能 - 简洁版本（带防重复调用）
            let showAnswerLock = false; // 防重复调用锁
            function showAnswer(questionId) {
                // 防重复调用检查
                if (showAnswerLock) {
                    console.log('🔒 showAnswer被锁定，忽略重复调用');
                    return;
                }
                
                showAnswerLock = true;
                console.log('🔍 showAnswer called with questionId:', questionId);
                
                try {
                    // 获取对应的答案区域
                    const answerAreaId = `answer-${questionId}`;
                    const answerArea = document.getElementById(answerAreaId);
                    
                    if (!answerArea) {
                        console.error('❌ 未找到答案区域:', answerAreaId);
                        return;
                    }
                    
                    // 查找按钮
                    const answerBtn = document.querySelector(`[onclick*="showAnswer('${questionId}')"]`);
                    
                    // 切换显示状态
                    if (answerArea.classList.contains('show')) {
                        // 当前显示中，切换为隐藏
                        answerArea.classList.remove('show');
                        if (answerBtn) {
                            answerBtn.innerHTML = '<i class="fas fa-eye"></i>查看答案';
                        }
                        console.log('✅ 已隐藏答案');
                    } else {
                        // 当前隐藏中，切换为显示
                        answerArea.classList.add('show');
                        if (answerBtn) {
                            answerBtn.innerHTML = '<i class="fas fa-eye-slash"></i>隐藏答案';
                        }
                        console.log('✅ 已显示答案');
                    }
                } finally {
                    // 解锁，允许下次调用
                    setTimeout(() => {
                        showAnswerLock = false;
                    }, 200); // 200ms后解锁
                }
            }
            
            // AI聊天功能
            function startAIChat(questionId) {
                console.log('🤖 启动AI聊天:', questionId);
                
                // 获取题目内容
                const questionCard = document.querySelector(`[data-question-id="${questionId}"]`) || document.querySelector('.interview-card');
                if (!questionCard) {
                    console.error('未找到题目卡片');
                    return;
                }
                
                const questionText = questionCard.querySelector('.interview-question').textContent;
                const questionTags = Array.from(questionCard.querySelectorAll('.interview-tag')).map(tag => tag.textContent).join(', ');
                
                // 构建聊天内容
                const chatContent = `面试题目：${questionText}\n\n请帮我分析这道面试题，并提供详细的解答思路和参考答案。`;
                
                // 发送消息到AI助手
                sendMessageToAI(chatContent);
                
                // 显示反馈
                console.log('✅ 已将题目发送到AI助手');
            }
            
            // 发送消息到AI助手的函数
            function sendMessageToAI(message) {
                console.log('📤 直接发送消息到AI助手:', message);
                
                // 获取发送按钮和输入框
                const chatInput = document.querySelector('.chat-input');
                const sendBtn = document.querySelector('.send-btn');
                
                if (!chatInput || !sendBtn) {
                    console.error('❌ 未找到聊天组件');
                    return;
                }
                
                // 检查发送按钮是否可用，如果不可用就放弃此次调用
                if (sendBtn.disabled) {
                    console.warn('⚠️ 发送按钮当前不可用，放弃此次调用以避免冲突');
                    return;
                }
                
                // 确保输入框为空（符合交互规范）
                chatInput.value = '';
                
                // 直接调用发送逻辑，不通过输入框
                console.log('📝 发送消息:', message);
                
                // 禁用发送按钮防止重复点击
                sendBtn.disabled = true;
                
                // 添加用户消息
                addUserMessage(message);
                
                // 创建流式消息容器
                const aiMessageContent = addAssistantMessageStreaming();
                
                // 调用流式API
                callDashScopeAPIStream(message, (content) => {
                    updateStreamingMessage(aiMessageContent, content);
                }).then(() => {
                    // 移除streaming类
                    if (aiMessageContent) {
                        aiMessageContent.classList.remove('streaming');
                    }
                }).catch(error => {
                    console.error('❌ 聊天API调用失败:', error);
                    if (aiMessageContent) {
                        aiMessageContent.innerHTML = '<p>⚠️ 抱歉，我遇到了一些问题。请检查API配置或稍后再试。</p>';
                        aiMessageContent.classList.remove('streaming');
                    }
                }).finally(() => {
                    // 恢复发送按钮状态
                    sendBtn.disabled = false;
                    // 保持焦点在输入框（符合交互规范）
                    chatInput.focus();
                });
                
                // 如果AI助手被最小化，就恢复它
                const aiAssistant = document.querySelector('.ai-assistant');
                if (aiAssistant && aiAssistant.classList.contains('minimized')) {
                    aiAssistant.classList.remove('minimized');
                    const minimizeBtn = document.getElementById('minimizeAssistantBtn');
                    const icon = minimizeBtn ? minimizeBtn.querySelector('i') : null;
                    if (icon) {
                        icon.className = 'fas fa-compress';
                    }
                    if (minimizeBtn) {
                        minimizeBtn.title = '缩小面板';
                    }
                }
            }
            
            // 生成答案内容的函数
            function generateAnswerContent(questionId) {
                return `
                    <div class="answer-title">
                        <i class="fas fa-check-circle"></i>
                        参考答案
                    </div>
                    <div class="answer-content">
                        <h4>标准答案要点</h4>
                        <p>这里会显示该面试题的详细参考答案，包括核心概念、实际应用、代码示例等内容。</p>
                        
                        <h4>评分标准</h4>
                        <ul>
                            <li><strong>基础概念理解</strong>：能够准确说出核心定义</li>
                            <li><strong>原理阐述</strong>：能够解释工作机制和原理</li>
                            <li><strong>实际应用</strong>：能够举出具体的应用场景</li>
                            <li><strong>代码示例</strong>：能够提供相关的代码演示</li>
                        </ul>
                        
                        <h4>加分项</h4>
                        <ul>
                            <li>主动提及相关的扩展知识点</li>
                            <li>分析可能的优缺点或注意事项</li>
                            <li>展示实际项目经验</li>
                        </ul>
                    </div>
                `;
            }
            
            // 示例解题思路数据
            const solutionData = {
                'js-closure': {
                    title: 'JavaScript闭包解题思路',
                    content: `
                        <h4>1. 理解题目要求</h4>
                        <p>面试官想了解你对闭包概念的掌握程度，包括：</p>
                        <ul>
                            <li>闭包的定义和原理</li>
                            <li>闭包的实际应用场景</li>
                            <li>闭包可能带来的问题</li>
                        </ul>
                        
                        <h4>2. 回答要点</h4>
                        <ul>
                            <li><strong>定义：</strong>闭包是指有权访问另一个函数作用域中变量的函数</li>
                            <li><strong>原理：</strong>内部函数引用外部函数的变量，即使外部函数执行完毕，这些变量仍然被保存在内存中</li>
                            <li><strong>应用：</strong>模块化编程、私有变量、回调函数等</li>
                        </ul>
                        
                        <h4>3. 示例代码</h4>
                        <p>准备一个简单的闭包示例：</p>
                        <pre><code>function createCounter() {
    let count = 0;
    return function() {
        return ++count;
    };
}
const counter = createCounter();
console.log(counter()); // 1
console.log(counter()); // 2</code></pre>
                        
                        <h4>4. 注意事项</h4>
                        <ul>
                            <li>提到内存泄漏的风险</li>
                            <li>说明如何避免闭包陷阱</li>
                            <li>强调合理使用的重要性</li>
                        </ul>
                    `
                }
            };
            
            // 动态生成解题思路内容
            function generateSolutionContent(questionId) {
                const solution = solutionData[questionId];
                if (!solution) {
                    return `
                        <div class="solution-title">
                            <i class="fas fa-lightbulb"></i>
                            解题思路
                        </div>
                        <div class="solution-content">
                            <h4>1. 分析题目关键点</h4>
                            <p>首先理解面试官的真实意图，明确要考查的技术点。</p>
                            
                            <h4>2. 组织答案结构</h4>
                            <ul>
                                <li>先给出核心概念的定义</li>
                                <li>详细解释工作原理</li>
                                <li>举例说明实际应用</li>
                                <li>总结优缺点和注意事项</li>
                            </ul>
                            
                            <h4>3. 回答技巧</h4>
                            <ul>
                                <li>保持逻辑清晰，由浅入深</li>
                                <li>结合具体代码示例</li>
                                <li>主动提及相关技术点</li>
                                <li>展示解决问题的思维过程</li>
                            </ul>
                            
                            <h4>4. 加分项</h4>
                            <p>主动扩展相关知识点，展示技术深度和广度。</p>
                        </div>
                    `;
                }
                
                return `
                    <div class="solution-title">
                        <i class="fas fa-lightbulb"></i>
                        ${solution.title}
                    </div>
                    <div class="solution-content">
                        ${solution.content}
                    </div>
                `;
            }
            
            // 为所有面试题卡片添加解题思路区域
            function initSolutionFeature() {
                console.log('🔧 初始化解题思路功能...');
                
                const interviewCards = document.querySelectorAll('.interview-card');
                
                interviewCards.forEach((card, index) => {
                    const questionId = `question-${index + 1}`;
                    
                    // 检查是否已经有helper-actions区域
                    let helperActionsDiv = card.querySelector('.interview-helper-actions');
                    
                    // 如果没有helper-actions区域，则创建一个
                    if (!helperActionsDiv) {
                        helperActionsDiv = document.createElement('div');
                        helperActionsDiv.className = 'interview-helper-actions';
                        helperActionsDiv.style.cssText = 'display: flex; gap: 0.75rem; margin: 1.5rem 0;';
                        
                        // 找到适合的插入位置（tags之后，answer-input之前）
                        const tagsDiv = card.querySelector('.interview-tags');
                        const answerInput = card.querySelector('.interview-answer-input');
                        
                        if (tagsDiv && answerInput) {
                            // 在tags之后、answer-input之前插入
                            answerInput.parentNode.insertBefore(helperActionsDiv, answerInput);
                            
                            // 添加解题思路按钮
                            const solutionBtn = document.createElement('button');
                            solutionBtn.className = 'interview-btn solution';
                            solutionBtn.style.flex = '1';
                            solutionBtn.innerHTML = '<i class="fas fa-lightbulb"></i>解题思路';
                            solutionBtn.onclick = () => showSolution(questionId);
                            
                            // 添加查看答案按钮
                            const answerBtn = document.createElement('button');
                            answerBtn.className = 'interview-btn secondary';
                            answerBtn.style.flex = '1';
                            answerBtn.innerHTML = '<i class="fas fa-eye"></i>查看答案';
                            // 使用setAttribute设置onclick属性，避免重复绑定
                            answerBtn.setAttribute('onclick', `showAnswer('${questionId}')`);
                            
                            helperActionsDiv.appendChild(solutionBtn);
                            helperActionsDiv.appendChild(answerBtn);
                        }
                    }
                    
                    // 在面试题卡片中添加解题思路显示区域（在答案输入框之前）
                    const existingSolutionArea = card.querySelector(`#solution-${questionId}`);
                    if (!existingSolutionArea) {
                        const solutionDiv = document.createElement('div');
                        solutionDiv.id = `solution-${questionId}`;
                        solutionDiv.className = 'solution-area';
                        solutionDiv.innerHTML = generateSolutionContent(questionId);
                        
                        // 插入到答案输入框之前
                        const answerInput = card.querySelector('.interview-answer-input');
                        if (answerInput) {
                            answerInput.parentNode.insertBefore(solutionDiv, answerInput);
                        } else {
                            // 如果没有找到答案输入框，就插入到helper-actions之后
                            if (helperActionsDiv.nextSibling) {
                                helperActionsDiv.parentNode.insertBefore(solutionDiv, helperActionsDiv.nextSibling);
                            } else {
                                helperActionsDiv.parentNode.appendChild(solutionDiv);
                            }
                        }
                    }
                    
                    // 添加答案显示区域
                    const existingAnswerArea = card.querySelector(`#answer-${questionId}`);
                    if (!existingAnswerArea) {
                        const answerDiv = document.createElement('div');
                        answerDiv.id = `answer-${questionId}`;
                        answerDiv.className = 'answer-area';
                        answerDiv.innerHTML = generateAnswerContent(questionId);
                        
                        // 插入到解题思路区域之后，答案输入框之前
                        const solutionArea = card.querySelector(`#solution-${questionId}`);
                        const answerInput = card.querySelector('.interview-answer-input');
                        
                        if (solutionArea && answerInput) {
                            answerInput.parentNode.insertBefore(answerDiv, answerInput);
                        } else if (answerInput) {
                            answerInput.parentNode.insertBefore(answerDiv, answerInput);
                        } else if (helperActionsDiv.nextSibling) {
                            helperActionsDiv.parentNode.insertBefore(answerDiv, helperActionsDiv.nextSibling);
                        } else {
                            helperActionsDiv.parentNode.appendChild(answerDiv);
                        }
                    }
                });
                
                console.log('✅ 解题思路功能初始化完成');
            }
            
            // 知识点AI聊天功能
            function startAIKnowledgeChat(knowledgeId) {
                console.log('🤖 启动知识点AI聊天:', knowledgeId);
                
                // 尝试多种方式获取知识点内容
                let knowledgeItem = null;
                
                // 方法1：通过onclick属性查找
                const clickButtons = document.querySelectorAll('[onclick*="startAIKnowledgeChat"]');
                for (let btn of clickButtons) {
                    if (btn.onclick && btn.onclick.toString().includes(knowledgeId)) {
                        knowledgeItem = btn.closest('.knowledge-item');
                        break;
                    }
                }
                
                // 方法2：直接查找最近的知识点容器
                if (!knowledgeItem) {
                    knowledgeItem = document.querySelector('.knowledge-item');
                }
                
                if (!knowledgeItem) {
                    console.error('未找到知识点卡片');
                    alert('未找到知识点内容，请刷新页面重试');
                    return;
                }
                
                console.log('✅ 找到知识点元素:', knowledgeItem);
                
                // 获取知识点标题
                const knowledgeTitleElement = knowledgeItem.querySelector('.knowledge-title');
                const knowledgeTitle = knowledgeTitleElement ? knowledgeTitleElement.textContent : '未知知识点';
                
                // 获取知识点内容
                const knowledgeTextElement = knowledgeItem.querySelector('.knowledge-text');
                let knowledgeContent = '';
                
                if (knowledgeTextElement) {
                    // 提取知识点的文本内容，去掉HTML标签
                    knowledgeContent = knowledgeTextElement.textContent || knowledgeTextElement.innerText || '';
                }
                
                console.log('📖 知识点标题:', knowledgeTitle);
                console.log('📄 知识点内容预览:', knowledgeContent.substring(0, 100) + '...');
                
                // 构建聊天内容
                const chatContent = `知识点：${knowledgeTitle}\n\n知识点内容：\n${knowledgeContent}\n\n请帮我深入学习这个知识点，包括相关概念解释、实际应用场景、学习建议等。`;
                
                // 发送消息到AI助手
                sendMessageToAI(chatContent);
                
                // 显示反馈
                console.log('✅ 已将知识点发送到AI助手');
                
                // 静默发送到AI助手
            }
            
            // 全局暴露函数
            window.showSolution = showSolution;
            window.showAnswer = showAnswer;
            window.startAIChat = startAIChat;
            window.startAIKnowledgeChat = startAIKnowledgeChat;
            window.sendMessageToAI = sendMessageToAI;
            
            // 验证函数是否正确暴露
            console.log('🔍 验证全局函数暴露:', {
                showSolution: typeof window.showSolution,
                showAnswer: typeof window.showAnswer, 
                startAIChat: typeof window.startAIChat,
                startAIKnowledgeChat: typeof window.startAIKnowledgeChat,
                sendMessageToAI: typeof window.sendMessageToAI
            });
            
            // 测试直接调用
            console.log('🧪 测试直接调用 showAnswer:');
            try {
                console.log('✅ showAnswer 函数存在，可以调用');
            } catch (e) {
                console.error('❌ showAnswer 函数调用失败:', e);
            }
            
            // 初始化解题思路功能 - 暂时注释掉避免重复按钮创建
            // initSolutionFeature();
            
            // 页面加载完成后的验证
            setTimeout(() => {
                console.log('🔍 页面加载完成，验证元素和函数:');
                console.log('答案区域:', document.getElementById('answer-js-closure'));
                console.log('答案按钮:', document.querySelector('[onclick*="showAnswer"]'));
                console.log('showAnswer函数:', window.showAnswer);
                
                // 手动测试调用
                console.log('🧪 手动测试调用 showAnswer:');
                if (window.showAnswer) {
                    console.log('✅ 可以手动调用 showAnswer');
                } else {
                    console.error('❌ 无法手动调用 showAnswer');
                }
            }, 1000);
            
            // 测试AI机器人图标的点击事件
            const aiChatBtns = document.querySelectorAll('.ai-chat-btn');
            console.log('🤖 找到AI聊天按钮数量:', aiChatBtns.length);
            
            aiChatBtns.forEach((btn, index) => {
                console.log(`🔘 AI按钮 ${index + 1}:`, {
                    onclick: btn.onclick,
                    onclickStr: btn.getAttribute('onclick'),
                    element: btn
                });
                
                // 为每个按钮添加额外的点击事件监听器作为备用
                btn.addEventListener('click', function(e) {
                    console.log('💆 AI按钮被点击:', this);
                    
                    // 如果是知识点的AI按钮
                    if (this.getAttribute('onclick') && this.getAttribute('onclick').includes('startAIKnowledgeChat')) {
                        e.preventDefault();
                        const match = this.getAttribute('onclick').match(/startAIKnowledgeChat\('([^']+)'\)/);
                        if (match) {
                            const knowledgeId = match[1];
                            console.log('🔄 手动调用 startAIKnowledgeChat:', knowledgeId);
                            startAIKnowledgeChat(knowledgeId);
                        }
                    }
                });
            });
            
        });
    </script>
</body>

<!-- API配置模态框 -->
<div class="modal" id="apiConfigModal">
    <div class="modal-overlay"></div>
    <div class="modal-container">
        <div class="modal-header">
            <h3>
                <i class="fas fa-cog"></i>
                配置API密钥
            </h3>
            <button class="modal-close" id="apiConfigClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p class="modal-description">请输入您的API密钥，以获得更好的AI功能体验。</p>
            
            <div class="input-group">
                <label for="apiKey">大语言模型 API 密钥</label>
                <div class="key-input-container">
                    <input type="password" id="apiKey" placeholder="输入您的API密钥..." class="modal-input">
                    <button class="toggle-btn" id="toggleApiKey">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="provider-select">
                <label for="apiProvider">模型提供商</label>
                <select id="apiProvider" class="modal-select">
                    <option value="alibaba">阿里云 - DashScope</option>
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic Claude</option>
                </select>
            </div>
            
            <div class="provider-info alibaba-info">
                <div class="provider-logo">
                    <i class="fas fa-cloud" style="font-size: 32px; color: #ff6a00;"></i>
                </div>
                <div class="provider-details">
                    <h4>阿里云 DashScope</h4>
                    <p>使用通义大模型系列，包括模型通义千问2.0等</p>
                    <a href="https://dashscope.aliyun.com/" target="_blank" class="provider-link">获取密钥</a>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn modal-btn-cancel" id="apiConfigCancel">取消</button>
            <button class="modal-btn modal-btn-confirm" id="apiConfigConfirm">保存配置</button>
        </div>
    </div>
</div>
</html>
