<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>按钮测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { border-color: #28a745; background-color: #d4edda; }
        .error { border-color: #dc3545; background-color: #f8d7da; }
        .warning { border-color: #ffc107; background-color: #fff3cd; }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #console {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔧 生成学习路线按钮测试</h1>
        
        <div class="test-item">
            <h3>📋 当前状态检查</h3>
            <p id="status">正在检查...</p>
        </div>
        
        <div class="test-item">
            <h3>🎯 快速测试</h3>
            <input type="text" id="testInput" placeholder="输入职位名称（如：AI工程师）" value="AI工程师">
            <br>
            <button class="btn btn-primary" id="testButton" disabled>生成学习路线</button>
            <button class="btn btn-success" onclick="forceEnable()">强制启用</button>
            <button class="btn btn-danger" onclick="runDiagnostic()">诊断问题</button>
        </div>
        
        <div class="test-item">
            <h3>🚀 快速修复</h3>
            <button class="btn btn-primary" onclick="window.open('http://localhost:3000', '_blank')">打开职途助手</button>
            <button class="btn btn-success" onclick="runQuickFix()">执行快速修复</button>
        </div>
        
        <div class="test-item">
            <h3>📊 控制台日志</h3>
            <div id="console"></div>
            <button class="btn btn-primary" onclick="clearConsole()">清除日志</button>
        </div>
    </div>

    <script>
        let console_div = document.getElementById('console');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            console_div.innerHTML += `[${timestamp}] ${message}<br>`;
            console_div.scrollTop = console_div.scrollHeight;
            console.log(message);
        }
        
        function clearConsole() {
            console_div.innerHTML = '';
        }
        
        function checkStatus() {
            fetch('http://localhost:3000')
                .then(response => response.text())
                .then(html => {
                    const hasGenerateBtn = html.includes('generateBtn');
                    const hasDisabled = html.includes('generateBtn" class="generate-btn" disabled');
                    
                    let status = '';
                    if (hasGenerateBtn) {
                        status += '✅ 生成按钮存在<br>';
                        status += hasDisabled ? '❌ 按钮被禁用' : '✅ 按钮状态正常';
                    } else {
                        status = '❌ 生成按钮不存在';
                    }
                    
                    document.getElementById('status').innerHTML = status;
                    log(`服务器状态检查: ${hasGenerateBtn ? '按钮存在' : '按钮缺失'}, ${hasDisabled ? '被禁用' : '正常'}`);
                })
                .catch(error => {
                    document.getElementById('status').innerHTML = '❌ 服务器连接失败';
                    log(`连接失败: ${error.message}`);
                });
        }
        
        function forceEnable() {
            const testButton = document.getElementById('testButton');
            testButton.disabled = false;
            testButton.style.opacity = '1';
            testButton.style.cursor = 'pointer';
            log('🔧 测试按钮已强制启用');
        }
        
        function runDiagnostic() {
            log('🔍 开始诊断...');
            
            // 检查输入框
            const input = document.getElementById('testInput');
            log(`📝 输入框值: "${input.value}"`);
            
            // 检查按钮状态
            const button = document.getElementById('testButton');
            log(`🔘 按钮状态: disabled=${button.disabled}, opacity=${button.style.opacity}`);
            
            // 测试修复脚本
            if (input.value.trim().length > 0) {
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
                log('✅ 诊断修复完成');
            } else {
                log('⚠️ 请先输入职位名称');
            }
        }
        
        function runQuickFix() {
            log('🚑 执行快速修复...');
            
            // 向主页面注入修复脚本
            const fixScript = `
                const jobTitle = document.getElementById('jobTitle');
                const generateBtn = document.getElementById('generateBtn');
                
                if (jobTitle && generateBtn) {
                    if (jobTitle.value.trim().length > 0) {
                        generateBtn.disabled = false;
                        generateBtn.style.opacity = '1';
                        generateBtn.style.cursor = 'pointer';
                        generateBtn.removeAttribute('disabled');
                        console.log('✅ 按钮已修复');
                    }
                }
            `;
            
            log('💉 修复脚本已生成，请在主页面控制台中运行');
            log('或者直接访问: http://localhost:3000');
        }
        
        // 初始化测试按钮功能
        document.getElementById('testInput').addEventListener('input', function(e) {
            const button = document.getElementById('testButton');
            const hasValue = e.target.value.trim().length > 0;
            
            button.disabled = !hasValue;
            button.style.opacity = hasValue ? '1' : '0.6';
            button.style.cursor = hasValue ? 'pointer' : 'not-allowed';
            
            log(`📝 输入变化: "${e.target.value}", 按钮${hasValue ? '启用' : '禁用'}`);
        });
        
        document.getElementById('testButton').addEventListener('click', function() {
            log('🔘 测试按钮被点击');
            alert('测试按钮工作正常！现在请在主页面测试实际功能。');
        });
        
        // 页面加载完成后检查状态
        window.addEventListener('load', () => {
            log('🚀 测试页面已加载');
            checkStatus();
            
            // 初始状态检查
            const input = document.getElementById('testInput');
            if (input.value.trim().length > 0) {
                forceEnable();
            }
        });
        
        // 定期检查服务器状态
        setInterval(checkStatus, 5000);
    </script>
</body>
</html>