<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éªŒè¯æ··åˆæ–¹æ¡ˆä¿®å¤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-btn:hover {
            background: #3730a3;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .status.success { background: #d1fae5; color: #065f46; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .status.info { background: #e0e7ff; color: #3730a3; }
        .status.warning { background: #fef3c7; color: #92400e; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ éªŒè¯æ··åˆæ–¹æ¡ˆä¿®å¤</h1>
        
        <div class="status success">
            âœ… <strong>æ–°çš„ä¿®å¤ç­–ç•¥</strong>:
            <ul>
                <li>ä¿æŒmockæµç¨‹ç¨³å®šæ€§ï¼Œé¿å…ç ´åç°æœ‰åŠŸèƒ½</li>
                <li>åœ¨generateMockJobDataä¸­å¼‚æ­¥è·å–çœŸå®è¯¾ç¨‹æ•°æ®</li>
                <li>å¦‚æœè·å–æˆåŠŸï¼Œç”¨çœŸå®æ•°æ®æ›¿æ¢mockè¯¾ç¨‹æ•°æ®</li>
                <li>å…¶ä»–å†…å®¹ï¼ˆæŠ€èƒ½ã€çŸ¥è¯†ç‚¹ã€é¢è¯•é¢˜ç­‰ï¼‰ä»ä½¿ç”¨mockæ•°æ®</li>
                <li>å¢å¼ºäº†displayMockStepContentçš„coursesæ­¥éª¤å¤„ç†</li>
            </ul>
        </div>
        
        <div class="status info">
            ğŸ¯ <strong>é¢„æœŸæ•ˆæœ</strong>:
            <ul>
                <li>é¡µé¢åº”è¯¥æ­£å¸¸æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ï¼ˆæŠ€èƒ½ã€çŸ¥è¯†ç‚¹ã€æ€ç»´å¯¼å›¾ç­‰ï¼‰</li>
                <li>æ¨èè¯¾ç¨‹éƒ¨åˆ†åº”è¯¥æ˜¾ç¤ºçœŸå®æœç´¢çš„è¯¾ç¨‹æ•°æ®</li>
                <li>è¯¾ç¨‹åº”è¯¥æ¥è‡ªBç«™ã€Courseraã€æ…•è¯¾ç½‘ç­‰çœŸå®å¹³å°</li>
                <li>è¯¾ç¨‹åº”è¯¥æœ‰çœŸå®çš„è¯„åˆ†ã€å­¦ç”Ÿæ•°ã€ä»·æ ¼ç­‰ä¿¡æ¯</li>
            </ul>
        </div>
        
        <div class="status warning">
            âš ï¸ <strong>å¦‚æœä»æœ‰é—®é¢˜</strong>:
            <ul>
                <li>æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰"æˆåŠŸè·å–çœŸå®è¯¾ç¨‹æ•°æ®"çš„æ—¥å¿—</li>
                <li>æŸ¥çœ‹æ˜¯å¦æœ‰"æ£€æµ‹åˆ°çœŸå®è¯¾ç¨‹æ•°æ®ï¼Œä½¿ç”¨ä¸“ç”¨æ˜¾ç¤ºæ–¹æ³•"çš„æ—¥å¿—</li>
                <li>å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä¼šæ˜¾ç¤ºmockè¯¾ç¨‹æ•°æ®ä½œä¸ºå¤‡é€‰</li>
            </ul>
        </div>
        
        <button class="test-btn" onclick="openMainPage()">æ‰“å¼€æ­£å¼é¡µé¢æµ‹è¯•</button>
        <button class="test-btn" onclick="testAPI()">æµ‹è¯•APIæ•°æ®</button>
        <button class="test-btn" onclick="clearCache()">æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</button>
        
        <div id="results" style="margin-top: 20px; display: none;">
            <h3>æµ‹è¯•ç»“æœï¼š</h3>
            <div id="output"></div>
        </div>
    </div>

    <script>
        function openMainPage() {
            window.open('http://localhost:3000', '_blank');
        }

        async function testAPI() {
            const results = document.getElementById('results');
            const output = document.getElementById('output');
            results.style.display = 'block';
            
            output.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨æµ‹è¯•API...</div>';
            
            try {
                const response = await fetch('/api/generate-learning-plan-stream', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ topic: 'Pythonå·¥ç¨‹å¸ˆ' })
                });

                if (response.ok) {
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = '';
                    let foundCourses = false;
                    let courseCount = 0;
                    let courseDetails = [];
                    
                    while (true) {
                        const { value, done } = await reader.read();
                        if (done) break;
                        
                        buffer += decoder.decode(value, { stream: true });
                        const lines = buffer.split('\n');
                        buffer = lines.pop() || '';
                        
                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.slice(6));
                                    if (data.step === 'courses' && data.data) {
                                        foundCourses = true;
                                        courseCount = data.data.length;
                                        courseDetails = data.data.slice(0, 3); // å‰3é—¨è¯¾ç¨‹
                                        break;
                                    }
                                    if (data.result && data.result.courses) {
                                        foundCourses = true;
                                        courseCount = data.result.courses.length;
                                        courseDetails = data.result.courses.slice(0, 3);
                                        break;
                                    }
                                } catch (e) {
                                    // å¿½ç•¥è§£æé”™è¯¯
                                }
                            }
                        }
                        
                        if (foundCourses) break;
                    }
                    
                    if (foundCourses) {
                        let detailsHtml = courseDetails.map(course => 
                            `<li><strong>${course.title}</strong> (${course.platform}) - â­${course.rating} - ${course.students}äºº</li>`
                        ).join('');
                        
                        output.innerHTML = `
                            <div class="status success">âœ… APIæ­£å¸¸å·¥ä½œï¼è¿”å›äº† ${courseCount} é—¨è¯¾ç¨‹</div>
                            <div class="status info">ğŸ“‹ å‰3é—¨è¯¾ç¨‹é¢„è§ˆï¼š<ul>${detailsHtml}</ul></div>
                        `;
                    } else {
                        output.innerHTML = '<div class="status error">âŒ APIæ²¡æœ‰è¿”å›è¯¾ç¨‹æ•°æ®</div>';
                    }
                } else {
                    output.innerHTML = `<div class="status error">âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                output.innerHTML = `<div class="status error">âŒ APIè°ƒç”¨å¼‚å¸¸: ${error.message}</div>`;
            }
        }

        function clearCache() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                });
            }
            
            // æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    names.forEach(function(name) {
                        caches.delete(name);
                    });
                });
            }
            
            alert('æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤ï¼Œè¯·åˆ·æ–°é¡µé¢åæµ‹è¯•');
        }

        // é¡µé¢åŠ è½½æ—¶çš„è¯´æ˜
        window.addEventListener('load', () => {
            console.log('ğŸ”§ æ··åˆæ–¹æ¡ˆä¿®å¤éªŒè¯é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>