<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>å­¦ä¹ èµ„æ–™ç”Ÿæˆç»“æœ - èŒé€”åŠ©æ‰‹AIæ±‚èŒå¤§å¸ˆ</title>
    
    <!-- åŠ è½½æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- åŠ è½½ Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- APIé…ç½®ç›¸å…³å…¨å±€å‡½æ•° - åœ¨é¡µé¢è§£ææ—¶ç«‹å³å¯ç”¨ -->
    <script>
        // å…¨å±€APIé…ç½®å‡½æ•° - ç¡®ä¿ç«‹å³å¯ç”¨
        function openApiConfigModal() {
            console.log('ğŸš€ å…¨å±€å‡½æ•°: æ‰“å¼€APIé…ç½®æ¨¡æ€æ¡†');
            const apiConfigModal = document.getElementById('apiConfigModal');
            const apiKeyInput = document.getElementById('apiKey');
            const apiProviderSelect = document.getElementById('apiProvider');
            
            if (!apiConfigModal) {
                console.error('æ‰¾ä¸åˆ°APIé…ç½®æ¨¡æ€æ¡†');
                alert('APIé…ç½®æ¨¡æ€æ¡†æœªæ‰¾åˆ°ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                return;
            }
            
            // ä»localStorageåŠ è½½å·²ä¿å­˜çš„é…ç½®
            if (apiKeyInput) {
                const savedApiKey = localStorage.getItem('ai_learning_companion_api_key');
                apiKeyInput.value = savedApiKey || '';
            }
            
            if (apiProviderSelect) {
                const savedApiProvider = localStorage.getItem('apiProvider');
                apiProviderSelect.value = savedApiProvider || 'alibaba';
            }
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            apiConfigModal.style.display = 'block';
            apiConfigModal.classList.add('show');
            
            console.log('âœ… APIé…ç½®æ¨¡æ€æ¡†å·²æ˜¾ç¤º');
        }
        
        // å…¨å±€å…³é—­æ¨¡æ€æ¡†å‡½æ•°
        function closeApiConfigModal() {
            console.log('å…³é—­APIé…ç½®æ¨¡æ€æ¡†');
            const apiConfigModal = document.getElementById('apiConfigModal');
            if (apiConfigModal) {
                apiConfigModal.classList.remove('show');
                setTimeout(() => {
                    apiConfigModal.style.display = 'none';
                }, 300);
            }
        }
        
        // ç¡®ä¿å‡½æ•°ä¹Ÿåœ¨windowå¯¹è±¡ä¸Š
        window.openApiConfigModal = openApiConfigModal;
        window.closeApiConfigModal = closeApiConfigModal;
    </script>
    
    <!-- é¡µé¢ä¸“ç”¨æ ·å¼ -->
    <style>
        /* ç»“æœé¡µé¢ä¸“ç”¨æ ·å¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .results-container {
            display: flex;
            flex: 1;
            padding: 1rem;
            gap: 1rem;
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .results-header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .results-title {
            display: flex;
            align-items: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin: 0;
        }
        
        .results-title i {
            margin-right: 0.75rem;
            color: #6366f1;
        }
        
        .results-meta {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .generation-time {
            display: flex;
            align-items: center;
        }
        
        .generation-time i {
            margin-right: 0.5rem;
        }
        
        .results-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .result-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            font-size: 0.875rem;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            z-index: 100; /* æ·»åŠ z-indexç¡®ä¿æŒ‰é’®åœ¨æœ€ä¸Šå±‚ */
            position: relative; /* æ·»åŠ ç›¸å¯¹å®šä½ */
        }
        
        .result-action-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .result-action-btn i {
            margin-right: 0.5rem;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ - ä¸‰åˆ—å¸ƒå±€ */
        .content-layout {
            display: flex;
            flex: 1;
            gap: 1rem;
        }
        
        /* å·¦ä¾§ç›®å½•é¢æ¿ */
        .content-sidebar {
            width: 260px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #111827;
        }
        
        .mindmap-toggle-btn {
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            font-size: 0.75rem;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .mindmap-toggle-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .mindmap-toggle-btn i {
            margin-right: 0.5rem;
        }
        
        .sidebar-section {
            margin-bottom: 1rem;
        }
        
        .sidebar-section-title {
            padding: 0.75rem 1rem;
            margin: 0;
            font-size: 0.875rem;
            font-weight: 600;
            color: #111827;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .content-nav-list, .skill-nav-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-item:hover {
            background: #f9fafb;
            color: #6366f1;
        }
        
        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #6366f1;
            font-weight: 500;
        }
        
        .nav-item i {
            margin-right: 0.75rem;
            width: 16px;
            text-align: center;
        }
        
        .item-count {
            margin-left: 0.5rem;
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .nav-arrow {
            margin-left: auto;
            font-size: 0.75rem;
            transition: transform 0.3s ease;
        }
        
        .nav-item.expanded .nav-arrow {
            transform: rotate(90deg);
        }
        
        /* ä¸­é—´å†…å®¹åŒºåŸŸ */
        .content-main {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .content-section {
            display: none;
            flex: 1;
            flex-direction: column;
        }
        
        .content-section.active {
            display: flex;
        }
        
        .section-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            display: flex;
            align-items: center;
        }
        
        .section-header h2 i {
            margin-right: 0.75rem;
            color: #6366f1;
        }
        
        .section-count {
            margin-left: 0.5rem;
            font-size: 0.875rem;
            font-weight: 400;
            color: #6b7280;
        }
        
        .expand-all-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            font-size: 0.75rem;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .expand-all-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }
        
        .expand-all-btn i {
            margin-right: 0.5rem;
        }
        
        .section-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        /* æ€ç»´å¯¼å›¾ */
        .mindmap-card {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .mindmap-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            display: flex;
            gap: 0.5rem;
        }
        
        .mindmap-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mindmap-btn:hover {
            background: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mindmap-content {
            flex: 1;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            min-height: 600px;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* å³ä¾§AIåŠ©æ‰‹ */
        .ai-assistant {
            width: 380px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .assistant-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #6366f1;
            color: white;
        }
        
        .assistant-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .assistant-title i {
            margin-right: 0.75rem;
        }
        
        .assistant-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .assistant-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .assistant-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .assistant-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #f9fafb;
        }
        
        .welcome-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            padding: 2rem;
        }
        
        .assistant-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .welcome-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.5rem 0;
        }
        
        .welcome-text {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
            margin: 0;
        }
        
        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.75rem;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
            resize: none;
            transition: border-color 0.3s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
            align-self: flex-end;
        }
        
        .send-btn:hover {
            background: #4f46e5;
        }
        
        .send-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }
        
        /* èŠå¤©æ¶ˆæ¯æ ·å¼ */
        .message {
            display: flex;
            margin-bottom: 1rem;
            max-width: 90%;
        }
        
        .user-message {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        
        .assistant-message {
            margin-right: auto;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin: 0 0.75rem;
        }
        
        .message-content {
            background: #f3f4f6;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
            max-width: 80%;
        }
        
        .user-message .message-content {
            background: #6366f1;
            color: white;
        }
        
        .message-content p {
            margin: 0;
        }
        
        /* é¢è¯•é¢˜æ–°æ ·å¼ */
        .interview-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .interview-progress {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .interview-progress i {
            color: #4f46e5;
            margin-right: 0.5rem;
        }

        .interview-question {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }

        .interview-tags {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .interview-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .interview-tag.primary {
            background-color: #e9d5ff;
            color: #7e22ce;
        }

        .interview-tag.secondary {
            background-color: #dbeafe;
            color: #1d4ed8;
        }

        .interview-tag.tech {
            background-color: #e0f2fe;
            color: #0369a1;
        }

        .interview-answer-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            color: #4b5563;
            margin-bottom: 1.5rem;
            resize: none;
            min-height: 100px;
        }

        .interview-answer-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .interview-answer-input::placeholder {
            color: #9ca3af;
        }

        .interview-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: space-between;
        }

        .interview-btn {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .interview-btn i {
            margin-right: 0.5rem;
        }

        .interview-btn.primary {
            background-color: #4f46e5;
            color: white;
            border: none;
        }

        .interview-btn.primary:hover {
            background-color: #4338ca;
        }

        .interview-btn.secondary {
            background-color: white;
            color: #4b5563;
            border: 1px solid #e5e7eb;
        }

        .interview-btn.secondary:hover {
            background-color: #f9fafb;
            color: #111827;
        }

        .interview-btn.outline {
            background-color: white;
            color: #4f46e5;
            border: 1px solid #4f46e5;
        }

        .interview-btn.outline:hover {
            background-color: #f5f3ff;
        }

        .interview-refresh {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .interview-refresh:hover {
            background-color: #f3f4f6;
            color: #4f46e5;
        }

        .interview-ai-badge {
            display: flex;
            align-items: center;
            color: #4f46e5;
            font-weight: 500;
            font-size: 0.875rem;
            margin-left: auto;
        }

        .interview-ai-badge i {
            margin-right: 0.5rem;
        }

        /* é¢è¯•é¢˜åˆ—è¡¨æ ·å¼ */
        .content-subtitle {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin: 2rem 0 1rem 0;
        }

        .interview-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .interview-list-item {
            display: flex;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
        }

        .interview-list-item:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transform: translateX(5px);
            border-color: #d1d5db;
        }

        .interview-list-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #f3f4f6;
            color: #4b5563;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .interview-list-content {
            flex: 1;
        }

        .interview-list-title {
            font-size: 0.9375rem;
            font-weight: 500;
            color: #1f2937;
            margin: 0 0 0.5rem 0;
            line-height: 1.4;
        }

        .interview-list-tags {
            display: flex;
            gap: 0.5rem;
        }

        /* é€‚é…ç§»åŠ¨ç«¯ */
        @media (max-width: 640px) {
            .interview-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .interview-btn {
                width: 100%;
            }
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            z-index: 9999; /* ç¡®ä¿åœ¨æœ€é¡¶å±‚ */
        }

        .modal.show {
            display: block !important; /* å¼ºåˆ¶æ˜¾ç¤º */
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 10000;
        }
        
        .modal-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 95%;
            max-width: 500px;
            overflow: hidden;
            z-index: 10001;
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            display: flex;
            align-items: center;
        }
        
        .modal-header h3 i {
            margin-right: 0.75rem;
            color: #6366f1;
        }
        
        .modal-close {
            background: none;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
            color: #111827;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-description {
            margin: 0 0 1.5rem 0;
            font-size: 0.875rem;
            line-height: 1.5;
            color: #6b7280;
        }
        
        .input-group {
            margin-bottom: 1.5rem;
        }
        
        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .key-input-container {
            position: relative;
            display: flex;
        }
        
        .modal-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }
        
        .modal-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .toggle-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toggle-btn:hover {
            color: #111827;
        }
        
        .provider-select {
            margin-bottom: 1.5rem;
        }
        
        .provider-select label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .modal-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 0.875rem;
            background-color: white;
        }
        
        .modal-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .provider-info {
            display: flex;
            background: #f9fafb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .provider-logo {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .provider-details {
            flex: 1;
        }
        
        .provider-details h4 {
            margin: 0 0 0.25rem 0;
            font-size: 0.875rem;
            font-weight: 600;
            color: #111827;
        }
        
        .provider-details p {
            margin: 0 0 0.5rem 0;
            font-size: 0.75rem;
            line-height: 1.4;
            color: #6b7280;
        }
        
        .provider-link {
            font-size: 0.75rem;
            color: #6366f1;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        
        .provider-link:hover {
            text-decoration: underline;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        .modal-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn-cancel {
            background: white;
            border: 1px solid #d1d5db;
            color: #6b7280;
        }
        
        .modal-btn-cancel:hover {
            border-color: #9ca3af;
            color: #111827;
        }
        
        .modal-btn-confirm {
            background: #6366f1;
            border: 1px solid #6366f1;
            color: white;
        }
        
        .modal-btn-confirm:hover {
            background: #4f46e5;
            border-color: #4f46e5;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            .ai-assistant {
                width: 320px;
            }
        }
        
        @media (max-width: 1200px) {
            .results-container {
                flex-direction: column;
            }
            
            .content-layout {
                flex-direction: column;
            }
            
            .content-sidebar, .ai-assistant {
                width: 100%;
            }
            
            .mindmap-content {
                min-height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .results-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
    
    <!-- Markmapåº“å’Œæ ·å¼ -->
    <script>
        // åŠ è½½Markmapåº“
        document.addEventListener('DOMContentLoaded', function() {
            // é¦–å…ˆåŠ è½½d3åº“ï¼Œç„¶åå†åŠ è½½markmap
            function loadScript(url) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = url;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
            
            // æŒ‰é¡ºåºåŠ è½½è„šæœ¬
            loadScript('https://cdn.jsdelivr.net/npm/d3@7')
                .then(() => {
                    console.log('d3 loaded');
                    return loadScript('https://cdn.jsdelivr.net/npm/markmap-view@0.14.3');
                })
                .then(() => {
                    console.log('markmap-view loaded');
                    return loadScript('https://cdn.jsdelivr.net/npm/markmap-toolbar@0.14.3/dist/index.min.js');
                })
                .then(() => {
                    console.log('Markmap libraries loaded');
                    // ç¡®ä¿æ‰€æœ‰åº“éƒ½åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
                    if (typeof window.markmap !== 'undefined' && typeof window.d3 !== 'undefined') {
                        setTimeout(initializeMarkmap, 500); // å»¶è¿Ÿåˆå§‹åŒ–ç¡®ä¿åº“åŠ è½½å®Œæˆ
                    } else {
                        console.error('Markmap libraries not loaded properly');
                        showMarkmapFallback();
                    }
                })
                .catch(error => {
                    console.error('Failed to load Markmap libraries:', error);
                    showMarkmapFallback();
                });
                
            // åŠ è½½CSS
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/markmap-toolbar@0.14.3/dist/style.css';
            document.head.appendChild(link);
        });
        
        function initializeMarkmap() {
            // æ£€æŸ¥å¿…è¦çš„åº“æ˜¯å¦å·²åŠ è½½
            if (typeof window.d3 === 'undefined') {
                console.error('d3 library not loaded');
                showMarkmapFallback();
                return;
            }
            
            if (typeof window.markmap === 'undefined') {
                console.error('markmap library not loaded');
                showMarkmapFallback();
                return;
            }
            
            try {
                // ç¤ºä¾‹æ€ç»´å¯¼å›¾å†…å®¹
                const markdown = `# åç«¯å·¥ç¨‹å¸ˆ

## ç¼–ç¨‹è¯­è¨€
- ### Java
  - é¢å‘å¯¹è±¡ç¼–ç¨‹
  - é›†åˆæ¡†æ¶
  - å¤šçº¿ç¨‹ç¼–ç¨‹
  - JVMè°ƒä¼˜
- ### Python
  - åŸºç¡€è¯­æ³•
  - æ•°æ®ç»“æ„
  - æ¡†æ¶åº”ç”¨
- ### Go
  - å¹¶å‘æ¨¡å‹
  - å†…å­˜ç®¡ç†

## æ¡†æ¶
- ### Springç”Ÿæ€
  - Spring Framework
  - Spring Boot
  - Spring Cloud
- ### æ•°æ®åº“æ¡†æ¶
  - MyBatis
  - Hibernate

## æ•°æ®åº“
- ### å…³ç³»å‹æ•°æ®åº“
  - MySQL
  - PostgreSQL
- ### NoSQL
  - Redis
  - MongoDB
  - Elasticsearch

## ä¸­é—´ä»¶
- ### æ¶ˆæ¯é˜Ÿåˆ—
  - Kafka
  - RabbitMQ
- ### åˆ†å¸ƒå¼åè°ƒ
  - Zookeeper
  - etcd

## æ¶æ„è®¾è®¡
- ### å¾®æœåŠ¡
  - æœåŠ¡å‘ç°
  - é…ç½®ä¸­å¿ƒ
  - APIç½‘å…³
- ### åˆ†å¸ƒå¼ç³»ç»Ÿ
  - CAPç†è®º
  - ä¸€è‡´æ€§ç®—æ³•

## DevOps
- ### å®¹å™¨åŒ–
  - Docker
  - Kubernetes
- ### CI/CD
  - Jenkins
  - GitLab CI
`;
                
                // åˆå§‹åŒ–æ€ç»´å¯¼å›¾
                const mindmapElement = document.getElementById('mindmapContent');
                if (mindmapElement) {
                    // æ¸…ç©ºå…ƒç´ å†…å®¹
                    mindmapElement.innerHTML = '';
                    
                    // åˆ›å»ºSVGå…ƒç´ 
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('width', '100%');
                    svg.setAttribute('height', '600');
                    mindmapElement.appendChild(svg);
                    
                    // æ£€æŸ¥Markmapæ„é€ å‡½æ•°æ˜¯å¦å­˜åœ¨
                    if (window.markmap.Markmap) {
                        // åˆ›å»ºè½¬æ¢å™¨
                        const transformer = new window.markmap.Transformer();
                        
                        // è½¬æ¢markdown
                        const { root } = transformer.transform(markdown);
                        
                        // åˆ›å»ºMarkmapå®ä¾‹
                        const markmapInstance = window.markmap.Markmap.create(svg, null, root);
                        
                        // ä¸ºæ§åˆ¶æŒ‰é’®æ·»åŠ äº‹ä»¶
                        const expandAllBtn = document.getElementById('expandAll');
                        if (expandAllBtn) {
                            expandAllBtn.addEventListener('click', () => {
                                markmapInstance.expandAll();
                            });
                        }
                        
                        const collapseAllBtn = document.getElementById('collapseAll');
                        if (collapseAllBtn) {
                            collapseAllBtn.addEventListener('click', () => {
                                markmapInstance.collapseAll();
                            });
                        }
                        
                        const downloadMindmapBtn = document.getElementById('downloadMindmap');
                        if (downloadMindmapBtn) {
                            downloadMindmapBtn.addEventListener('click', () => {
                                alert('ä¸‹è½½åŠŸèƒ½å°†åœ¨å®Œæ•´ç‰ˆä¸­æä¾›');
                            });
                        }
                    } else {
                        console.error('Markmap constructor not found');
                        showMarkmapFallback();
                    }
                } else {
                    console.error('Mindmap element not found');
                    showMarkmapFallback();
                }
            } catch (error) {
                console.error('Error initializing markmap:', error);
                showMarkmapFallback();
            }
        }
        
        function showMarkmapFallback() {
            const mindmapElement = document.getElementById('mindmapContent');
            if (mindmapElement) {
                mindmapElement.innerHTML = `
                    <div class="welcome-message">
                        <div class="assistant-avatar">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="welcome-title">æ— æ³•åŠ è½½æ€ç»´å¯¼å›¾</h3>
                        <p class="welcome-text">æ€ç»´å¯¼å›¾åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•ã€‚</p>
                    </div>
                `;
            }
        }
    </script>
</head>
<body>
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <header class="results-header">
        <h1 class="results-title">
            <i class="fas fa-graduation-cap"></i>
            <span id="jobTitleDisplay">åç«¯å·¥ç¨‹å¸ˆ</span>
        </h1>
        
        <div class="results-meta">
            <div class="generation-time">
                <i class="fas fa-clock"></i>
                <span id="generationTimeDisplay">2025/08/17 16:20:14</span>
            </div>
        </div>
        
        <div class="results-actions">
<button class="result-action-btn" id="configApiBtn" onclick="openApiConfigModal(); console.log('ğŸ› ï¸ å†…è”äº‹ä»¶è¢«è§¦å‘');">
    <i class="fas fa-cog"></i>
    é…ç½®APIå¯†é’¥
</button>
            <button class="result-action-btn" id="saveBtn">
                <i class="fas fa-save"></i>
                ä¿å­˜
            </button>
            <button class="result-action-btn" id="exportPdfBtn">
                <i class="fas fa-file-pdf"></i>
                å¯¼å‡ºPDF
            </button>
            <button class="result-action-btn" id="exportFeishuBtn">
                <i class="fas fa-file-alt"></i>
                å¯¼å‡ºé£ä¹¦æ–‡æ¡£
            </button>
        </div>
    </header>
    
    <!-- ä¸»è¦å†…å®¹å®¹å™¨ -->
    <div class="results-container">
        <!-- ä¸‰åˆ—å¸ƒå±€ -->
        <div class="content-layout">
            <!-- å·¦ä¾§ç›®å½• -->
            <aside class="content-sidebar">
                <div class="sidebar-header">
                    <h3>ç›®å½•</h3>
                    <button class="mindmap-toggle-btn" id="mindmapToggleBtn">
                        <i class="fas fa-project-diagram"></i>
                        æ€ç»´å¯¼å›¾
                    </button>
                </div>
                
                <!-- ä¸»å†…å®¹ç›®å½• -->
                <div class="sidebar-section">
                    <h4 class="sidebar-section-title" id="sidebarJobTitle">åç«¯å·¥ç¨‹å¸ˆ</h4>
                    <ul class="content-nav-list">
                        <li class="nav-item active" data-target="mindmap">
                            <i class="fas fa-project-diagram"></i>
                            <span>æ€ç»´å¯¼å›¾</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="knowledge">
                            <i class="fas fa-lightbulb"></i>
                            <span>çŸ¥è¯†ç‚¹</span>
                            <span class="item-count" id="knowledgeCount">(20)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="interview">
                            <i class="fas fa-question-circle"></i>
                            <span>é«˜é¢‘é¢è¯•é¢˜</span>
                            <span class="item-count" id="interviewCount">(15)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="books">
                            <i class="fas fa-book"></i>
                            <span>æ¨èä¹¦ç±</span>
                            <span class="item-count" id="booksCount">(8)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="certificates">
                            <i class="fas fa-certificate"></i>
                            <span>è¯ä¹¦</span>
                            <span class="item-count" id="certificatesCount">(5)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                        <li class="nav-item" data-target="courses">
                            <i class="fas fa-graduation-cap"></i>
                            <span>æ¨èè¯¾ç¨‹</span>
                            <span class="item-count" id="coursesCount">(12)</span>
                            <i class="fas fa-chevron-right nav-arrow"></i>
                        </li>
                    </ul>
                </div>
                
                <!-- æŠ€èƒ½åˆ†ç±»ç›®å½• -->
                <div class="sidebar-section">
                    <h4 class="sidebar-section-title">æŠ€èƒ½åˆ†ç±»</h4>
                    <ul class="skill-nav-list" id="skillNavList">
                        <!-- æŠ€èƒ½åˆ†ç±»å°†åŠ¨æ€ç”Ÿæˆ -->
                        <li class="nav-item">
                            <i class="fas fa-code"></i>
                            <span>ç¼–ç¨‹è¯­è¨€</span>
                            <span class="item-count">(3)</span>
                        </li>
                        <li class="nav-item">
                            <i class="fas fa-server"></i>
                            <span>æ¡†æ¶</span>
                            <span class="item-count">(2)</span>
                        </li>
                        <li class="nav-item">
                            <i class="fas fa-database"></i>
                            <span>æ•°æ®åº“</span>
                            <span class="item-count">(2)</span>
                        </li>
                    </ul>
                </div>
            </aside>

            <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
            <main class="content-main">
                <!-- æ€ç»´å¯¼å›¾é»˜è®¤æ˜¾ç¤º -->
                <div class="content-section active" id="mindmapSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-project-diagram"></i>
                            æ€ç»´å¯¼å›¾
                        </h2>
                        <div>
                            <button class="expand-all-btn" id="expandAll">
                                <i class="fas fa-expand-arrows-alt"></i>
                                å±•å¼€å…¨éƒ¨
                            </button>
                            <button class="expand-all-btn" id="collapseAll">
                                <i class="fas fa-compress-arrows-alt"></i>
                                æŠ˜å å…¨éƒ¨
                            </button>
                            <button class="expand-all-btn" id="downloadMindmap">
                                <i class="fas fa-download"></i>
                                ä¸‹è½½æ€ç»´å¯¼å›¾
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="mindmap-card">
                            <div class="mindmap-content" id="mindmapContent">
                                <!-- æ€ç»´å¯¼å›¾å†…å®¹å°†åŠ¨æ€åŠ è½½ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- çŸ¥è¯†ç‚¹å†…å®¹ -->
                <div class="content-section" id="knowledgeSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-lightbulb"></i>
                            çŸ¥è¯†ç‚¹
                            <span class="section-count">(20)</span>
                        </h2>
                    </div>
                    <div class="section-content">
                        <div class="knowledge-list">
                            <div class="knowledge-item">
                                <div class="knowledge-number">1</div>
                                <div class="knowledge-text">ç†Ÿç»ƒæŒæ¡Javaã€Pythonã€Goç­‰åç«¯ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ï¼Œå¹¶äº†è§£å…¶ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚</div>
                            </div>
                            <div class="knowledge-item">
                                <div class="knowledge-number">2</div>
                                <div class="knowledge-text">ç†è§£é¢å‘å¯¹è±¡ç¼–ç¨‹åŸåˆ™ï¼ŒåŒ…æ‹¬å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µã€‚</div>
                            </div>
                            <div class="knowledge-item">
                                <div class="knowledge-number">3</div>
                                <div class="knowledge-text">æ·±å…¥ç†è§£å¤šçº¿ç¨‹ç¼–ç¨‹å’Œå¹¶å‘æ§åˆ¶ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ± ã€é”æœºåˆ¶å’Œå¹¶å‘é›†åˆç­‰ã€‚</div>
                            </div>
                            <!-- æ›´å¤šçŸ¥è¯†ç‚¹çœç•¥... -->
                        </div>
                    </div>
                </div>
                
                <!-- é¢è¯•é¢˜å†…å®¹ -->
                <div class="content-section" id="interviewSection">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-question-circle"></i>
                            é«˜é¢‘é¢è¯•é¢˜
                            <span class="section-count">(15)</span>
                        </h2>
                    </div>
                    <div class="section-content">
                        <!-- é¢è¯•é¢˜å¡ç‰‡ -->
                        <div class="interview-card">
                            <div class="interview-progress">
                                <i class="fas fa-list-ol"></i>
                                ç¬¬ 1 é¢˜ / å…± 50 é¢˜
                            </div>
                            <button class="interview-refresh" id="refreshQuestion">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <h3 class="interview-question">è§£é‡ŠJavaScriptä¸­çš„é—­åŒ…æ¦‚å¿µï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜å…¶åº”ç”¨åœºæ™¯</h3>
                            <div class="interview-tags">
                                <span class="interview-tag primary">ä¸­ç­‰</span>
                                <span class="interview-tag tech">JavaScript</span>
                                <span class="interview-tag secondary">å‰ç«¯å¼€å‘</span>
                            </div>
                            <textarea class="interview-answer-input" placeholder="è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆ..."></textarea>
                            <div class="interview-actions">
                                <button class="interview-btn secondary">
                                    <i class="fas fa-eye"></i>
                                    æŸ¥çœ‹ç­”æ¡ˆ
                                </button>
                                <button class="interview-btn primary">
                                    <i class="fas fa-check"></i>
                                    æˆ‘ä¼šäº†
                                </button>
                                <button class="interview-btn outline">
                                    <i class="fas fa-arrow-right"></i>
                                    è®°ä¸€ä¸‹
                                </button>
                            </div>
                        </div>
                        
                        <!-- é¢è¯•é¢˜åˆ—è¡¨ -->
                        <h4 class="content-subtitle">æ›´å¤šé«˜é¢‘é¢è¯•é¢˜</h4>
                        <div class="interview-list">
                            <div class="interview-list-item">
                                <div class="interview-list-number">2</div>
                                <div class="interview-list-content">
                                    <h5 class="interview-list-title">Reactä¸­çš„è™šæ‹ŸDOMæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h5>
                                    <div class="interview-list-tags">
                                        <span class="interview-tag tech">React</span>
                                        <span class="interview-tag primary">ä¸­ç­‰</span>
                                    </div>
                                </div>
                            </div>
                            <div class="interview-list-item">
                                <div class="interview-list-number">3</div>
                                <div class="interview-list-content">
                                    <h5 class="interview-list-title">è¯·æè¿°æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹</h5>
                                    <div class="interview-list-tags">
                                        <span class="interview-tag tech">æµè§ˆå™¨</span>
                                        <span class="interview-tag primary">ä¸­ç­‰</span>
                                    </div>
                                </div>
                            </div>
                            <div class="interview-list-item">
                                <div class="interview-list-number">4</div>
                                <div class="interview-list-content">
                                    <h5 class="interview-list-title">CSSé€‰æ‹©å™¨çš„ä¼˜å…ˆçº§æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</h5>
                                    <div class="interview-list-tags">
                                        <span class="interview-tag tech">CSS</span>
                                        <span class="interview-tag primary">ç®€å•</span>
                                    </div>
                                </div>
                            </div>
                            <div class="interview-list-item">
                                <div class="interview-list-number">5</div>
                                <div class="interview-list-content">
                                    <h5 class="interview-list-title">ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·ï¼Ÿå¦‚ä½•é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Ÿ</h5>
                                    <div class="interview-list-tags">
                                        <span class="interview-tag tech">JavaScript</span>
                                        <span class="interview-tag primary">ä¸­ç­‰</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- å³ä¾§AIåŠ©æ‰‹ -->
            <aside class="ai-assistant">
                <div class="assistant-header">
                    <h3 class="assistant-title">
                        <i class="fas fa-robot"></i>
                        AI æ™ºèƒ½åŠ©æ‰‹
                    </h3>
                    <div class="assistant-actions">
                        <button class="assistant-btn" title="æ¸…ç©ºèŠå¤©">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="assistant-btn" title="å¸®åŠ©">
                            <i class="fas fa-question"></i>
                        </button>
                    </div>
                </div>
                
                <div class="assistant-content">
                    <div class="chat-messages" id="chatMessages">
                        <!-- èŠå¤©æ¶ˆæ¯å°†åŠ¨æ€ç”Ÿæˆ -->
                        <div class="welcome-message">
                            <div class="assistant-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3 class="welcome-title">æ‚¨å¥½ï¼æˆ‘æ˜¯AIå­¦ä¹ åŠ©æ‰‹</h3>
                            <p class="welcome-text">æˆ‘å¯ä»¥å›ç­”æ‚¨å…³äºèŒä¸šå‘å±•ã€æŠ€èƒ½æå‡çš„é—®é¢˜ã€‚è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„é—®é¢˜ï¼</p>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."></textarea>
                        <button class="send-btn" id="sendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- é¡µé¢è„šæœ¬ -->
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            const jobTitleDisplay = document.getElementById('jobTitleDisplay');
            const sidebarJobTitle = document.getElementById('sidebarJobTitle');
            const generationTimeDisplay = document.getElementById('generationTimeDisplay');
            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981';
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç»‘å®šæ¨¡æ€æ¡†äº‹ä»¶
            setTimeout(function() {
                // ç»‘å®šå…³é—­æŒ‰é’®äº‹ä»¶
                const apiConfigClose = document.getElementById('apiConfigClose');
                const apiConfigCancel = document.getElementById('apiConfigCancel');
                const apiConfigModal = document.getElementById('apiConfigModal');
                const modalOverlay = apiConfigModal ? apiConfigModal.querySelector('.modal-overlay') : null;
                
                if (apiConfigClose) {
                    apiConfigClose.addEventListener('click', closeApiConfigModal);
                }
                
                if (apiConfigCancel) {
                    apiConfigCancel.addEventListener('click', closeApiConfigModal);
                }
                
                if (modalOverlay) {
                    modalOverlay.addEventListener('click', closeApiConfigModal);
                }
                
                // åˆ‡æ¢API Keyæ˜¾ç¤º/éšè—
                const toggleApiKey = document.getElementById('toggleApiKey');
                const apiKeyInput = document.getElementById('apiKey');
                
                if (toggleApiKey && apiKeyInput) {
                    toggleApiKey.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ğŸ‘ï¸ åˆ‡æ¢å¯†é’¥æ˜¾ç¤º/éšè—');
                        
                        if (apiKeyInput.type === 'password') {
                            apiKeyInput.type = 'text';
                            toggleApiKey.innerHTML = '<i class="fas fa-eye-slash"></i>';
                            console.log('âœ… å¯†é’¥å·²æ˜¾ç¤º');
                        } else {
                            apiKeyInput.type = 'password';
                            toggleApiKey.innerHTML = '<i class="fas fa-eye"></i>';
                            console.log('âœ… å¯†é’¥å·²éšè—');
                        }
                    });
                }
                
                // å¤„ç†å‚å•†åˆ‡æ¢
                const apiProviderSelect = document.getElementById('apiProvider');
                if (apiProviderSelect) {
                    // åˆå§‹åŒ–æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„å‚å•†ä¿¡æ¯
                    updateProviderInfo(apiProviderSelect.value);
                    
                    apiProviderSelect.addEventListener('change', function() {
                        console.log('ğŸ”„ å‚å•†åˆ‡æ¢ä¸º:', this.value);
                        updateProviderInfo(this.value);
                    });
                }
                
                // æ›´æ–°å‚å•†ä¿¡æ¯æ˜¾ç¤º
                function updateProviderInfo(provider) {
                    const providerInfo = document.querySelector('.provider-info');
                    if (!providerInfo) return;
                    
                    const logo = providerInfo.querySelector('.provider-logo i');
                    const title = providerInfo.querySelector('.provider-details h4');
                    const description = providerInfo.querySelector('.provider-details p');
                    const link = providerInfo.querySelector('.provider-link');
                    
                    switch(provider) {
                        case 'alibaba':
                            if (logo) {
                                logo.className = 'fas fa-cloud';
                                logo.style.color = '#ff6a00';
                            }
                            if (title) title.textContent = 'é˜¿é‡Œäº‘ DashScope';
                            if (description) description.textContent = 'ä½¿ç”¨é€šä¹‰å¤§æ¨¡å‹ç³»åˆ—ï¼ŒåŒ…æ‹¬æ¨¡å‹é€šä¹‰åƒé—®2.0ç­‰';
                            if (link) {
                                link.href = 'https://dashscope.aliyun.com/';
                                link.textContent = 'è·å–å¯†é’¥';
                            }
                            break;
                        case 'openai':
                            if (logo) {
                                logo.className = 'fas fa-brain';
                                logo.style.color = '#10a37f';
                            }
                            if (title) title.textContent = 'OpenAI';
                            if (description) description.textContent = 'ä½¿ç”¨GPT-4ã€GPT-3.5ç­‰å…ˆè¿›çš„è¯­è¨€æ¨¡å‹';
                            if (link) {
                                link.href = 'https://platform.openai.com/api-keys';
                                link.textContent = 'è·å–å¯†é’¥';
                            }
                            break;
                        case 'anthropic':
                            if (logo) {
                                logo.className = 'fas fa-robot';
                                logo.style.color = '#d97700';
                            }
                            if (title) title.textContent = 'Anthropic Claude';
                            if (description) description.textContent = 'ä½¿ç”¨Claude 3.5 Sonnetç­‰å…ˆè¿›çš„AIæ¨¡å‹';
                            if (link) {
                                link.href = 'https://console.anthropic.com/';
                                link.textContent = 'è·å–å¯†é’¥';
                            }
                            break;
                    }
                }
                
                // ä¿å­˜APIé…ç½®
                const apiConfigConfirm = document.getElementById('apiConfigConfirm');
                const apiProviderSelect = document.getElementById('apiProvider');
                
                if (apiConfigConfirm) {
                    apiConfigConfirm.addEventListener('click', function() {
                        const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                        const apiProvider = apiProviderSelect ? apiProviderSelect.value : 'alibaba';
                        
                        if (!apiKey) {
                            alert('è¯·è¾“å…¥APIå¯†é’¥');
                            return;
                        }
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('ai_learning_companion_api_key', apiKey);
                        localStorage.setItem('apiProvider', apiProvider);
                        
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        const configApiBtn = document.getElementById('configApiBtn');
                        if (configApiBtn) {
                            configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                            configApiBtn.style.color = '#10b981';
                            configApiBtn.style.borderColor = '#10b981';
                        }
                        
                        // å…³é—­æ¨¡æ€æ¡†
                        closeApiConfigModal();
                        
                        alert('APIé…ç½®å·²ä¿å­˜');
                    });
                }
            }, 100);
            
            // è·å–URLå‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const jobTitle = urlParams.get('job') || localStorage.getItem('currentJob') || 'åç«¯å·¥ç¨‹å¸ˆ';
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${jobTitle} å­¦ä¹ èµ„æ–™ - èŒé€”åŠ©æ‰‹AIæ±‚èŒå¤§å¸ˆ`;
            
            // æ›´æ–°èŒä½æ ‡é¢˜
            if (jobTitleDisplay) jobTitleDisplay.textContent = jobTitle;
            if (sidebarJobTitle) sidebarJobTitle.textContent = jobTitle;
            
            // æ›´æ–°ç”Ÿæˆæ—¶é—´
            if (generationTimeDisplay) {
                const now = new Date();
                generationTimeDisplay.textContent = `${now.getFullYear()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            }
            
            // å¤„ç†å¯¼èˆªé¡¹ç‚¹å‡»
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    if (!targetId) return;
                    
                    // æ›´æ–°å¯¼èˆªé¡¹çŠ¶æ€
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°å†…å®¹åŒºåŸŸæ˜¾ç¤º
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === `${targetId}Section`) {
                            section.classList.add('active');
                        }
                    });
                });
            });
            
            // å¤„ç†å¯¼å‡ºPDFæŒ‰é’®
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', function() {
                    alert('å¯¼å‡ºPDFåŠŸèƒ½å°†åœ¨å®Œæ•´ç‰ˆä¸­æä¾›');
                });
            }
            
            // å¤„ç†å¯¼å‡ºé£ä¹¦æŒ‰é’®
            const exportFeishuBtn = document.getElementById('exportFeishuBtn');
            if (exportFeishuBtn) {
                exportFeishuBtn.addEventListener('click', function() {
                    alert('å¯¼å‡ºé£ä¹¦æ–‡æ¡£åŠŸèƒ½å°†åœ¨å®Œæ•´ç‰ˆä¸­æä¾›');
                });
            }
            
            // å¤„ç†ä¿å­˜æŒ‰é’®
            const saveBtn = document.getElementById('saveBtn');
            if (saveBtn) {
                saveBtn.addEventListener('click', function() {
                    alert('å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                });
            }
            
            // å¤„ç†æ€ç»´å¯¼å›¾åˆ‡æ¢
            const mindmapToggleBtn = document.getElementById('mindmapToggleBtn');
            if (mindmapToggleBtn) {
                mindmapToggleBtn.addEventListener('click', function() {
                    navItems.forEach(nav => nav.classList.remove('active'));
                    document.querySelector('.nav-item[data-target="mindmap"]').classList.add('active');
                    
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === 'mindmapSection') {
                            section.classList.add('active');
                        }
                    });
                });
            }
            
            // å¤„ç†é¢è¯•é¢˜å±•å¼€
            const expandAllInterviewBtn = document.getElementById('expandAllInterview');
            if (expandAllInterviewBtn) {
                expandAllInterviewBtn.addEventListener('click', function() {
                    alert('å±•å¼€æ‰€æœ‰é¢è¯•é¢˜åŠŸèƒ½å°†åœ¨å®Œæ•´ç‰ˆä¸­æä¾›');
                });
            }
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            function addUserMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;
                
                // ç§»é™¤æ¬¢è¿æ¶ˆæ¯
                const welcomeMessage = chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message';
                messageElement.innerHTML = `
                    <div class="message-content">
                        <p>${message}</p>
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯
            function addAssistantMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message assistant-message';
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <p>${message}</p>
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // æ·»åŠ æµå¼åŠ©æ‰‹æ¶ˆæ¯å®¹å™¨
            function addAssistantMessageStreaming() {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return null;
                
                // ç§»é™¤æ¬¢è¿æ¶ˆæ¯
                const welcomeMessage = chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message assistant-message';
                messageElement.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content streaming">
                        <p>ğŸ¤” æ­£åœ¨æ€è€ƒä¸­...</p>
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return messageElement.querySelector('.message-content');
            }
            
            // æ›´æ–°æµå¼æ¶ˆæ¯å†…å®¹
            function updateStreamingMessage(contentElement, content) {
                if (contentElement) {
                    contentElement.innerHTML = `<p>${content}</p>`;
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                }
            }
            
            // è·å–å­˜å‚¨çš„APIå¯†é’¥
            function getStoredApiKey() {
                return localStorage.getItem('ai_learning_companion_api_key') || '';
            }
            
            // è°ƒç”¨æµå¼DashScope API
            async function callDashScopeAPIStream(message, onContent) {
                console.log('ğŸš€ è°ƒç”¨æµå¼ç™¾ç‚¼ API...');
                
                // è·å–APIå¯†é’¥
                const apiKey = getStoredApiKey();
                if (!apiKey) {
                    throw new Error('è¯·å…ˆé…ç½®APIå¯†é’¥');
                }
                
                // æ„å»ºå¯¹è¯å†å²ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥ä»localStorageè·å–å†å²è®°å½•ï¼‰
                const messages = [
                    {
                        role: 'system',
                        content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„èŒä¸šå‘å±•é¡¾é—®ï¼Œæ“…é•¿æä¾›æŠ€èƒ½å­¦ä¹ ã€èŒä¸šè§„åˆ’ã€é¢è¯•æŒ‡å¯¼ç­‰å»ºè®®ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œè¯­è¨€å‹å¥½ã€ä¸“ä¸šã€‚'
                    },
                    {
                        role: 'user',
                        content: message
                    }
                ];
                
                // ä½¿ç”¨æµå¼èŠå¤©æ¥å£
                return new Promise((resolve, reject) => {
                    // å‘é€POSTè¯·æ±‚æ•°æ®
                    fetch('/api/chat-stream-init', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            messages: messages,
                            apiKey: apiKey
                        })
                    }).then(response => {
                        if (!response.ok) {
                            throw new Error(`åˆå§‹åŒ–æµå¼APIå¤±è´¥: ${response.status}`);
                        }
                        return response.json();
                    }).then(data => {
                        const sessionId = data.sessionId;
                        
                        // ä½¿ç”¨EventSourceå¤„ç†SSE
                        const eventSource = new EventSource(`/api/chat-stream/${sessionId}`);
                        
                        console.log('ğŸŒŠ å»ºç«‹SSEè¿æ¥:', sessionId);
                        
                        let hasReceivedFirstMessage = false;
                        let connectionStartTime = Date.now();
                        let streamContent = '';
                        
                        // è®¾ç½®è¿æ¥è¶…æ—¶æ£€æŸ¥
                        const connectionTimeout = setTimeout(() => {
                            if (!hasReceivedFirstMessage) {
                                onContent('â³ AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨ç­‰...');
                            }
                        }, 2000); // 2ç§’åæ˜¾ç¤ºæ€è€ƒä¸­
                        
                        eventSource.onopen = () => {
                            console.log('âœ… EventSourceè¿æ¥å·²å»ºç«‹');
                        };
                        
                        eventSource.addEventListener('message', (event) => {
                            try {
                                console.log('ğŸ“¨ æ”¶åˆ°messageäº‹ä»¶:', event.data);
                                const data = JSON.parse(event.data);
                                
                                if (data.content) {
                                    if (!hasReceivedFirstMessage) {
                                        hasReceivedFirstMessage = true;
                                        clearTimeout(connectionTimeout);
                                        streamContent = '';
                                        console.log('ğŸ† å¼€å§‹æ¥æ”¶æµå¼å†…å®¹');
                                    }
                                    
                                    console.log('ğŸ’¬ æµå¼æ¶ˆæ¯:', data.content);
                                    streamContent += data.content;
                                    onContent(streamContent);
                                }
                            } catch (parseError) {
                                console.warn('âš ï¸ è§£æmessageäº‹ä»¶å¤±è´¥:', parseError.message);
                            }
                        });
                        
                        eventSource.addEventListener('done', (event) => {
                            console.log('âœ… æµå¼å¯¹è¯å®Œæˆ:', event.data);
                            clearTimeout(connectionTimeout);
                            eventSource.close();
                            resolve();
                        });
                        
                        eventSource.addEventListener('error', (event) => {
                            try {
                                const data = JSON.parse(event.data);
                                console.error('âŒ æµå¼é”™è¯¯:', data.error);
                                clearTimeout(connectionTimeout);
                                eventSource.close();
                                reject(new Error(data.error));
                            } catch (e) {
                                console.error('âŒ æµå¼é”™è¯¯äº‹ä»¶:', event);
                                clearTimeout(connectionTimeout);
                                eventSource.close();
                                reject(new Error('æµå¼è¿æ¥é”™è¯¯'));
                            }
                        });
                        
                        eventSource.onerror = (error) => {
                            console.error('âŒ EventSourceè¿æ¥é”™è¯¯:', error);
                            clearTimeout(connectionTimeout);
                            eventSource.close();
                            reject(new Error('EventSourceè¿æ¥å¤±è´¥'));
                        };
                        
                    }).catch(error => {
                        console.error('âŒ åˆå§‹åŒ–æµå¼APIå¤±è´¥:', error);
                        reject(error);
                    });
                });
            }
            
            // å¤„ç†AIåŠ©æ‰‹å‘é€æŒ‰é’®
            if (sendBtn && chatInput) {
                sendBtn.addEventListener('click', async function() {
                    const message = chatInput.value.trim();
                    if (message) {
                        addUserMessage(message);
                        chatInput.value = '';
                        
                        // åˆ›å»ºæµå¼æ¶ˆæ¯å®¹å™¨
                        const aiMessageContent = addAssistantMessageStreaming();
                        
                        try {
                            // è°ƒç”¨æµå¼API
                            await callDashScopeAPIStream(message, (content) => {
                                updateStreamingMessage(aiMessageContent, content);
                            });
                            
                            // ç§»é™¤streamingç±»
                            if (aiMessageContent) {
                                aiMessageContent.classList.remove('streaming');
                            }
                        } catch (error) {
                            console.error('âŒ èŠå¤©APIè°ƒç”¨å¤±è´¥:', error);
                            if (aiMessageContent) {
                                aiMessageContent.innerHTML = '<p>âš ï¸ æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚è¯·æ£€æŸ¥APIé…ç½®æˆ–ç¨åå†è¯•ã€‚</p>';
                                aiMessageContent.classList.remove('streaming');
                            }
                        }
                    }
                });
                
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendBtn.click();
                    }
                });
            }
            
            // å¤„ç†é¢è¯•é¢˜äº¤äº’
            function initInterviewQuestions() {
                // è·å–é¢è¯•é¢˜å…ƒç´ 
                const interviewListItems = document.querySelectorAll('.interview-list-item');
                const refreshQuestionBtn = document.getElementById('refreshQuestion');
                const interviewAnswerInput = document.querySelector('.interview-answer-input');
                const checkAnswerBtn = document.querySelector('.interview-btn.secondary');
                const learnedBtn = document.querySelector('.interview-btn.primary');
                const noteBtn = document.querySelector('.interview-btn.outline');
                
                // åˆ‡æ¢é¢è¯•é¢˜
                if (interviewListItems) {
                    interviewListItems.forEach(item => {
                        item.addEventListener('click', function() {
                            // è·å–é¢˜ç›®æ ‡é¢˜å’Œæ ‡ç­¾
                            const title = this.querySelector('.interview-list-title').textContent;
                            const tags = this.querySelectorAll('.interview-tag');
                            const number = this.querySelector('.interview-list-number').textContent;
                            
                            // æ›´æ–°å½“å‰æ˜¾ç¤ºçš„é¢˜ç›®
                            const questionTitle = document.querySelector('.interview-question');
                            const questionTags = document.querySelector('.interview-tags');
                            const questionProgress = document.querySelector('.interview-progress');
                            
                            if (questionTitle) questionTitle.textContent = title;
                            if (questionProgress) {
                                questionProgress.innerHTML = `<i class="fas fa-list-ol"></i> ç¬¬ ${number} é¢˜ / å…± 50 é¢˜`;
                            }
                            
                            // æ›´æ–°æ ‡ç­¾
                            if (questionTags) {
                                questionTags.innerHTML = '';
                                tags.forEach(tag => {
                                    questionTags.appendChild(tag.cloneNode(true));
                                });
                            }
                            
                            // æ¸…ç©ºè¾“å…¥æ¡†
                            if (interviewAnswerInput) {
                                interviewAnswerInput.value = '';
                                interviewAnswerInput.focus();
                            }
                            
                            // æ»šåŠ¨åˆ°é¡¶éƒ¨
                            document.querySelector('.interview-card').scrollIntoView({ behavior: 'smooth' });
                        });
                    });
                }
                
                // åˆ·æ–°é¢˜ç›®
                if (refreshQuestionBtn) {
                    refreshQuestionBtn.addEventListener('click', function() {
                        // éšæœºé€‰æ‹©ä¸€ä¸ªé¢˜ç›®
                        const randomIndex = Math.floor(Math.random() * interviewListItems.length);
                        interviewListItems[randomIndex].click();
                    });
                }
                
                // æŸ¥çœ‹ç­”æ¡ˆ
                if (checkAnswerBtn) {
                    checkAnswerBtn.addEventListener('click', function() {
                        const questionTitle = document.querySelector('.interview-question').textContent;
                        // å°†é—®é¢˜æ·»åŠ åˆ°AIåŠ©æ‰‹è¾“å…¥æ¡†å¹¶å‘é€
                        const chatInput = document.getElementById('chatInput');
                        const sendBtn = document.getElementById('sendBtn');
                        
                        if (chatInput && sendBtn) {
                            chatInput.value = `è¯·ç»™æˆ‘è¯¦ç»†è§£ç­”è¿™ä¸ªé¢è¯•é¢˜ï¼š${questionTitle}`;
                            sendBtn.click();
                        }
                    });
                }
                
                // æˆ‘ä¼šäº†æŒ‰é’®
                if (learnedBtn) {
                    learnedBtn.addEventListener('click', function() {
                        alert('å¤ªæ£’äº†ï¼æ‚¨å·²æŒæ¡è¿™é“é¢˜ç›®ã€‚æˆ‘ä»¬ä¼šè®°å½•æ‚¨çš„å­¦ä¹ è¿›åº¦ã€‚');
                        // éšæœºåˆ‡æ¢åˆ°ä¸‹ä¸€é¢˜
                        refreshQuestionBtn.click();
                    });
                }
                
                // è®°ä¸€ä¸‹æŒ‰é’®
                if (noteBtn) {
                    noteBtn.addEventListener('click', function() {
                        alert('é¢˜ç›®å·²æ·»åŠ åˆ°æ‚¨çš„å­¦ä¹ ç¬”è®°ä¸­ï¼Œæ‚¨å¯ä»¥ç¨åå¤ä¹ ã€‚');
                    });
                }
            }
            
            // åˆå§‹åŒ–é¢è¯•é¢˜åŠŸèƒ½
            initInterviewQuestions();
            
            // APIé…ç½®ç›¸å…³åŠŸèƒ½ - ç»Ÿä¸€å¤„ç†
            function initApiConfig() {
                const configApiBtn = document.getElementById('configApiBtn');
                const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                if (configApiBtn && currentApiKey) {
                    configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                    configApiBtn.style.color = '#10b981';
                    configApiBtn.style.borderColor = '#10b981';
                }
                
                // ç»‘å®šç‚¹å‡»äº‹ä»¶
                if (configApiBtn) {
                    configApiBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        openApiConfigModal();
                    });
                }
            }
            
            // å®šä¹‰æ‰“å¼€APIé…ç½®æ¨¡æ€æ¡†çš„å‡½æ•°
            function openApiConfigModal() {
                console.log('æ‰“å¼€APIé…ç½®æ¨¡æ€æ¡†');
                const apiConfigModal = document.getElementById('apiConfigModal');
                const apiKeyInput = document.getElementById('apiKey');
                const apiProviderSelect = document.getElementById('apiProvider');
                
                if (!apiConfigModal) {
                    console.error('æ‰¾ä¸åˆ°APIé…ç½®æ¨¡æ€æ¡†');
                    alert('APIé…ç½®æ¨¡æ€æ¡†æœªæ‰¾åˆ°ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    return;
                }
                
                // ä»localStorageåŠ è½½å·²ä¿å­˜çš„é…ç½®
                if (apiKeyInput) {
                    const savedApiKey = localStorage.getItem('ai_learning_companion_api_key');
                    apiKeyInput.value = savedApiKey || '';
                }
                
                if (apiProviderSelect) {
                    const savedApiProvider = localStorage.getItem('apiProvider');
                    apiProviderSelect.value = savedApiProvider || 'alibaba';
                }
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                apiConfigModal.style.display = 'block';
                apiConfigModal.classList.add('show');
                
                console.log('APIé…ç½®æ¨¡æ€æ¡†å·²æ˜¾ç¤º');
            }
            
            // å…³é—­æ¨¡æ€æ¡†åŠŸèƒ½
            function closeApiConfigModal() {
                const apiConfigModal = document.getElementById('apiConfigModal');
                if (apiConfigModal) {
                    apiConfigModal.classList.remove('show');
                    setTimeout(() => {
                        apiConfigModal.style.display = 'none';
                    }, 300);
                }
            }
            
            // åˆå§‹åŒ–æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
            function initModalEvents() {
                const apiConfigClose = document.getElementById('apiConfigClose');
                const apiConfigCancel = document.getElementById('apiConfigCancel');
                const apiConfigModal = document.getElementById('apiConfigModal');
                const modalOverlay = apiConfigModal ? apiConfigModal.querySelector('.modal-overlay') : null;
                
                if (apiConfigClose) {
                    apiConfigClose.addEventListener('click', closeApiConfigModal);
                }
                
                if (apiConfigCancel) {
                    apiConfigCancel.addEventListener('click', closeApiConfigModal);
                }
                
                if (modalOverlay) {
                    modalOverlay.addEventListener('click', closeApiConfigModal);
                }
                
                // åˆ‡æ¢API Keyæ˜¾ç¤º/éšè— - å·²ç§»é™¤é‡å¤ä»£ç 
                
                // ä¿å­˜APIé…ç½®
                const apiConfigConfirm = document.getElementById('apiConfigConfirm');
                const apiProviderSelect = document.getElementById('apiProvider');
                
                if (apiConfigConfirm) {
                    apiConfigConfirm.addEventListener('click', function() {
                        const apiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                        const apiProvider = apiProviderSelect ? apiProviderSelect.value : 'alibaba';
                        
                        if (!apiKey) {
                            alert('è¯·è¾“å…¥APIå¯†é’¥');
                            return;
                        }
                        
                        // ä¿å­˜åˆ°localStorage
                        localStorage.setItem('ai_learning_companion_api_key', apiKey);
                        localStorage.setItem('apiProvider', apiProvider);
                        
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        const configApiBtn = document.getElementById('configApiBtn');
                        if (configApiBtn) {
                            configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                            configApiBtn.style.color = '#10b981';
                            configApiBtn.style.borderColor = '#10b981';
                        }
                        
                        // å…³é—­æ¨¡æ€æ¡†
                        closeApiConfigModal();
                        
                        alert('APIé…ç½®å·²ä¿å­˜');
                    });
                }
            }
            
            // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
            initApiConfig();
            initModalEvents();
            
            // å»¶è¿Ÿé‡æ–°ç»‘å®šäº‹ä»¶ï¼Œç¡®ä¿åœ¨æ‰€æœ‰å¤–éƒ¨åº“åŠ è½½å®Œæˆåç»‘å®š
            setTimeout(function() {
                console.log('å»¶è¿Ÿé‡æ–°ç»‘å®šAPIé…ç½®æŒ‰é’®äº‹ä»¶');
                const configApiBtn = document.getElementById('configApiBtn');
                if (configApiBtn) {
                    // å¼ºåˆ¶ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
                    const newBtn = configApiBtn.cloneNode(true);
                    configApiBtn.parentNode.replaceChild(newBtn, configApiBtn);
                    
                    // é‡æ–°æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    newBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('ğŸš€ APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡» - å»¶è¿Ÿç»‘å®šç‰ˆæœ¬');
                        openApiConfigModal();
                    });
                    
                    console.log('âœ… APIé…ç½®æŒ‰é’®äº‹ä»¶å·²é‡æ–°ç»‘å®š');
                } else {
                    console.error('âŒ æ‰¾ä¸åˆ°APIé…ç½®æŒ‰é’®');
                }
            }, 2000);

            // è·å–URLå‚æ•°
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // ç¡®ä¿APIé…ç½®æŒ‰é’®å¯ç‚¹å‡»
            const setupApiConfigButton = () => {
                const configApiBtn = document.getElementById('configApiBtn');
                
                if (configApiBtn) {
                    console.log('è®¾ç½®APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶');
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    configApiBtn.replaceWith(configApiBtn.cloneNode(true));
                    
                    // é‡æ–°è·å–æŒ‰é’®å¹¶æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    const newConfigApiBtn = document.getElementById('configApiBtn');
                    newConfigApiBtn.addEventListener('click', function(e) {
                        console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // ä½¿ç”¨å…¨å±€å‡½æ•°æ‰“å¼€æ¨¡æ€æ¡†
                        window.openApiConfigModal();
                    });
                } else {
                    console.error('æœªæ‰¾åˆ°APIé…ç½®æŒ‰é’®');
                }
            };
            
            // åˆå§‹åŒ–APIé…ç½®æŒ‰é’®
            setupApiConfigButton();
            
            // åˆå§‹åŒ–å˜é‡
            const currentApiKey = localStorage.getItem('ai_learning_companion_api_key') || '';
            
            // æ›´æ–°é…ç½®APIæŒ‰é’®çŠ¶æ€
            const configApiBtn = document.getElementById('configApiBtn');
            if(configApiBtn && currentApiKey) {
                configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                configApiBtn.style.borderColor = '#10b981';
            }
            
            // APIé…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            if (configApiBtn) {
                configApiBtn.addEventListener('click', function() {
                    console.log('APIé…ç½®æŒ‰é’®è¢«ç‚¹å‡»');
                    
                    const apiConfigModal = document.getElementById('apiConfigModal');
                    if (!apiConfigModal) {
                        console.error('æ‰¾ä¸åˆ°APIé…ç½®æ¨¡æ€æ¡†');
                        return;
                    }
                    
                    // ä»localStorageåŠ è½½å·²ä¿å­˜çš„é…ç½®
                    const apiKeyInput = document.getElementById('apiKey');
                    const apiProviderSelect = document.getElementById('apiProvider');
                    
                    if (apiKeyInput) {
                        const savedApiKey = localStorage.getItem('ai_learning_companion_api_key');
                        if (savedApiKey) {
                            apiKeyInput.value = savedApiKey;
                        } else {
                            apiKeyInput.value = '';
                        }
                    }
                    
                    if (apiProviderSelect) {
                        const savedApiProvider = localStorage.getItem('apiProvider');
                        if (savedApiProvider) {
                            apiProviderSelect.value = savedApiProvider;
                        }
                    }
                    
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†
                    apiConfigModal.style.display = 'block';
                    apiConfigModal.classList.add('show');
                });
            }
            
            // å…³é—­æ¨¡æ€æ¡†
            const apiConfigClose = document.getElementById('apiConfigClose');
            const apiConfigCancel = document.getElementById('apiConfigCancel');
            const apiConfigModal = document.getElementById('apiConfigModal');
            const modalOverlay = apiConfigModal ? apiConfigModal.querySelector('.modal-overlay') : null;
            
            function closeApiConfigModal() {
                if (apiConfigModal) {
                    apiConfigModal.classList.remove('show');
                    setTimeout(() => {
                        apiConfigModal.style.display = 'none';
                    }, 300);
                }
            }
            
            if (apiConfigClose) {
                apiConfigClose.addEventListener('click', closeApiConfigModal);
            }
            
            if (apiConfigCancel) {
                apiConfigCancel.addEventListener('click', closeApiConfigModal);
            }
            
            if (modalOverlay) {
                modalOverlay.addEventListener('click', closeApiConfigModal);
            }
            
            // åˆ‡æ¢API Keyæ˜¾ç¤º/éšè—
            const toggleApiKey = document.getElementById('toggleApiKey');
            const apiKeyInput = document.getElementById('apiKey');
            
            if (toggleApiKey && apiKeyInput) {
                toggleApiKey.addEventListener('click', function() {
                    if (apiKeyInput.type === 'password') {
                        apiKeyInput.type = 'text';
                        toggleApiKey.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        apiKeyInput.type = 'password';
                        toggleApiKey.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            }
            
            // ä¿å­˜APIé…ç½®
            const apiConfigConfirm = document.getElementById('apiConfigConfirm');
            
            if (apiConfigConfirm) {
                apiConfigConfirm.addEventListener('click', function() {
                    const apiKey = apiKeyInput.value.trim();
                    const apiProvider = apiProviderSelect.value;
                    
                    if (!apiKey) {
                        alert('è¯·è¾“å…¥APIå¯†é’¥');
                        return;
                    }
                    
                    // ä¿å­˜åˆ°localStorage
                    localStorage.setItem('ai_learning_companion_api_key', apiKey);
                    localStorage.setItem('apiProvider', apiProvider);
                    
                    // æ›´æ–°å½“å‰API Key
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    if(configApiBtn) {
                        configApiBtn.innerHTML = '<i class="fas fa-check-circle"></i> å·²é…ç½®API';
                        configApiBtn.style.color = '#10b981'; // ç»¿è‰²
                        configApiBtn.style.borderColor = '#10b981';
                    }
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    closeApiConfigModal();
                    
                    alert('APIé…ç½®å·²ä¿å­˜');
                });
            }
        });
    </script>
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            sendBtn.click();
                        }
                    });
                }
                
                // æ¸…ç©ºèŠå¤©åŠŸèƒ½
                if (clearBtn) {
                    clearBtn.addEventListener('click', function() {
                        if (confirm('ç¡®å®šè¦æ¸…ç©ºèŠå¤©è®°å½•å—ï¼Ÿ')) {
                            const chatMessages = document.getElementById('chatMessages');
                            if (chatMessages) {
                                chatMessages.innerHTML = `
                                    <div class="welcome-message">
                                        <div class="assistant-avatar">
                                            <i class="fas fa-robot"></i>
                                        </div>
                                        <h3 class="welcome-title">æ‚¨å¥½ï¼æˆ‘æ˜¯AIå­¦ä¹ åŠ©æ‰‹</h3>
                                        <p class="welcome-text">æˆ‘å¯ä»¥å›ç­”æ‚¨å…³äºèŒä¸šå‘å±•ã€æŠ€èƒ½æå‡çš„é—®é¢˜ã€‚è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„é—®é¢˜ï¼</p>
                                    </div>
                                `;
                            }
                        }
                    });
                }
            }
            
            // æ‰§è¡Œåˆå§‹åŒ–
            // åˆå§‹åŒ–APIé…ç½®æ¨¡æ€æ¡†
            initApiConfigModal();
            
            // åˆå§‹åŒ–AIåŠ©æ‰‹
            initAIAssistant();
            
            // åˆå§‹åŒ–é¢è¯•é¢˜åŠŸèƒ½
            initInterviewQuestions();
            
        });
    </script>
</body>

<!-- APIé…ç½®æ¨¡æ€æ¡† -->
<div class="modal" id="apiConfigModal">
    <div class="modal-overlay"></div>
    <div class="modal-container">
        <div class="modal-header">
            <h3>
                <i class="fas fa-cog"></i>
                é…ç½®APIå¯†é’¥
            </h3>
            <button class="modal-close" id="apiConfigClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p class="modal-description">è¯·è¾“å…¥æ‚¨çš„APIå¯†é’¥ï¼Œä»¥è·å¾—æ›´å¥½çš„AIåŠŸèƒ½ä½“éªŒã€‚</p>
            
            <div class="input-group">
                <label for="apiKey">å¤§è¯­è¨€æ¨¡å‹ API å¯†é’¥</label>
                <div class="key-input-container">
                    <input type="password" id="apiKey" placeholder="è¾“å…¥æ‚¨çš„APIå¯†é’¥..." class="modal-input">
                    <button class="toggle-btn" id="toggleApiKey">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="provider-select">
                <label for="apiProvider">æ¨¡å‹æä¾›å•†</label>
                <select id="apiProvider" class="modal-select">
                    <option value="alibaba">é˜¿é‡Œäº‘ - DashScope</option>
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic Claude</option>
                </select>
            </div>
            
            <div class="provider-info alibaba-info">
                <div class="provider-logo">
                    <i class="fas fa-cloud" style="font-size: 32px; color: #ff6a00;"></i>
                </div>
                <div class="provider-details">
                    <h4>é˜¿é‡Œäº‘ DashScope</h4>
                    <p>ä½¿ç”¨é€šä¹‰å¤§æ¨¡å‹ç³»åˆ—ï¼ŒåŒ…æ‹¬æ¨¡å‹é€šä¹‰åƒé—®2.0ç­‰</p>
                    <a href="https://dashscope.aliyun.com/" target="_blank" class="provider-link">è·å–å¯†é’¥</a>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-btn modal-btn-cancel" id="apiConfigCancel">å–æ¶ˆ</button>
            <button class="modal-btn modal-btn-confirm" id="apiConfigConfirm">ä¿å­˜é…ç½®</button>
        </div>
    </div>
</div>
