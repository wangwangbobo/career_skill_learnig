# 职途助手实时日志功能使用指南

## 功能说明

已成功为职途助手添加了实时日志功能，现在服务器终端显示的所有日志都会实时推送到前端界面的"实时日志"面板中。

## 实现的功能

### 1. 服务器端日志捕获
- ✅ 重写了 `console.log`、`console.error`、`console.warn` 方法
- ✅ 捕获所有服务器端的日志输出
- ✅ 支持不同级别的日志分类（info、error、warning）

### 2. 服务器端SSE推送
- ✅ 创建了 `/api/logs-stream` API端点
- ✅ 使用Server-Sent Events (SSE) 实时推送日志
- ✅ 支持多客户端连接，自动处理断开连接
- ✅ 删除了重复的API端点定义

### 3. 前端日志接收
- ✅ 添加了 `connectToLogStream()` 方法连接SSE流
- ✅ 添加了 `handleServerLog()` 方法处理服务器日志
- ✅ 自动重连机制，连接断开时自动重试
- ✅ 日志过滤功能，避免显示重复或垃圾信息
- ✅ 日志级别分类显示，支持不同颜色标识

## 使用方法

### 1. 启动服务器
```bash
cd /Users/wangbo/open-source/eko/web-interface
node server.js
```

### 2. 访问界面
打开浏览器访问：`http://localhost:3000`

### 3. 观察实时日志
- 右侧"AI 实时日志"面板会自动连接到服务器日志流
- 所有服务器活动都会实时显示，包括：
  - 🎓 职途助手启动信息
  - 🔑 API配置状态
  - 🤖 AI生成进度
  - ⚠️ 错误和警告信息
  - ✅ 成功操作确认

### 4. 日志面板功能
- **自动滚动**：默认开启，新日志会自动滚到底部
- **清空日志**：点击垃圾桶图标清空当前日志
- **下载日志**：点击下载图标保存日志文件
- **隐藏面板**：点击眼睛图标隐藏/显示日志面板

## 技术实现细节

### 服务器端核心代码
```javascript
// 存储所有连接的SSE客户端
const logClients = new Set();

// 日志捕获和广播函数
function setupLogCapture() {
    const originalLog = console.log;
    console.log = function(...args) {
        const message = args.join(' ');
        originalLog.apply(console, args);
        broadcastLog('info', message);
    };
}

// SSE端点
app.get('/api/logs-stream', (req, res) => {
    res.writeHead(200, {
        'Content-Type': 'text/event-stream',
        'Cache-Control': 'no-cache',
        'Connection': 'keep-alive'
    });
    logClients.add(res);
});
```

### 前端核心代码
```javascript
// 连接实时日志流
ui.connectToLogStream = function() {
    this.logEventSource = new EventSource('/api/logs-stream');
    
    this.logEventSource.addEventListener('log', (event) => {
        const logData = JSON.parse(event.data);
        this.handleServerLog(logData);
    });
    
    // 自动重连机制
    this.logEventSource.onerror = (error) => {
        setTimeout(() => {
            if (this.logEventSource.readyState === EventSource.CLOSED) {
                this.connectToLogStream();
            }
        }, 5000);
    };
};
```

## 验证功能
完成启动后，可以进行以下操作验证功能：

1. **输入职位信息**：在主界面输入职位名称，观察日志显示"收到学习请求"
2. **点击生成按钮**：观察AI生成过程的详细日志
3. **查看API调用**：观察真实API调用或模拟数据生成的日志
4. **模拟错误**：输入无效信息，观察错误日志的显示

## 日志示例
启动后会看到类似以下的实时日志：
```
[12:34:56] 🌟 智能学习伴侣服务器启动成功！
[12:34:56] 🔑 API密钥已配置，将使用真实AI功能
[12:34:56] 📡 新的日志SSE连接建立
[12:35:10] 🎯 收到学习请求: AI工程师
[12:35:10] 🤖 使用真AI Agent生成学习方案...
[12:35:15] ✅ AI生成完成，耗时: 4523ms
```

## 故障排除

### 1. 日志流连接失败
- 检查服务器是否正常运行
- 查看浏览器开发者工具的Network标签
- 确认`/api/logs-stream`端点响应正常

### 2. 日志显示不完整
- 检查日志过滤规则是否过于严格
- 查看浏览器控制台是否有JavaScript错误

### 3. 连接频繁断开
- 检查网络连接稳定性
- 确认服务器没有内存或CPU过载

## 总结

实时日志功能已经完全实现，具备：
- ✅ 完整的日志捕获机制
- ✅ 稳定的SSE实时推送
- ✅ 智能的前端日志处理
- ✅ 用户友好的界面交互
- ✅ 自动重连和错误处理

现在您可以通过前端界面实时监控服务器的所有活动，极大提升了开发和使用体验！